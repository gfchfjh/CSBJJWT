# KOOK消息转发系统 - CMD工具包使用说明

> 🎉 **完整的CMD命令行工具包已准备就绪！**

---

## 🚀 快速开始（3步启动）

### 第1步：打开主控制台

```cmd
双击文件: KOOK系统_主控制台.bat
```

### 第2步：检查环境

```
在主控制台中，输入: 1
（这将运行环境检查）
```

### 第3步：启动系统

```
在主控制台中，输入: 6
（这将同时启动后端和前端）
```

完成！系统已启动，浏览器会自动打开前端界面。

---

## 📦 工具包文件清单

### 🎯 核心工具（必看）

| 文件名 | 用途 | 优先级 |
|--------|------|--------|
| **KOOK系统_主控制台.bat** | 集成式菜单系统（推荐） | ⭐⭐⭐⭐⭐ |
| **开始使用_请看这里.txt** | 快速入门指南 | ⭐⭐⭐⭐⭐ |
| **CMD_操作指南_完整版.md** | 超详细操作手册 | ⭐⭐⭐⭐⭐ |

### 🔧 启动工具

| 文件名 | 用途 | 何时使用 |
|--------|------|----------|
| **快速启动_后端.bat** | 启动后端服务 | 需要单独启动后端时 |
| **快速启动_前端.bat** | 启动前端服务 | 需要单独启动前端时 |

### 🧪 测试工具

| 文件名 | 用途 | 何时使用 |
|--------|------|----------|
| **一键测试_系统.bat** | 完整环境检查 | 首次使用或排查问题时 |
| **一键检查_Cookie功能.bat** | Cookie功能验证 | 验证Cookie更新功能时 |

### 📚 文档

| 文件名 | 内容 | 何时查看 |
|--------|------|----------|
| **CMD指导_执行摘要.md** | 任务完成摘要和工具说明 | 了解工具包全貌时 |
| **CMD_操作指南_完整版.md** | 7个阶段的详细操作流程 | 需要详细步骤时 |

---

## 🎮 主控制台功能一览

**KOOK系统_主控制台.bat** 提供16个菜单选项：

### 系统管理
- `[1]` 环境检查 - 测试Python、Node.js、Git等
- `[2]` Cookie功能检查 - 验证Cookie更新功能
- `[3]` 数据库检查 - 查看数据库状态

### 服务启动
- `[4]` 启动后端服务 - 端口9527
- `[5]` 启动前端服务 - 端口5173
- `[6]` 同时启动后端+前端 - **推荐**

### 快速操作
- `[7]` 打开前端界面 - 浏览器
- `[8]` 打开API文档 - Swagger
- `[9]` 查看数据目录 - 资源管理器
- `[10]` 查看日志文件 - 资源管理器

### 代码管理
- `[11]` Git状态查看 - 分支和工作区
- `[12]` 拉取最新代码 - git pull
- `[13]` 查看提交历史 - git log

### 帮助文档
- `[14]` 查看完整操作指南
- `[15]` 查看故障排查文档
- `[16]` 查看快速启动文档

---

## 📖 使用场景指南

### 场景1: 我是第一次使用系统

```
步骤1: 双击打开 "开始使用_请看这里.txt"
       → 阅读快速入门指南

步骤2: 双击运行 "KOOK系统_主控制台.bat"
       → 选择 [1] 环境检查

步骤3: 在主控制台选择 [6] 同时启动后端+前端

步骤4: 浏览器自动打开，开始使用系统
```

### 场景2: 我只想快速启动系统

```
方式A（推荐）:
  双击 "KOOK系统_主控制台.bat" → 选择 [6]

方式B:
  1. 双击 "快速启动_后端.bat"
  2. 双击 "快速启动_前端.bat"
```

### 场景3: 我想验证Cookie功能

```
双击 "一键检查_Cookie功能.bat"

或

双击 "KOOK系统_主控制台.bat" → 选择 [2]
```

### 场景4: 系统出现问题，需要排查

```
步骤1: 双击 "一键测试_系统.bat"
       → 检查环境是否完整

步骤2: 双击 "KOOK系统_主控制台.bat"
       → 选择 [11] 查看Git状态
       → 选择 [3] 检查数据库

步骤3: 打开 "TROUBLESHOOTING_WINDOWS.md"
       → 查找对应的问题和解决方案
```

### 场景5: 我想了解详细的操作步骤

```
打开 "CMD_操作指南_完整版.md"

或

双击 "KOOK系统_主控制台.bat" → 选择 [14]
```

### 场景6: 每天启动和停止系统

```
启动:
  双击 "KOOK系统_主控制台.bat" → 选择 [6]
  
停止:
  1. 在前端界面停止所有账号
  2. 关闭后端CMD窗口
  3. 关闭前端CMD窗口
```

---

## ⚡ 常用命令速查

### 启动服务

```cmd
# 使用主控制台（推荐）
KOOK系统_主控制台.bat

# 使用快速启动脚本
快速启动_后端.bat
快速启动_前端.bat

# 手动启动
cd backend && ..\venv\Scripts\activate && python -m uvicorn app.main:app --reload
cd frontend && npm run dev
```

### 测试系统

```cmd
# 完整环境检查
一键测试_系统.bat

# Cookie功能检查
一键检查_Cookie功能.bat

# 手动API测试
curl http://localhost:9527/health
```

### 访问系统

```cmd
# 前端界面
http://localhost:5173

# API文档
http://localhost:9527/docs

# 健康检查
http://localhost:9527/health
```

---

## 🎯 核心功能说明

### Cookie自动更新功能（新）

**功能**: 直接更新现有账号的Cookie，无需删除重建

**使用步骤**:
1. 进入"账号管理"页面
2. 点击账号右侧的"更新Cookie"按钮（黄色）
3. 粘贴新Cookie
4. 点击"更新"
5. 成功！账号配置和映射都保留

**优势**:
- ✅ 保留所有频道映射
- ✅ 保留Bot配置关联
- ✅ 保留历史消息记录
- ✅ 一键更新，操作简单

**验证**: 运行 `一键检查_Cookie功能.bat`

---

## 📊 测试清单

使用以下清单确保系统正常运行：

### 环境测试（运行 `一键测试_系统.bat`）

- [ ] Python 3.11+ 已安装
- [ ] Node.js 18+ 已安装
- [ ] Git已安装
- [ ] 虚拟环境存在
- [ ] 后端代码存在
- [ ] 前端代码存在
- [ ] 数据目录存在

### 服务测试

- [ ] 后端服务正常启动（端口9527）
- [ ] 前端服务正常启动（端口5173）
- [ ] 健康检查API响应正常
- [ ] API文档可以访问
- [ ] 前端界面正常加载

### Cookie功能测试（运行 `一键检查_Cookie功能.bat`）

- [ ] Cookie更新API存在
- [ ] 数据库更新方法存在
- [ ] 前端更新功能存在

### 完整功能测试

- [ ] 可以添加KOOK账号
- [ ] 可以更新Cookie
- [ ] 可以启动账号监听
- [ ] Chrome浏览器正常启动
- [ ] 可以配置Bot
- [ ] 可以配置频道映射
- [ ] 可以转发消息

---

## 🆘 常见问题快速解决

### 问题1: 端口被占用

```cmd
# 查找占用端口的进程
netstat -ano | findstr :9527

# 结束进程（替换<PID>为实际进程号）
taskkill /F /PID <PID>

# 重新启动服务
```

### 问题2: Chrome无法启动

```cmd
# 强制关闭所有Chrome进程
taskkill /F /IM chrome.exe /T

# 等待几秒
timeout /t 5

# 重新点击"启动"按钮
```

### 问题3: 虚拟环境激活失败

```cmd
# 重新创建虚拟环境
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate

# 重新安装依赖
pip install -r backend\requirements.txt
```

### 问题4: npm install失败

```cmd
# 使用legacy-peer-deps参数
cd frontend
npm install --legacy-peer-deps
```

### 问题5: 找不到数据库

```cmd
# 数据库会在首次运行时自动创建
# 位置: C:\Users\你的用户名\Documents\KookForwarder\data\config.db

# 创建数据目录
mkdir C:\Users\%USERNAME%\Documents\KookForwarder\data

# 重启后端服务
```

---

## 📁 重要文件位置

### 项目文件

```
C:\Users\tanzu\Desktop\CSBJJWT\
├── backend\              # 后端代码
├── frontend\             # 前端代码
├── venv\                 # Python虚拟环境
├── KOOK系统_主控制台.bat # 主控制台（重要）
├── 快速启动_后端.bat     # 后端启动脚本
├── 快速启动_前端.bat     # 前端启动脚本
├── 一键测试_系统.bat     # 环境测试脚本
├── 一键检查_Cookie功能.bat # Cookie功能检查
├── 开始使用_请看这里.txt # 快速入门指南
├── CMD_操作指南_完整版.md # 详细操作手册
└── CMD指导_执行摘要.md   # 工具包说明
```

### 数据文件

```
C:\Users\你的用户名\Documents\KookForwarder\data\
├── config.db             # 主数据库
├── images\               # 图片缓存
└── logs\                 # 日志文件
```

---

## 🔗 相关链接

- **项目仓库**: https://github.com/gfchfjh/CSBJJWT
- **Issue追踪**: https://github.com/gfchfjh/CSBJJWT/issues
- **API文档**: http://localhost:9527/docs （启动后访问）

---

## 📞 获取帮助

遇到问题时，请按以下顺序查找解决方案：

1. **查看快速入门** → `开始使用_请看这里.txt`
2. **运行系统测试** → `一键测试_系统.bat`
3. **查看详细手册** → `CMD_操作指南_完整版.md`
4. **查看故障排查** → `TROUBLESHOOTING_WINDOWS.md`
5. **提交Issue** → https://github.com/gfchfjh/CSBJJWT/issues

---

## 🎉 开始使用

### 新用户推荐流程

```
1️⃣ 阅读 "开始使用_请看这里.txt"
2️⃣ 运行 "一键测试_系统.bat"
3️⃣ 运行 "KOOK系统_主控制台.bat"
4️⃣ 在主控制台选择 [6] 启动系统
5️⃣ 在前端界面添加KOOK账号
6️⃣ 配置Bot和频道映射
7️⃣ 开始使用！
```

### 老用户快速启动

```
1️⃣ 运行 "KOOK系统_主控制台.bat"
2️⃣ 选择 [6] 同时启动后端+前端
3️⃣ 开始使用！
```

---

## 📝 更新日志

### v1.0 - 2025-11-10

**新增**:
- ✅ KOOK系统_主控制台.bat（16个菜单选项）
- ✅ 快速启动_后端.bat
- ✅ 快速启动_前端.bat
- ✅ 一键测试_系统.bat
- ✅ 一键检查_Cookie功能.bat
- ✅ CMD_操作指南_完整版.md
- ✅ CMD指导_执行摘要.md
- ✅ 开始使用_请看这里.txt

**验证**:
- ✅ Cookie自动更新功能已实现
- ✅ 数据库结构完整（11个表）
- ✅ 系统环境检查通过

---

## 💡 小贴士

### 提示1: 使用主控制台
主控制台集成了所有常用操作，推荐作为主要入口。

### 提示2: 保持服务运行
启动后端和前端后，不要关闭CMD窗口，保持它们运行。

### 提示3: 定期备份
建议定期备份数据库文件：
```cmd
copy C:\Users\%USERNAME%\Documents\KookForwarder\data\config.db backup.db
```

### 提示4: Cookie更新
当KOOK账号Cookie过期时，使用"更新Cookie"功能而不是删除重建。

### 提示5: 查看日志
遇到问题时，检查日志文件可以快速定位原因：
```cmd
主控制台 → [10] 查看日志文件
```

---

**祝您使用愉快！** 🚀

如有任何问题，请参考 `CMD_操作指南_完整版.md` 或提交Issue。

---

*文档版本: 1.0*  
*最后更新: 2025-11-10*  
*适用版本: v18.0.4+*
