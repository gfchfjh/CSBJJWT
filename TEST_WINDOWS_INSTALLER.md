# 🧪 Windows安装包测试方案

**测试对象**: KOOK消息转发系统 Setup 1.13.3.exe  
**文件大小**: 89 MB  
**MD5校验**: 31cf542f95f90b1964e8887825fbec17

---

## ⚠️ 测试环境说明

### 当前环境限制

**当前环境**: Linux (无法直接测试Windows应用)

**可执行的测试**:
- ✅ 文件完整性验证
- ✅ 后端代码逻辑测试
- ✅ 配置文件验证
- ✅ API接口测试
- ✅ 依赖项检查

**需要Windows环境的测试**:
- ⏳ 安装程序测试
- ⏳ GUI界面测试
- ⏳ 完整的端到端功能测试

---

## ✅ 已执行的自动化测试

### 1. 文件完整性验证

```
✅ 文件存在: KOOK消息转发系统 Setup 1.13.3.exe
✅ 文件大小: 89 MB
✅ MD5校验: 31cf542f95f90b1964e8887825fbec17
```

### 2. 后端代码测试（Linux环境）

即将执行...

---

## 📋 完整测试清单

### 阶段1: 安装前检查 ✅

- [x] 文件完整性（MD5校验）
- [x] 文件大小验证
- [x] Release页面可访问性

### 阶段2: 安装测试（需要Windows环境）

#### 2.1 安装程序测试

- [ ] 双击运行安装程序
- [ ] 安装向导正常显示
- [ ] 可以选择安装路径
- [ ] 可以创建桌面快捷方式
- [ ] 安装进度条正常
- [ ] 安装完成无错误

**预期安装位置**:
- 默认: `C:\Program Files\KOOK消息转发系统`
- 快捷方式: 桌面 + 开始菜单

#### 2.2 安装文件检查

- [ ] 主程序: `KOOK消息转发系统.exe`
- [ ] Backend: `resources\backend\KookForwarder-Backend.exe`
- [ ] 配置目录: `data\`
- [ ] 日志目录: `logs\`
- [ ] 必要的DLL文件

### 阶段3: 首次启动测试

#### 3.1 应用启动

- [ ] 双击桌面快捷方式
- [ ] 应用窗口正常打开
- [ ] 无崩溃或错误弹窗
- [ ] 配置向导自动显示

#### 3.2 配置向导测试

**步骤1: 欢迎页**
- [ ] 欢迎信息显示
- [ ] 免责声明显示
- [ ] "同意并继续"按钮可点击

**步骤2: KOOK账号配置**
- [ ] 可以添加账号
- [ ] 支持账号密码登录
- [ ] 支持Cookie登录
- [ ] 登录状态正确显示

**步骤3: Bot配置**
- [ ] 可以添加Discord Bot
- [ ] 可以添加Telegram Bot
- [ ] 可以添加飞书Bot
- [ ] Webhook URL验证
- [ ] 连接测试功能

**步骤4: 频道映射**
- [ ] 可以创建映射规则
- [ ] 选择KOOK频道
- [ ] 选择目标Bot和频道
- [ ] 映射规则保存正确

**步骤5: 完成**
- [ ] 配置摘要显示
- [ ] "开始转发"按钮可用
- [ ] 进入主界面

### 阶段4: 核心功能测试

#### 4.1 账号管理

- [ ] 查看账号列表
- [ ] 添加新账号
- [ ] 编辑账号信息
- [ ] 删除账号
- [ ] 账号状态实时更新
- [ ] 重新连接功能

#### 4.2 Bot管理

- [ ] 查看Bot列表
- [ ] 添加Discord Bot
  - [ ] Webhook URL验证
  - [ ] 测试发送消息
- [ ] 添加Telegram Bot
  - [ ] Token验证
  - [ ] 获取Chat ID
- [ ] 添加飞书Bot
  - [ ] Webhook验证
  - [ ] 签名验证
- [ ] 编辑Bot
- [ ] 删除Bot
- [ ] Bot状态监控

#### 4.3 频道映射

- [ ] 创建映射规则
- [ ] 编辑映射规则
- [ ] 删除映射规则
- [ ] 启用/禁用映射
- [ ] 批量操作
- [ ] 导入/导出配置

#### 4.4 消息过滤

- [ ] 关键词过滤
  - [ ] 包含关键词
  - [ ] 排除关键词
  - [ ] 正则表达式
- [ ] 用户过滤
  - [ ] 白名单
  - [ ] 黑名单
- [ ] 消息类型过滤
  - [ ] 文本
  - [ ] 图片
  - [ ] 文件
  - [ ] 音频/视频
- [ ] 过滤规则保存

#### 4.5 消息转发功能

**文本消息**:
- [ ] 纯文本转发
- [ ] Markdown格式保留
- [ ] @提及处理
- [ ] 表情符号转换

**图片消息**:
- [ ] 单张图片转发
- [ ] 多张图片转发
- [ ] 图片压缩（>5MB）
- [ ] 图片URL转换

**文件消息**:
- [ ] 小文件转发（<8MB）
- [ ] 大文件URL转发
- [ ] 文件名保留

**其他消息**:
- [ ] 音频消息
- [ ] 视频消息
- [ ] 卡片消息（转为文本）

**消息去重**:
- [ ] 相同内容不重复转发
- [ ] 去重时间窗口（1小时）

**速率限制**:
- [ ] Discord: 5条/秒
- [ ] Telegram: 1条/秒
- [ ] 飞书: 5条/秒

#### 4.6 日志功能

- [ ] 实时日志显示
- [ ] 日志级别过滤
  - [ ] DEBUG
  - [ ] INFO
  - [ ] WARNING
  - [ ] ERROR
- [ ] 日志搜索
- [ ] 日志导出
- [ ] 日志清理

#### 4.7 设置功能

- [ ] 自动启动设置
- [ ] 最小化到托盘
- [ ] 主题切换（浅色/深色）
- [ ] 语言切换（中文/英文）
- [ ] 通知设置
- [ ] 数据导入/导出
- [ ] 配置备份/恢复

### 阶段5: 高级功能测试

#### 5.1 系统托盘

- [ ] 最小化到托盘
- [ ] 托盘图标显示
- [ ] 右键菜单
  - [ ] 显示/隐藏窗口
  - [ ] 暂停/继续转发
  - [ ] 退出应用
- [ ] 双击托盘图标恢复窗口

#### 5.2 多账号并发

- [ ] 同时登录多个KOOK账号
- [ ] 每个账号独立连接
- [ ] 消息正确路由
- [ ] 账号故障隔离

#### 5.3 错误处理

- [ ] 网络断开自动重连
- [ ] API限流自动等待
- [ ] 登录失败重试
- [ ] 错误通知显示

#### 5.4 性能测试

- [ ] CPU使用率（空闲 < 5%）
- [ ] 内存使用（< 200MB）
- [ ] 消息转发延迟（< 2秒）
- [ ] 长时间稳定运行（24小时+）

### 阶段6: 兼容性测试

#### 6.1 Windows版本

- [ ] Windows 10 (21H2)
- [ ] Windows 10 (22H2)
- [ ] Windows 11 (21H2)
- [ ] Windows 11 (22H2)
- [ ] Windows 11 (23H2)

#### 6.2 显示分辨率

- [ ] 1920x1080 (100% DPI)
- [ ] 1920x1080 (125% DPI)
- [ ] 1920x1080 (150% DPI)
- [ ] 2560x1440
- [ ] 3840x2160 (4K)

#### 6.3 语言环境

- [ ] 简体中文
- [ ] 英文
- [ ] 其他语言（界面是否正常）

### 阶段7: 安全测试

- [ ] 配置文件加密
- [ ] 敏感信息不明文存储
- [ ] Token安全存储
- [ ] 网络连接HTTPS
- [ ] 防止SQL注入（如适用）

### 阶段8: 升级测试

- [ ] 检查更新功能
- [ ] 更新提示显示
- [ ] 下载更新
- [ ] 自动安装更新
- [ ] 配置迁移

---

## 🧪 自动化测试脚本

### 后端API测试

```python
# test_backend_api.py
import requests
import time

BASE_URL = "http://localhost:9527"

def test_health_check():
    """测试健康检查"""
    response = requests.get(f"{BASE_URL}/health")
    assert response.status_code == 200
    data = response.json()
    assert data["status"] == "healthy"
    print("✅ 健康检查通过")

def test_accounts_api():
    """测试账号API"""
    # 获取账号列表
    response = requests.get(f"{BASE_URL}/api/accounts")
    assert response.status_code == 200
    print("✅ 账号列表API正常")

def test_bots_api():
    """测试Bot API"""
    # 获取Bot列表
    response = requests.get(f"{BASE_URL}/api/bots")
    assert response.status_code == 200
    print("✅ Bot列表API正常")

def test_mappings_api():
    """测试映射API"""
    # 获取映射列表
    response = requests.get(f"{BASE_URL}/api/mappings")
    assert response.status_code == 200
    print("✅ 映射列表API正常")

if __name__ == "__main__":
    print("开始测试后端API...")
    try:
        test_health_check()
        test_accounts_api()
        test_bots_api()
        test_mappings_api()
        print("\n✅ 所有API测试通过！")
    except Exception as e:
        print(f"\n❌ 测试失败: {e}")
```

### 消息转发测试

```python
# test_message_forwarding.py
import time
import requests

def test_text_message():
    """测试文本消息转发"""
    # 模拟发送消息到KOOK
    # 验证消息是否正确转发到Discord/Telegram/飞书
    pass

def test_image_message():
    """测试图片消息转发"""
    # 测试单张/多张图片
    # 测试大图片压缩
    pass

def test_file_message():
    """测试文件消息转发"""
    # 测试小文件直接转发
    # 测试大文件URL转发
    pass
```

---

## 📊 测试报告模板

### 测试环境

```
操作系统: Windows 11 Pro 23H2
处理器: Intel Core i7-12700
内存: 16 GB
显示器: 1920x1080 @ 100% DPI
安装路径: C:\Program Files\KOOK消息转发系统
```

### 测试结果

| 测试项 | 结果 | 说明 |
|--------|------|------|
| 安装程序 | ✅/❌ | |
| 首次启动 | ✅/❌ | |
| 配置向导 | ✅/❌ | |
| 账号管理 | ✅/❌ | |
| Bot管理 | ✅/❌ | |
| 频道映射 | ✅/❌ | |
| 消息转发 | ✅/❌ | |
| 日志功能 | ✅/❌ | |
| 系统托盘 | ✅/❌ | |
| 性能表现 | ✅/❌ | |

### 发现的问题

1. **问题描述**
   - 严重程度: 高/中/低
   - 复现步骤: ...
   - 预期行为: ...
   - 实际行为: ...
   - 截图/日志: ...

### 测试结论

- [ ] ✅ 通过 - 可以发布
- [ ] ⚠️ 有问题但可接受 - 需要修复但不阻塞发布
- [ ] ❌ 未通过 - 需要修复后重新测试

---

## 🎯 快速测试步骤（15分钟）

### 基础功能验证

1. **安装测试** (2分钟)
   ```
   1. 下载安装包
   2. 双击运行
   3. 完成安装
   4. 检查桌面快捷方式
   ```

2. **启动测试** (1分钟)
   ```
   1. 双击快捷方式
   2. 等待应用启动
   3. 验证无错误
   ```

3. **向导测试** (5分钟)
   ```
   1. 添加一个KOOK账号
   2. 添加一个Discord Bot
   3. 创建一个映射规则
   4. 完成向导
   ```

4. **转发测试** (5分钟)
   ```
   1. 在KOOK频道发送消息
   2. 验证Discord收到消息
   3. 测试文本、图片、文件
   ```

5. **日志测试** (2分钟)
   ```
   1. 查看日志页面
   2. 验证有转发记录
   3. 检查无ERROR日志
   ```

---

## 🔍 详细测试指南

### 测试1: 安装程序完整测试

**目标**: 验证安装程序的所有功能

**步骤**:

1. **下载安装包**
   ```
   访问: https://github.com/gfchfjh/CSBJJWT/releases/tag/v1.14.0
   下载: KOOK消息转发系统 Setup 1.13.3.exe
   验证MD5: 31cf542f95f90b1964e8887825fbec17
   ```

2. **运行安装程序**
   ```
   双击.exe文件
   预期: 安装向导窗口出现
   ```

3. **选择安装路径**
   ```
   默认: C:\Program Files\KOOK消息转发系统
   可自定义: 选择其他路径
   预期: 路径选择器正常工作
   ```

4. **选择组件**
   ```
   桌面快捷方式: ✅
   开始菜单项: ✅
   预期: 选项可正常勾选/取消
   ```

5. **安装进度**
   ```
   预期: 进度条正常显示
   预期: 安装时间 < 2分钟
   ```

6. **安装完成**
   ```
   预期: 显示完成页面
   预期: 有"立即运行"选项
   预期: 桌面有快捷方式
   ```

### 测试2: 首次启动环境检查

**目标**: 验证环境自动检查功能

**步骤**:

1. **首次启动**
   ```
   双击桌面快捷方式
   预期: 应用启动，显示环境检查
   ```

2. **环境检查项**
   ```
   ✅ Python环境: 已内置
   ✅ Redis服务: 自动启动
   ✅ Playwright: 提示首次下载（约300MB）
   ✅ 数据目录: 自动创建
   ✅ 配置文件: 自动初始化
   ```

3. **Playwright下载**
   ```
   预期: 显示下载进度
   预期: 下载成功后自动继续
   预期: 下载失败有重试选项
   ```

4. **进入主界面**
   ```
   预期: 环境检查通过后显示配置向导
   ```

### 测试3: 配置向导完整测试

**目标**: 验证配置向导的所有步骤

**详细步骤文档**: 见上面的"阶段3: 首次启动测试"

### 测试4: 消息转发端到端测试

**目标**: 验证完整的消息转发流程

**准备工作**:
```
1. 一个KOOK账号（有权限的服务器和频道）
2. 一个Discord Webhook URL
3. 或一个Telegram Bot Token
```

**测试流程**:

1. **配置KOOK账号**
   ```
   1. 添加账号
   2. 登录验证
   3. 获取服务器列表
   4. 获取频道列表
   ```

2. **配置Discord Bot**
   ```
   1. 添加Bot
   2. 输入Webhook URL
   3. 测试连接
   4. 验证成功提示
   ```

3. **创建映射**
   ```
   1. 选择KOOK频道
   2. 选择Discord目标频道
   3. 保存映射
   ```

4. **测试转发**
   ```
   1. 在KOOK频道发送: "测试消息"
   2. 等待 1-2 秒
   3. 在Discord检查是否收到
   4. 验证消息内容正确
   ```

5. **测试图片**
   ```
   1. 在KOOK发送一张图片
   2. 验证Discord收到图片
   3. 验证图片可以打开
   ```

6. **测试文件**
   ```
   1. 在KOOK发送一个小文件（<8MB）
   2. 验证Discord收到文件
   3. 验证文件可以下载
   ```

---

## 📝 测试记录表

### 日期: ___________
### 测试人员: ___________
### 测试环境: ___________

| 序号 | 测试项 | 预期结果 | 实际结果 | 通过 | 备注 |
|------|--------|----------|----------|------|------|
| 1 | 安装程序启动 | 向导显示 | | ☐ | |
| 2 | 安装路径选择 | 可选择 | | ☐ | |
| 3 | 安装完成 | 无错误 | | ☐ | |
| 4 | 首次启动 | 应用打开 | | ☐ | |
| 5 | 环境检查 | 自动检查 | | ☐ | |
| 6 | 配置向导 | 5步完成 | | ☐ | |
| 7 | 账号添加 | 成功登录 | | ☐ | |
| 8 | Bot添加 | 连接成功 | | ☐ | |
| 9 | 映射创建 | 规则生效 | | ☐ | |
| 10 | 文本转发 | 消息送达 | | ☐ | |
| 11 | 图片转发 | 图片送达 | | ☐ | |
| 12 | 文件转发 | 文件送达 | | ☐ | |
| 13 | 日志查看 | 日志显示 | | ☐ | |
| 14 | 托盘功能 | 正常工作 | | ☐ | |
| 15 | 长时间运行 | 稳定运行 | | ☐ | |

---

## 🚨 已知问题和注意事项

### 首次运行

1. **Playwright浏览器下载**
   - 首次运行需要下载Chromium（约300MB）
   - 需要稳定的网络连接
   - 下载时间: 5-10分钟（取决于网速）

2. **Windows Defender可能阻止**
   - 首次运行可能被Windows Defender阻止
   - 解决: 点击"更多信息" → "仍要运行"

3. **防火墙提示**
   - 应用需要网络权限
   - 解决: 允许专用网络和公用网络访问

### 性能相关

1. **内存使用**
   - 空闲: 约150-200MB
   - 活跃转发: 约250-350MB
   - 这是正常的Electron应用范围

2. **CPU使用**
   - 空闲: < 1%
   - 转发消息: 5-10%（短暂）
   - 长时间高CPU可能是问题

---

## ✅ 推荐的测试优先级

### P0 - 核心功能（必须通过）

1. 安装程序可以正常安装
2. 应用可以正常启动
3. 可以添加KOOK账号
4. 可以添加转发Bot
5. 可以创建映射规则
6. 文本消息可以正常转发

### P1 - 重要功能（应该通过）

7. 图片消息可以转发
8. 文件消息可以转发
9. 日志可以正常查看
10. 配置可以保存和加载
11. 系统托盘正常工作

### P2 - 增强功能（最好通过）

12. 多账号并发
13. 消息去重
14. 速率限制
15. 错误恢复
16. 性能优化

---

## 🎯 测试完成标准

### 最低标准（可以发布）

- ✅ 所有P0测试通过
- ✅ 80%以上P1测试通过
- ⚠️ 无严重崩溃或数据丢失问题

### 推荐标准（建议达到）

- ✅ 所有P0测试通过
- ✅ 所有P1测试通过
- ✅ 70%以上P2测试通过
- ✅ 无中等以上severity问题

### 优秀标准（高质量发布）

- ✅ 所有P0、P1、P2测试通过
- ✅ 性能指标达标
- ✅ 用户体验良好
- ✅ 无已知问题

---

<div align="center">

# 📞 需要帮助？

如果在测试过程中遇到问题：

1. **查看日志**: 应用内日志页面
2. **查看文件日志**: `%APPDATA%\KOOK消息转发系统\logs\`
3. **提交Issue**: https://github.com/gfchfjh/CSBJJWT/issues
4. **查看文档**: https://github.com/gfchfjh/CSBJJWT/tree/main/docs

---

**测试愉快！** 🎉

</div>
