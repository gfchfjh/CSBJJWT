# KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - æ·±åº¦ä¼˜åŒ–åˆ†ææŠ¥å‘Š

**é¡¹ç›®ä»“åº“**: https://github.com/gfchfjh/CSBJJWT.git  
**å½“å‰ç‰ˆæœ¬**: 10.0.0 Ultimate Edition  
**åˆ†ææ—¥æœŸ**: 2025-10-28  
**ç›®æ ‡**: ä»æŠ€æœ¯å·¥å…·è½¬å˜ä¸ºçœŸæ­£çš„"å¤§ä¼—è½¯ä»¶"

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬ç³»ç»Ÿå½“å‰å·²å®ç°å¤§é‡åŠŸèƒ½ï¼ˆ10.0ç‰ˆæœ¬ï¼‰ï¼Œä½†ä¸éœ€æ±‚æ–‡æ¡£ä¸­çš„"ä¸€é”®å®‰è£…ã€å›¾å½¢åŒ–æ“ä½œã€é›¶ä»£ç åŸºç¡€å¯ç”¨"çš„ç›®æ ‡ä»æœ‰è¾ƒå¤§å·®è·ã€‚ç»è¿‡æ·±åº¦ä»£ç åˆ†æï¼Œå‘ç°ä»¥ä¸‹**æ ¸å¿ƒé—®é¢˜**ï¼š

1. **æ˜“ç”¨æ€§ä¸è¶³** - é…ç½®æµç¨‹å¤æ‚ï¼Œç”¨æˆ·éœ€è¦ç†è§£æŠ€æœ¯ç»†èŠ‚
2. **å®‰è£…ä½“éªŒå·®** - ç¼ºå°‘çœŸæ­£çš„ä¸€é”®å®‰è£…åŒ…ï¼Œç”¨æˆ·éœ€è¦æ‰‹åŠ¨é…ç½®ç¯å¢ƒ
3. **é”™è¯¯æç¤ºä¸å‹å¥½** - æŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯è®©æ™®é€šç”¨æˆ·æ— æ‰€é€‚ä»
4. **æ–‡æ¡£ä¸å®Œæ•´** - ç¼ºå°‘å®Œæ•´çš„å›¾æ–‡/è§†é¢‘æ•™ç¨‹ä½“ç³»
5. **ç•Œé¢è®¾è®¡åæŠ€æœ¯** - ç•Œé¢æœ¯è¯­ä¸“ä¸šåŒ–ï¼Œç¼ºå°‘å¼•å¯¼å’Œæç¤º

---

## ğŸ¯ éœ€æ±‚æ–‡æ¡£æ ¸å¿ƒè¦æ±‚å›é¡¾

### ç›®æ ‡å®šä½
- **é¢å‘æ™®é€šç”¨æˆ·çš„å‚»ç“œå¼å·¥å…·** âŒ å½“å‰åæŠ€æœ¯ç”¨æˆ·
- **æ— éœ€ç¼–ç¨‹çŸ¥è¯†ï¼Œä¸‹è½½å³ç”¨** âŒ ä»éœ€é…ç½®Pythonã€Node.jsç­‰
- **é›¶ä»£ç åŸºç¡€å¯ç”¨** âš ï¸ éƒ¨åˆ†å®ç°ï¼Œä½†ä¸å¤Ÿå½»åº•

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. âœ… **ä¸€é”®å®‰è£…åŒ…** - éƒ¨åˆ†å®ç°ï¼Œä½†ä¸å®Œæ•´
2. âš ï¸ **é¦–æ¬¡å¯åŠ¨é…ç½®å‘å¯¼** - æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œä½†ä¸å¤Ÿç»Ÿä¸€
3. âœ… **å›¾å½¢åŒ–ç•Œé¢** - å·²å®ç°
4. âŒ **æ™ºèƒ½é»˜è®¤é…ç½®** - ç¼ºå¤±
5. âœ… **ä¸­æ–‡ç•Œé¢** - å·²å®ç°

---

## ğŸ”´ P0çº§ä¼˜åŒ–ï¼ˆæ ¸å¿ƒå¿…å¤‡åŠŸèƒ½ï¼‰- å½±å“ç”¨æˆ·èƒ½å¦ä½¿ç”¨

### P0-1: çœŸæ­£çš„ä¸€é”®å®‰è£…åŒ… ã€ä¸¥é‡ã€‘

**ç°çŠ¶é—®é¢˜**:
```
âŒ è™½æœ‰build_installer_ultimate.pyï¼Œä½†åŠŸèƒ½ä¸å®Œæ•´
âŒ éœ€è¦ç”¨æˆ·é¢„å…ˆå®‰è£…Python 3.11+ã€Node.jsã€Redisç­‰
âŒ æ‰“åŒ…è„šæœ¬ä»…æœ‰æ¡†æ¶ï¼Œç¼ºå°‘å®é™…ä¸‹è½½å’Œé›†æˆé€»è¾‘
âŒ æ²¡æœ‰è‡ªåŠ¨å¯åŠ¨å’Œè‡ªæ£€æœºåˆ¶
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚æ–‡æ¡£è¦æ±‚:
  - Windows: åŒå‡».exeå³ç”¨
  - macOS: æ‹–æ‹½.dmgå®‰è£…
  - Linux: è¿è¡Œ.AppImage
  - æ— éœ€å®‰è£…ä»»ä½•ä¾èµ–
  
å½“å‰å®ç°:
  - æœ‰åŸºç¡€æ‰“åŒ…è„šæœ¬
  - ä½†Redisã€Chromiumç­‰æœªçœŸæ­£é›†æˆ
  - Pythonè¿è¡Œæ—¶æœªåµŒå…¥
  - NSIS/DMGé…ç½®ä¸å®Œæ•´
```

**å½±å“èŒƒå›´**: ğŸ”´ **æé«˜** - ç›´æ¥å½±å“90%æ™®é€šç”¨æˆ·èƒ½å¦ä½¿ç”¨

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# éœ€è¦å®ç°çš„å…³é”®åŠŸèƒ½
1. åµŒå…¥Python 3.11è¿è¡Œæ—¶ï¼ˆä½¿ç”¨PyInstaller --onefileï¼‰
2. é›†æˆRedisæœåŠ¡ï¼ˆWindows: redis-server.exe, Linux: ç¼–è¯‘ç‰ˆï¼‰
3. è‡ªåŠ¨ä¸‹è½½å¹¶åµŒå…¥Chromiumï¼ˆplaywright install chromiumï¼‰
4. åˆ›å»ºä¸“ä¸šçš„NSISå®‰è£…ç¨‹åºï¼ˆå¸¦å¸è½½åŠŸèƒ½ï¼‰
5. macOSç­¾åå’Œå…¬è¯ï¼ˆé˜²æ­¢"æ— æ³•æ‰“å¼€"è­¦å‘Šï¼‰
6. Linux AppImageè‡ªåŒ…å«ï¼ˆå«glibcä¾èµ–ï¼‰
7. é¦–æ¬¡å¯åŠ¨è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
```

**ä¼˜å…ˆçº§**: ğŸ”´ **P0 - å¿…é¡»ç«‹å³å¤„ç†**

**é¢„è®¡å·¥ä½œé‡**: 5-7å¤©

---

### P0-2: ç»Ÿä¸€çš„3æ­¥é…ç½®å‘å¯¼ ã€ä¸¥é‡ã€‘

**ç°çŠ¶é—®é¢˜**:
```
âš ï¸ å½“å‰å­˜åœ¨å¤šä¸ªé…ç½®å‘å¯¼ç‰ˆæœ¬:
   - Wizard.vue
   - Wizard3StepsFinal.vue
   - WizardQuick3Steps.vue
   - WizardUltimate3Steps.vue
   - WizardUnified.vue
   
âŒ ç‰ˆæœ¬æ··ä¹±ï¼ŒåŠŸèƒ½é‡å¤ï¼Œç”¨æˆ·ä¸çŸ¥é“ç”¨å“ªä¸ª
âŒ æ²¡æœ‰ç»Ÿä¸€çš„é¦–æ¬¡å¯åŠ¨æ£€æµ‹é€»è¾‘
âŒ å‘å¯¼ä¸å¤Ÿ"å‚»ç“œå¼"ï¼Œä»éœ€ç”¨æˆ·ç†è§£æŠ€æœ¯æ¦‚å¿µ
```

**éœ€æ±‚å¯¹æ¯”**:
```
éœ€æ±‚æ–‡æ¡£è¦æ±‚çš„3æ­¥æµç¨‹:
  æ­¥éª¤1: ç™»å½•KOOK (1åˆ†é’Ÿ) - æ”¯æŒChromeæ‰©å±•ä¸€é”®å¯¼å‡º
  æ­¥éª¤2: é…ç½®Bot (2åˆ†é’Ÿ) - ä¸€é”®æµ‹è¯•è¿æ¥
  æ­¥éª¤3: æ™ºèƒ½æ˜ å°„ (2åˆ†é’Ÿ) - AIæ¨èé¢‘é“æ˜ å°„
  
å½“å‰å®ç°:
  - æœ‰å¤šä¸ªå‘å¯¼ï¼Œä½†éƒ½ä¸å®Œæ•´
  - ç¼ºå°‘æ™ºèƒ½æ˜ å°„æ¨è
  - Cookieå¯¼å…¥æµç¨‹å¤æ‚
  - æ²¡æœ‰è¿›åº¦è¿½è¸ªå’Œä¿å­˜æœºåˆ¶
```

**å½±å“èŒƒå›´**: ğŸ”´ **æé«˜** - æ–°æ‰‹é…ç½®æˆåŠŸç‡ä½ï¼Œæ”¾å¼ƒç‡é«˜

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```vue
<!-- éœ€è¦åˆ›å»º: ConfigWizardUnified.vue -->
<template>
  <el-dialog 
    :model-value="true" 
    :close-on-click-modal="false"
    :close-on-press-escape="false"
    :show-close="false"
    fullscreen
  >
    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <el-steps :active="currentStep" finish-status="success">
      <el-step title="ç™»å½•KOOK" icon="User" />
      <el-step title="é…ç½®Bot" icon="Robot" />
      <el-step title="æ™ºèƒ½æ˜ å°„" icon="Connection" />
    </el-steps>
    
    <!-- æ­¥éª¤1: ç™»å½•KOOK -->
    <div v-if="currentStep === 1">
      <h2>ğŸ“§ ç¬¬1æ­¥ï¼šç™»å½•KOOKè´¦å·</h2>
      <el-tabs v-model="loginMethod">
        <el-tab-pane label="Chromeæ‰©å±•ï¼ˆæ¨èï¼‰" name="extension">
          <ol>
            <li>å®‰è£…Chromeæ‰©å±•ï¼ˆç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è‡ªåŠ¨å®‰è£…ï¼‰</li>
            <li>è®¿é—®KOOKå¹¶ç™»å½•</li>
            <li>ç‚¹å‡»æ‰©å±•å›¾æ ‡ï¼Œä¸€é”®å¯¼å‡ºCookie</li>
            <li>è¿”å›æ­¤å¤„ï¼Œè‡ªåŠ¨æ£€æµ‹åˆ°Cookie</li>
          </ol>
          <el-button @click="installExtension">å®‰è£…Chromeæ‰©å±•</el-button>
          <el-alert v-if="cookieDetected" type="success">
            âœ… æ£€æµ‹åˆ°Cookieï¼Œç‚¹å‡»"ä¸‹ä¸€æ­¥"ç»§ç»­
          </el-alert>
        </el-tab-pane>
        
        <el-tab-pane label="è´¦å·å¯†ç " name="password">
          <el-form>
            <el-form-item label="é‚®ç®±">
              <el-input v-model="email" placeholder="your@email.com" />
            </el-form-item>
            <el-form-item label="å¯†ç ">
              <el-input v-model="password" type="password" show-password />
            </el-form-item>
          </el-form>
        </el-tab-pane>
      </el-tabs>
      
      <el-button type="primary" @click="nextStep" :disabled="!canProceed">
        ä¸‹ä¸€æ­¥ â†’
      </el-button>
    </div>
    
    <!-- æ­¥éª¤2: é…ç½®Botï¼ˆç±»ä¼¼ç»“æ„ï¼‰-->
    <!-- æ­¥éª¤3: æ™ºèƒ½æ˜ å°„ï¼ˆç±»ä¼¼ç»“æ„ï¼‰-->
  </el-dialog>
</template>

<script setup>
// æ ¸å¿ƒé€»è¾‘ï¼š
// 1. é¦–æ¬¡å¯åŠ¨æ£€æµ‹ï¼ˆæ£€æŸ¥system_configè¡¨çš„wizard_completedæ ‡å¿—ï¼‰
// 2. æ­¥éª¤ä¹‹é—´çš„è¿›åº¦ä¿å­˜ï¼ˆæ”¯æŒä¸­é€”é€€å‡ºï¼Œä¸‹æ¬¡ç»§ç»­ï¼‰
// 3. å®æ—¶éªŒè¯ï¼ˆæ¯æ­¥å®ŒæˆåéªŒè¯é…ç½®æœ‰æ•ˆæ€§ï¼‰
// 4. AIæ™ºèƒ½æ˜ å°„æ¨èï¼ˆåŸºäºé¢‘é“åç§°ç›¸ä¼¼åº¦ï¼‰
</script>
```

**ä¼˜å…ˆçº§**: ğŸ”´ **P0 - å¿…é¡»ç«‹å³å¤„ç†**

**é¢„è®¡å·¥ä½œé‡**: 3-5å¤©

---

### P0-3: Chromeæ‰©å±•v2.0å¢å¼º ã€é‡è¦ã€‘

**ç°çŠ¶é—®é¢˜**:
```
âœ… å·²æœ‰Chromeæ‰©å±•ï¼ˆchrome-extension/ç›®å½•ï¼‰
âš ï¸ ä½†åŠŸèƒ½ç®€é™‹ï¼Œç¼ºå°‘éœ€æ±‚æ–‡æ¡£ä¸­çš„å¢å¼ºåŠŸèƒ½
âŒ æ²¡æœ‰åŒåŸŸåCookieè·å–
âŒ æ²¡æœ‰æ™ºèƒ½éªŒè¯å…³é”®Cookie
âŒ æ²¡æœ‰æ£€æµ‹è½¬å‘ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
âŒ ç•Œé¢è¿‡äºç®€å•
```

**éœ€æ±‚å¯¹æ¯”**:
```javascript
// éœ€æ±‚æ–‡æ¡£è¦æ±‚:
âœ… åŒåŸŸåCookieè·å–ï¼ˆkookapp.cn + www.kookapp.cnï¼‰
âœ… æ™ºèƒ½éªŒè¯å…³é”®Cookieï¼ˆtoken/sessionç­‰ï¼‰
âœ… æ£€æµ‹è½¬å‘ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
âœ… ç¾åŒ–ç•Œé¢ï¼ˆæ¸å˜èƒŒæ™¯ã€åŠ è½½åŠ¨ç”»ï¼‰
âœ… å¿«æ·é”®æ”¯æŒï¼ˆCtrl+Shift+Kï¼‰
âœ… Cookieè¯¦æƒ…æŸ¥çœ‹
âœ… é”™è¯¯é‡è¯•æœºåˆ¶

// å½“å‰chrome-extension/popup.jså®ç°:
âŒ ä»…ä»å•ä¸€åŸŸåè·å–Cookie
âŒ æ²¡æœ‰CookieéªŒè¯é€»è¾‘
âŒ æ²¡æœ‰ä¸ä¸»ç¨‹åºé€šä¿¡
âŒ ç•Œé¢æ˜¯çº¯HTMLæ— æ ·å¼
```

**å½±å“èŒƒå›´**: ğŸŸ¡ **é«˜** - å½±å“Cookieå¯¼å…¥çš„æˆåŠŸç‡å’Œç”¨æˆ·ä½“éªŒ

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```javascript
// chrome-extension/popup_v2.js
class KookCookieExporterV2 {
  constructor() {
    this.domains = [
      'https://www.kookapp.cn',
      'https://kookapp.cn',
      'https://*.kaiheila.cn'
    ];
    this.requiredCookies = ['token', 'session_id', 'user_id'];
    this.systemUrl = 'http://localhost:9527'; // æ£€æµ‹ä¸»ç¨‹åº
  }
  
  async exportCookies() {
    // 1. ä»å¤šä¸ªåŸŸåè·å–Cookie
    const allCookies = [];
    for (const domain of this.domains) {
      const cookies = await chrome.cookies.getAll({ domain });
      allCookies.push(...cookies);
    }
    
    // 2. éªŒè¯å…³é”®Cookie
    const validation = this.validateCookies(allCookies);
    if (!validation.valid) {
      throw new Error(`ç¼ºå°‘å…³é”®Cookie: ${validation.missing.join(', ')}`);
    }
    
    // 3. æ£€æµ‹ä¸»ç¨‹åºçŠ¶æ€
    const systemRunning = await this.checkSystemStatus();
    
    // 4. æ ¼å¼åŒ–å¹¶å¤åˆ¶åˆ°å‰ªè´´æ¿
    const formatted = JSON.stringify(allCookies, null, 2);
    await navigator.clipboard.writeText(formatted);
    
    // 5. å¦‚æœä¸»ç¨‹åºåœ¨è¿è¡Œï¼Œç›´æ¥å‘é€è¿‡å»
    if (systemRunning) {
      await this.sendToSystem(allCookies);
    }
    
    return {
      success: true,
      count: allCookies.length,
      systemDetected: systemRunning
    };
  }
  
  validateCookies(cookies) {
    const cookieNames = cookies.map(c => c.name);
    const missing = this.requiredCookies.filter(
      name => !cookieNames.includes(name)
    );
    
    return {
      valid: missing.length === 0,
      missing,
      total: cookies.length
    };
  }
  
  async checkSystemStatus() {
    try {
      const response = await fetch(`${this.systemUrl}/health`);
      return response.ok;
    } catch {
      return false;
    }
  }
  
  async sendToSystem(cookies) {
    await fetch(`${this.systemUrl}/api/accounts/import-cookies`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ cookies })
    });
  }
}
```

```css
/* chrome-extension/popup_v2.css - ç¾åŒ–ç•Œé¢ */
body {
  width: 400px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  padding: 20px;
}

.export-btn {
  width: 100%;
  padding: 15px;
  background: rgba(255,255,255,0.2);
  border: 2px solid white;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.export-btn:hover {
  background: rgba(255,255,255,0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.2);
}

/* åŠ è½½åŠ¨ç”» */
@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading {
  border: 3px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **P0 - é‡è¦**

**é¢„è®¡å·¥ä½œé‡**: 2-3å¤©

---

### P0-4: å›¾åºŠTokenå®‰å…¨æœºåˆ¶å¢å¼º ã€å®‰å…¨ã€‘

**ç°çŠ¶é—®é¢˜**:
```python
# backend/app/image_server.py (å‡è®¾å½“å‰å®ç°)
@app.get("/images/{filename}")
async def serve_image(filename: str):
    # âŒ é—®é¢˜1: æ²¡æœ‰TokenéªŒè¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥è®¿é—®
    # âŒ é—®é¢˜2: æ²¡æœ‰é˜²ç›—é“¾æ£€æŸ¥
    # âŒ é—®é¢˜3: æ²¡æœ‰è¿‡æœŸæ—¶é—´é™åˆ¶
    # âŒ é—®é¢˜4: å¯èƒ½å­˜åœ¨è·¯å¾„éå†æ¼æ´
    
    file_path = IMAGE_DIR / filename
    return FileResponse(file_path)
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚æ–‡æ¡£è¦æ±‚:
  Tokenç³»ç»Ÿ:
    - 32å­—èŠ‚URLå®‰å…¨Token
    - 2å°æ—¶æœ‰æ•ˆæœŸ
    - Tokenä¸å›¾ç‰‡åç§°ç»‘å®šéªŒè¯
    - æ¯15åˆ†é’Ÿè‡ªåŠ¨æ¸…ç†è¿‡æœŸToken
    
  å®‰å…¨ç‰¹æ€§:
    - é˜²æ­¢è·¯å¾„éå†æ”»å‡»
    - å®‰å…¨HTTPå“åº”å¤´
    - ä»…å…è®¸æœ¬åœ°è®¿é—®
    
  è‡ªåŠ¨æ¸…ç†:
    - æ¯å¤©æ¸…ç†7å¤©å‰çš„æ—§å›¾
    - ç£ç›˜ç©ºé—´è¶…é™æ—¶è‡ªåŠ¨ä¼˜åŒ–
```

**å½±å“èŒƒå›´**: ğŸ”´ **æé«˜** - å®‰å…¨æ¼æ´ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# backend/app/image_server_secure.py
import secrets
import time
from fastapi import HTTPException, Request
from fastapi.responses import FileResponse
from pathlib import Path
from typing import Dict, Optional
import asyncio

class SecureImageServer:
    """å®‰å…¨çš„å›¾åºŠæœåŠ¡å™¨"""
    
    def __init__(self):
        self.tokens: Dict[str, dict] = {}  # {token: {filename, expires_at}}
        self.token_lifetime = 7200  # 2å°æ—¶
        
        # å¯åŠ¨æ¸…ç†ä»»åŠ¡
        asyncio.create_task(self.cleanup_expired_tokens())
        asyncio.create_task(self.cleanup_old_images())
    
    def generate_token(self, filename: str) -> str:
        """ç”Ÿæˆå®‰å…¨Token"""
        token = secrets.token_urlsafe(32)
        self.tokens[token] = {
            'filename': filename,
            'expires_at': time.time() + self.token_lifetime,
            'created_at': time.time()
        }
        return token
    
    def validate_token(self, token: str, filename: str) -> bool:
        """éªŒè¯Token"""
        if token not in self.tokens:
            return False
        
        token_data = self.tokens[token]
        
        # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        if time.time() > token_data['expires_at']:
            del self.tokens[token]
            return False
        
        # æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦åŒ¹é…
        if token_data['filename'] != filename:
            return False
        
        return True
    
    async def serve_image(self, filename: str, token: str, request: Request):
        """æä¾›å›¾ç‰‡æœåŠ¡ï¼ˆå¸¦å®‰å…¨æ£€æŸ¥ï¼‰"""
        
        # 1. ä»…å…è®¸æœ¬åœ°è®¿é—®
        client_host = request.client.host
        if client_host not in ['127.0.0.1', 'localhost', '::1']:
            raise HTTPException(403, "ä»…å…è®¸æœ¬åœ°è®¿é—®")
        
        # 2. éªŒè¯Token
        if not self.validate_token(token, filename):
            raise HTTPException(403, "Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ")
        
        # 3. é˜²æ­¢è·¯å¾„éå†
        if '..' in filename or filename.startswith('/'):
            raise HTTPException(400, "éæ³•æ–‡ä»¶å")
        
        # 4. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        file_path = IMAGE_DIR / filename
        if not file_path.exists() or not file_path.is_file():
            raise HTTPException(404, "æ–‡ä»¶ä¸å­˜åœ¨")
        
        # 5. è®¾ç½®å®‰å…¨å“åº”å¤´
        headers = {
            'X-Content-Type-Options': 'nosniff',
            'X-Frame-Options': 'DENY',
            'Cache-Control': 'private, max-age=7200',
            'Content-Security-Policy': "default-src 'none'"
        }
        
        return FileResponse(file_path, headers=headers)
    
    async def cleanup_expired_tokens(self):
        """æ¯15åˆ†é’Ÿæ¸…ç†è¿‡æœŸToken"""
        while True:
            await asyncio.sleep(900)  # 15åˆ†é’Ÿ
            
            current_time = time.time()
            expired = [
                token for token, data in self.tokens.items()
                if current_time > data['expires_at']
            ]
            
            for token in expired:
                del self.tokens[token]
            
            if expired:
                logger.info(f"æ¸…ç†äº†{len(expired)}ä¸ªè¿‡æœŸToken")
    
    async def cleanup_old_images(self):
        """æ¯å¤©æ¸…ç†æ—§å›¾ç‰‡"""
        while True:
            await asyncio.sleep(86400)  # 24å°æ—¶
            
            # åˆ é™¤7å¤©å‰çš„å›¾ç‰‡
            cutoff_time = time.time() - (7 * 86400)
            deleted_count = 0
            
            for image_file in IMAGE_DIR.glob('*.jpg'):
                if image_file.stat().st_mtime < cutoff_time:
                    image_file.unlink()
                    deleted_count += 1
            
            logger.info(f"æ¸…ç†äº†{deleted_count}å¼ æ—§å›¾ç‰‡")
            
            # æ£€æŸ¥ç£ç›˜ç©ºé—´
            await self.check_disk_space()
    
    async def check_disk_space(self):
        """æ£€æŸ¥ç£ç›˜ç©ºé—´å¹¶æ¸…ç†"""
        import shutil
        
        # è®¡ç®—IMAGE_DIRå ç”¨ç©ºé—´
        total_size = sum(
            f.stat().st_size for f in IMAGE_DIR.glob('**/*') 
            if f.is_file()
        ) / (1024**3)  # GB
        
        max_size = settings.image_max_size_gb
        
        if total_size > max_size:
            logger.warning(f"å›¾ç‰‡å ç”¨ç©ºé—´è¶…é™: {total_size:.2f}GB > {max_size}GB")
            
            # æŒ‰æ—¶é—´æ’åºï¼Œåˆ é™¤æœ€æ—§çš„å›¾ç‰‡
            files = sorted(
                IMAGE_DIR.glob('*.jpg'),
                key=lambda f: f.stat().st_mtime
            )
            
            # åˆ é™¤æœ€æ—§çš„20%
            to_delete = int(len(files) * 0.2)
            for f in files[:to_delete]:
                f.unlink()
            
            logger.info(f"æ¸…ç†äº†{to_delete}å¼ æ—§å›¾ç‰‡ä»¥é‡Šæ”¾ç©ºé—´")

# ä½¿ç”¨ç¤ºä¾‹
secure_server = SecureImageServer()

@app.post("/api/images/upload")
async def upload_image(file: UploadFile):
    """ä¸Šä¼ å›¾ç‰‡å¹¶è¿”å›å¸¦Tokençš„URL"""
    filename = f"{uuid.uuid4()}.jpg"
    file_path = IMAGE_DIR / filename
    
    # ä¿å­˜æ–‡ä»¶
    with open(file_path, 'wb') as f:
        f.write(await file.read())
    
    # ç”ŸæˆToken
    token = secure_server.generate_token(filename)
    
    # è¿”å›å¸¦Tokençš„URL
    url = f"http://localhost:9528/images/{filename}?token={token}"
    
    return {
        'url': url,
        'expires_in': secure_server.token_lifetime
    }

@app.get("/images/{filename}")
async def serve_image(filename: str, token: str, request: Request):
    """æä¾›å›¾ç‰‡ï¼ˆéœ€è¦Tokenï¼‰"""
    return await secure_server.serve_image(filename, token, request)
```

**ä¼˜å…ˆçº§**: ğŸ”´ **P0 - å®‰å…¨é—®é¢˜å¿…é¡»å¤„ç†**

**é¢„è®¡å·¥ä½œé‡**: 2å¤©

---

### P0-5: ç¯å¢ƒæ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤ ã€å¯ç”¨æ€§ã€‘

**ç°çŠ¶é—®é¢˜**:
```python
# backend/app/main.pyä¸­æœ‰ç¯å¢ƒæ£€æŸ¥ï¼Œä½†ä¸å®Œæ•´
async def check_environment():
    """âœ… v1.13.0æ–°å¢ï¼šç¯å¢ƒæ£€æŸ¥ï¼ˆP0-5ä¼˜åŒ–ï¼‰"""
    env_ok = await check_environment()
    if not env_ok:
        logger.warning("âš ï¸ ç¯å¢ƒæ£€æŸ¥å‘ç°ä¸¥é‡é—®é¢˜")
    # âŒ ä»…è®°å½•è­¦å‘Šï¼Œæ²¡æœ‰è‡ªåŠ¨ä¿®å¤
    # âŒ æ²¡æœ‰å¹¶å‘æ£€æµ‹ï¼Œé€Ÿåº¦æ…¢
    # âŒ æ²¡æœ‰å‹å¥½çš„å‰ç«¯ç•Œé¢
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚æ–‡æ¡£è¦æ±‚:
  6é¡¹å¹¶å‘æ£€æµ‹ï¼ˆ5-10ç§’å®Œæˆï¼‰:
    âœ… Pythonç‰ˆæœ¬ï¼ˆ3.11+ï¼‰
    âœ… Chromiumæµè§ˆå™¨
    âœ… RedisæœåŠ¡
    âœ… ç½‘ç»œè¿æ¥ï¼ˆ3ä¸ªæµ‹è¯•ç‚¹ï¼‰
    âœ… ç«¯å£å¯ç”¨æ€§ï¼ˆ9527/6379/9528ï¼‰
    âœ… ç£ç›˜ç©ºé—´ï¼ˆè‡³å°‘5GBï¼‰
  
  ä¸€é”®è‡ªåŠ¨ä¿®å¤:
    âœ… è‡ªåŠ¨å®‰è£…Chromium
    âœ… è‡ªåŠ¨å¯åŠ¨Redis
    âœ… è‡ªåŠ¨killå ç”¨ç«¯å£çš„è¿›ç¨‹
    âœ… è¯¦ç»†é”™è¯¯æç¤ºå’Œè§£å†³æ–¹æ¡ˆ
```

**å½±å“èŒƒå›´**: ğŸŸ¡ **é«˜** - å½±å“é¦–æ¬¡å¯åŠ¨ä½“éªŒå’Œé—®é¢˜æ’æŸ¥

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# backend/app/utils/environment_checker.py
import asyncio
import sys
import shutil
import psutil
from typing import Dict, List, Tuple
from pathlib import Path

class EnvironmentChecker:
    """ç¯å¢ƒæ£€æµ‹å™¨ï¼ˆå¹¶å‘ä¼˜åŒ–ç‰ˆï¼‰"""
    
    async def check_all_concurrent(self) -> Dict[str, dict]:
        """å¹¶å‘æ£€æŸ¥æ‰€æœ‰ç¯å¢ƒï¼ˆ5-10ç§’å®Œæˆï¼‰"""
        start_time = time.time()
        
        # å¹¶å‘æ‰§è¡Œæ‰€æœ‰æ£€æŸ¥
        results = await asyncio.gather(
            self.check_python_version(),
            self.check_chromium(),
            self.check_redis(),
            self.check_network(),
            self.check_ports(),
            self.check_disk_space(),
            return_exceptions=True
        )
        
        elapsed = time.time() - start_time
        
        # æ•´ç†ç»“æœ
        checks = {
            'python': results[0],
            'chromium': results[1],
            'redis': results[2],
            'network': results[3],
            'ports': results[4],
            'disk': results[5],
            'elapsed': elapsed,
            'all_passed': all(r['passed'] for r in results if isinstance(r, dict))
        }
        
        return checks
    
    async def check_python_version(self) -> dict:
        """æ£€æŸ¥Pythonç‰ˆæœ¬"""
        version = sys.version_info
        required = (3, 11)
        
        passed = version >= required
        
        return {
            'name': 'Pythonç‰ˆæœ¬',
            'passed': passed,
            'current': f"{version.major}.{version.minor}.{version.micro}",
            'required': f"{required[0]}.{required[1]}+",
            'fix_available': False,
            'fix_command': None,
            'message': 'âœ… Pythonç‰ˆæœ¬ç¬¦åˆè¦æ±‚' if passed else 
                      'âŒ Pythonç‰ˆæœ¬è¿‡ä½ï¼Œè¯·å‡çº§åˆ°3.11+'
        }
    
    async def check_chromium(self) -> dict:
        """æ£€æŸ¥Chromiumæµè§ˆå™¨"""
        try:
            from playwright.async_api import async_playwright
            
            p = await async_playwright().start()
            browsers = p.chromium
            
            # å°è¯•å¯åŠ¨æµè§ˆå™¨ï¼ˆæµ‹è¯•ï¼‰
            browser = await browsers.launch(headless=True)
            await browser.close()
            await p.stop()
            
            return {
                'name': 'Chromiumæµè§ˆå™¨',
                'passed': True,
                'message': 'âœ… Chromiumå·²å®‰è£…ä¸”å¯ç”¨',
                'fix_available': False
            }
            
        except Exception as e:
            return {
                'name': 'Chromiumæµè§ˆå™¨',
                'passed': False,
                'message': f'âŒ Chromiumæœªå®‰è£…æˆ–ä¸å¯ç”¨: {str(e)}',
                'fix_available': True,
                'fix_command': 'playwright install chromium'
            }
    
    async def check_redis(self) -> dict:
        """æ£€æŸ¥RedisæœåŠ¡"""
        try:
            import redis.asyncio as aioredis
            
            r = await aioredis.from_url('redis://localhost:6379')
            await r.ping()
            await r.close()
            
            return {
                'name': 'RedisæœåŠ¡',
                'passed': True,
                'message': 'âœ… RedisæœåŠ¡è¿è¡Œæ­£å¸¸',
                'fix_available': False
            }
            
        except Exception as e:
            return {
                'name': 'RedisæœåŠ¡',
                'passed': False,
                'message': f'âŒ Redisè¿æ¥å¤±è´¥: {str(e)}',
                'fix_available': True,
                'fix_command': 'auto_start_redis'
            }
    
    async def check_network(self) -> dict:
        """æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆ3ä¸ªæµ‹è¯•ç‚¹ï¼‰"""
        test_urls = [
            'https://www.kookapp.cn',
            'https://discord.com',
            'https://api.telegram.org'
        ]
        
        results = []
        for url in test_urls:
            try:
                async with aiohttp.ClientSession() as session:
                    async with session.get(url, timeout=5) as resp:
                        results.append(resp.status == 200)
            except:
                results.append(False)
        
        passed_count = sum(results)
        
        return {
            'name': 'ç½‘ç»œè¿æ¥',
            'passed': passed_count >= 2,  # è‡³å°‘2ä¸ªå¯ç”¨
            'message': f'âœ… ç½‘ç»œæ­£å¸¸ ({passed_count}/3å¯è¾¾)' if passed_count >= 2
                      else f'âš ï¸ ç½‘ç»œä¸ç¨³å®š ({passed_count}/3å¯è¾¾)',
            'details': dict(zip(test_urls, results)),
            'fix_available': False
        }
    
    async def check_ports(self) -> dict:
        """æ£€æŸ¥ç«¯å£å¯ç”¨æ€§"""
        required_ports = [9527, 6379, 9528]
        occupied = []
        
        for port in required_ports:
            if self._is_port_in_use(port):
                process = self._get_process_using_port(port)
                occupied.append({
                    'port': port,
                    'process': process
                })
        
        if not occupied:
            return {
                'name': 'ç«¯å£å¯ç”¨æ€§',
                'passed': True,
                'message': 'âœ… æ‰€æœ‰ç«¯å£å¯ç”¨',
                'fix_available': False
            }
        else:
            return {
                'name': 'ç«¯å£å¯ç”¨æ€§',
                'passed': False,
                'message': f'âŒ ç«¯å£è¢«å ç”¨: {[p["port"] for p in occupied]}',
                'details': occupied,
                'fix_available': True,
                'fix_command': 'kill_processes'
            }
    
    def _is_port_in_use(self, port: int) -> bool:
        """æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨"""
        for conn in psutil.net_connections():
            if conn.laddr.port == port and conn.status == 'LISTEN':
                return True
        return False
    
    def _get_process_using_port(self, port: int) -> Optional[dict]:
        """è·å–å ç”¨ç«¯å£çš„è¿›ç¨‹ä¿¡æ¯"""
        for conn in psutil.net_connections():
            if conn.laddr.port == port and conn.status == 'LISTEN':
                try:
                    process = psutil.Process(conn.pid)
                    return {
                        'pid': conn.pid,
                        'name': process.name(),
                        'exe': process.exe()
                    }
                except:
                    return {'pid': conn.pid, 'name': 'Unknown'}
        return None
    
    async def check_disk_space(self) -> dict:
        """æ£€æŸ¥ç£ç›˜ç©ºé—´"""
        data_dir = Path.home() / "Documents" / "KookForwarder"
        
        # è·å–ç£ç›˜ä½¿ç”¨æƒ…å†µ
        disk = psutil.disk_usage(str(data_dir.parent))
        free_gb = disk.free / (1024**3)
        
        required_gb = 5
        passed = free_gb >= required_gb
        
        return {
            'name': 'ç£ç›˜ç©ºé—´',
            'passed': passed,
            'free_gb': round(free_gb, 2),
            'required_gb': required_gb,
            'message': f'âœ… ç£ç›˜ç©ºé—´å……è¶³ ({free_gb:.2f}GBå¯ç”¨)' if passed
                      else f'âŒ ç£ç›˜ç©ºé—´ä¸è¶³ ({free_gb:.2f}GBå¯ç”¨ï¼Œéœ€è¦è‡³å°‘{required_gb}GB)',
            'fix_available': False
        }
    
    async def auto_fix(self, check_name: str) -> dict:
        """è‡ªåŠ¨ä¿®å¤é—®é¢˜"""
        if check_name == 'chromium':
            return await self._fix_chromium()
        elif check_name == 'redis':
            return await self._fix_redis()
        elif check_name == 'ports':
            return await self._fix_ports()
        else:
            return {'success': False, 'message': 'ä¸æ”¯æŒè‡ªåŠ¨ä¿®å¤'}
    
    async def _fix_chromium(self) -> dict:
        """è‡ªåŠ¨å®‰è£…Chromium"""
        try:
            process = await asyncio.create_subprocess_exec(
                'playwright', 'install', 'chromium',
                stdout=asyncio.subprocess.PIPE,
                stderr=asyncio.subprocess.PIPE
            )
            
            stdout, stderr = await process.communicate()
            
            if process.returncode == 0:
                return {
                    'success': True,
                    'message': 'âœ… Chromiumå®‰è£…æˆåŠŸ'
                }
            else:
                return {
                    'success': False,
                    'message': f'âŒ Chromiumå®‰è£…å¤±è´¥: {stderr.decode()}'
                }
                
        except Exception as e:
            return {
                'success': False,
                'message': f'âŒ å®‰è£…å¼‚å¸¸: {str(e)}'
            }
    
    async def _fix_redis(self) -> dict:
        """è‡ªåŠ¨å¯åŠ¨Redis"""
        try:
            from ..utils.redis_manager_enhanced import redis_manager
            
            success, message = await redis_manager.start()
            
            return {
                'success': success,
                'message': message
            }
            
        except Exception as e:
            return {
                'success': False,
                'message': f'âŒ Rediså¯åŠ¨å¤±è´¥: {str(e)}'
            }
    
    async def _fix_ports(self) -> dict:
        """è‡ªåŠ¨æ¸…ç†å ç”¨çš„ç«¯å£"""
        check_result = await self.check_ports()
        
        if check_result['passed']:
            return {'success': True, 'message': 'âœ… ç«¯å£å·²å¯ç”¨'}
        
        occupied = check_result.get('details', [])
        killed = []
        
        for port_info in occupied:
            pid = port_info['process']['pid']
            try:
                process = psutil.Process(pid)
                process_name = process.name()
                
                # ä»…killç‰¹å®šè¿›ç¨‹ï¼ˆé¿å…è¯¯æ€ç³»ç»Ÿè¿›ç¨‹ï¼‰
                if process_name in ['python', 'node', 'redis-server']:
                    process.terminate()
                    process.wait(timeout=5)
                    killed.append(f"{process_name}(PID:{pid})")
            except:
                pass
        
        if killed:
            return {
                'success': True,
                'message': f'âœ… å·²ç»ˆæ­¢è¿›ç¨‹: {", ".join(killed)}'
            }
        else:
            return {
                'success': False,
                'message': 'âŒ æ— æ³•è‡ªåŠ¨ç»ˆæ­¢è¿›ç¨‹ï¼Œè¯·æ‰‹åŠ¨å¤„ç†'
            }

# åˆ›å»ºå…¨å±€å®ä¾‹
environment_checker = EnvironmentChecker()
```

```python
# backend/app/api/environment_ultimate.py
from fastapi import APIRouter
from ..utils.environment_checker import environment_checker

router = APIRouter(prefix="/api/environment", tags=["ç¯å¢ƒæ£€æµ‹"])

@router.get("/check")
async def check_environment():
    """å¹¶å‘æ£€æµ‹æ‰€æœ‰ç¯å¢ƒï¼ˆ5-10ç§’ï¼‰"""
    return await environment_checker.check_all_concurrent()

@router.post("/fix/{check_name}")
async def auto_fix(check_name: str):
    """è‡ªåŠ¨ä¿®å¤æŒ‡å®šçš„ç¯å¢ƒé—®é¢˜"""
    return await environment_checker.auto_fix(check_name)
```

```vue
<!-- frontend/src/views/EnvironmentCheckUltimate.vue -->
<template>
  <div class="env-check-page">
    <h1>ğŸ” ç¯å¢ƒæ£€æµ‹</h1>
    
    <!-- æ£€æµ‹è¿›åº¦ -->
    <el-card v-if="checking">
      <div class="checking-status">
        <el-progress 
          :percentage="progress" 
          :status="progressStatus"
          :stroke-width="20"
        />
        <p>{{ checkingMessage }}</p>
      </div>
    </el-card>
    
    <!-- æ£€æµ‹ç»“æœ -->
    <el-card v-else-if="results">
      <div class="results-header">
        <el-tag :type="allPassed ? 'success' : 'danger'" size="large">
          {{ allPassed ? 'âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡' : 'âŒ å­˜åœ¨é—®é¢˜' }}
        </el-tag>
        <span class="elapsed">è€—æ—¶: {{ results.elapsed.toFixed(2) }}ç§’</span>
      </div>
      
      <el-timeline style="margin-top: 20px">
        <el-timeline-item
          v-for="(check, key) in checkResults"
          :key="key"
          :type="check.passed ? 'success' : 'danger'"
          :icon="check.passed ? 'CircleCheck' : 'CircleClose'"
        >
          <div class="check-item">
            <h3>{{ check.name }}</h3>
            <p>{{ check.message }}</p>
            
            <!-- è¯¦ç»†ä¿¡æ¯ -->
            <el-collapse v-if="check.details">
              <el-collapse-item title="æŸ¥çœ‹è¯¦æƒ…">
                <pre>{{ JSON.stringify(check.details, null, 2) }}</pre>
              </el-collapse-item>
            </el-collapse>
            
            <!-- è‡ªåŠ¨ä¿®å¤æŒ‰é’® -->
            <el-button
              v-if="check.fix_available && !check.passed"
              type="primary"
              size="small"
              @click="autoFix(key)"
              :loading="fixing[key]"
            >
              ğŸ”§ ä¸€é”®ä¿®å¤
            </el-button>
          </div>
        </el-timeline-item>
      </el-timeline>
      
      <div class="actions">
        <el-button @click="recheckAll" :loading="checking">
          ğŸ”„ é‡æ–°æ£€æµ‹
        </el-button>
        <el-button 
          v-if="allPassed" 
          type="primary" 
          @click="continueToWizard"
        >
          ç»§ç»­ â†’
        </el-button>
      </div>
    </el-card>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import api from '@/api'

const checking = ref(false)
const results = ref(null)
const progress = ref(0)
const checkingMessage = ref('æ­£åœ¨æ£€æµ‹ç¯å¢ƒ...')
const fixing = ref({})

const allPassed = computed(() => {
  return results.value?.all_passed || false
})

const checkResults = computed(() => {
  if (!results.value) return {}
  
  const { python, chromium, redis, network, ports, disk } = results.value
  return { python, chromium, redis, network, ports, disk }
})

const progressStatus = computed(() => {
  if (progress.value === 100) {
    return allPassed.value ? 'success' : 'exception'
  }
  return null
})

onMounted(() => {
  checkAll()
})

async function checkAll() {
  checking.value = true
  progress.value = 0
  checkingMessage.value = 'æ­£åœ¨å¹¶å‘æ£€æµ‹6é¡¹ç¯å¢ƒ...'
  
  // æ¨¡æ‹Ÿè¿›åº¦ï¼ˆå®é™…ä¼šåœ¨5-10ç§’å†…å®Œæˆï¼‰
  const progressInterval = setInterval(() => {
    if (progress.value < 90) {
      progress.value += 10
    }
  }, 500)
  
  try {
    results.value = await api.checkEnvironment()
    progress.value = 100
    
    if (results.value.all_passed) {
      checkingMessage.value = `âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼ˆ${results.value.elapsed.toFixed(2)}ç§’ï¼‰`
    } else {
      checkingMessage.value = `âŒ å‘ç°é—®é¢˜ï¼ˆ${results.value.elapsed.toFixed(2)}ç§’ï¼‰`
    }
  } catch (error) {
    checkingMessage.value = `âŒ æ£€æµ‹å¤±è´¥: ${error.message}`
  } finally {
    clearInterval(progressInterval)
    checking.value = false
  }
}

async function autoFix(checkName) {
  fixing.value[checkName] = true
  
  try {
    const result = await api.autoFixEnvironment(checkName)
    
    if (result.success) {
      ElMessage.success(result.message)
      // é‡æ–°æ£€æµ‹
      await checkAll()
    } else {
      ElMessage.error(result.message)
    }
  } catch (error) {
    ElMessage.error(`ä¿®å¤å¤±è´¥: ${error.message}`)
  } finally {
    fixing.value[checkName] = false
  }
}

function recheckAll() {
  checkAll()
}

function continueToWizard() {
  router.push('/wizard')
}
</script>
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **P0 - é‡è¦**

**é¢„è®¡å·¥ä½œé‡**: 3-4å¤©

---

## ğŸŸ¡ P1çº§ä¼˜åŒ–ï¼ˆé‡è¦å¢å¼ºåŠŸèƒ½ï¼‰- å½±å“ç”¨æˆ·ä½“éªŒ

### P1-1: å…è´£å£°æ˜å¼¹çª— ã€æ³•å¾‹åˆè§„ã€‘

**ç°çŠ¶é—®é¢˜**:
```
âŒ æ²¡æœ‰ä»»ä½•å…è´£å£°æ˜
âŒ ç”¨æˆ·ä¸äº†è§£ä½¿ç”¨é£é™©
âŒ å­˜åœ¨æ³•å¾‹é£é™©
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚è¦æ±‚:
  - é¦–æ¬¡å¯åŠ¨å¼ºåˆ¶æ˜¾ç¤º
  - 6å¤§æ¡æ¬¾æ¸…æ™°åˆ—å‡º
  - å¿…é¡»å‹¾é€‰åŒæ„æ‰èƒ½ç»§ç»­
  - æ‹’ç»åè‡ªåŠ¨é€€å‡º
  - åŒæ„åæ°¸ä¹…è®°å½•
```

**å½±å“èŒƒå›´**: ğŸŸ¡ **ä¸­** - æ³•å¾‹åˆè§„ï¼Œä¿æŠ¤å¼€å‘è€…

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```vue
<!-- frontend/src/components/DisclaimerDialog.vue -->
<template>
  <el-dialog
    v-model="visible"
    title="âš ï¸ å…è´£å£°æ˜"
    :close-on-click-modal="false"
    :close-on-press-escape="false"
    :show-close="false"
    width="600px"
  >
    <div class="disclaimer-content">
      <el-alert type="warning" :closable="false">
        <strong>è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹æ¡æ¬¾ï¼Œä½¿ç”¨æœ¬è½¯ä»¶å³è¡¨ç¤ºæ‚¨åŒæ„ï¼š</strong>
      </el-alert>
      
      <ol class="terms">
        <li>
          <strong>æŠ€æœ¯é£é™©</strong>ï¼šæœ¬è½¯ä»¶é€šè¿‡æµè§ˆå™¨è‡ªåŠ¨åŒ–æŠ€æœ¯æŠ“å–KOOKæ¶ˆæ¯ï¼Œ
          å¯èƒ½è¿åKOOKæœåŠ¡æ¡æ¬¾ï¼Œå­˜åœ¨è´¦å·è¢«å°ç¦çš„é£é™©ã€‚
        </li>
        <li>
          <strong>ä½¿ç”¨æˆæƒ</strong>ï¼šè¯·ä»…åœ¨å·²è·å¾—æˆæƒçš„åœºæ™¯ä¸‹ä½¿ç”¨æœ¬è½¯ä»¶ï¼Œ
          æœªç»æˆæƒè½¬å‘ä»–äººæ¶ˆæ¯å¯èƒ½ä¾µçŠ¯éšç§æƒã€‚
        </li>
        <li>
          <strong>æ³•å¾‹åˆè§„</strong>ï¼šè¯·éµå®ˆæ‰€åœ¨åœ°åŒºçš„æ³•å¾‹æ³•è§„ï¼Œ
          ä¸å¾—å°†æœ¬è½¯ä»¶ç”¨äºéæ³•ç”¨é€”ã€‚
        </li>
        <li>
          <strong>ç‰ˆæƒå£°æ˜</strong>ï¼šè½¬å‘çš„æ¶ˆæ¯å†…å®¹å¯èƒ½æ¶‰åŠç‰ˆæƒï¼Œ
          è¯·å°Šé‡åŸä½œè€…çš„çŸ¥è¯†äº§æƒã€‚
        </li>
        <li>
          <strong>æ•°æ®å®‰å…¨</strong>ï¼šæœ¬è½¯ä»¶ä¼šåœ¨æœ¬åœ°å­˜å‚¨Cookieå’Œé…ç½®ä¿¡æ¯ï¼Œ
          è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„è®¾å¤‡ã€‚
        </li>
        <li>
          <strong>å…è´£æ¡æ¬¾</strong>ï¼šæœ¬è½¯ä»¶ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œ
          å¼€å‘è€…ä¸æ‰¿æ‹…ä»»ä½•å› ä½¿ç”¨æœ¬è½¯ä»¶è€Œäº§ç”Ÿçš„æ³•å¾‹è´£ä»»ã€‚
        </li>
      </ol>
      
      <el-checkbox v-model="agreed" size="large">
        <strong>æˆ‘å·²é˜…è¯»å¹¶åŒæ„ä»¥ä¸Šæ‰€æœ‰æ¡æ¬¾</strong>
      </el-checkbox>
    </div>
    
    <template #footer>
      <el-button @click="reject">æ‹’ç»å¹¶é€€å‡º</el-button>
      <el-button 
        type="primary" 
        @click="accept" 
        :disabled="!agreed"
      >
        åŒæ„å¹¶ç»§ç»­
      </el-button>
    </template>
  </el-dialog>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'

const visible = ref(false)
const agreed = ref(false)

onMounted(() => {
  checkDisclaimer()
})

function checkDisclaimer() {
  const accepted = localStorage.getItem('disclaimer_accepted')
  
  if (!accepted) {
    visible.value = true
  }
}

function accept() {
  if (!agreed.value) {
    ElMessage.warning('è¯·å‹¾é€‰åŒæ„æ¡æ¬¾')
    return
  }
  
  // ä¿å­˜åˆ°LocalStorage
  localStorage.setItem('disclaimer_accepted', 'true')
  localStorage.setItem('disclaimer_accepted_at', new Date().toISOString())
  
  visible.value = false
  ElMessage.success('æ„Ÿè°¢æ‚¨çš„åŒæ„ï¼Œç¥ä½¿ç”¨æ„‰å¿«ï¼')
}

async function reject() {
  try {
    await ElMessageBox.confirm(
      'æ‹’ç»å…è´£å£°æ˜å°†æ— æ³•ä½¿ç”¨æœ¬è½¯ä»¶ï¼Œç¡®å®šè¦é€€å‡ºå—ï¼Ÿ',
      'ç¡®è®¤é€€å‡º',
      {
        type: 'warning',
        confirmButtonText: 'ç¡®å®šé€€å‡º',
        cancelButtonText: 'è¿”å›é˜…è¯»'
      }
    )
    
    // é€€å‡ºåº”ç”¨
    if (window.electron) {
      window.electron.quit()
    } else {
      window.close()
    }
    
  } catch {
    // ç”¨æˆ·å–æ¶ˆï¼Œç»§ç»­æ˜¾ç¤ºå¼¹çª—
  }
}
</script>

<style scoped>
.disclaimer-content {
  max-height: 500px;
  overflow-y: auto;
}

.terms {
  margin: 20px 0;
  padding-left: 20px;
}

.terms li {
  margin: 15px 0;
  line-height: 1.6;
}

.terms strong {
  color: #409EFF;
}
</style>
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **P1 - åˆè§„è¦æ±‚**

**é¢„è®¡å·¥ä½œé‡**: 0.5å¤©

---

### P1-2: AIæ˜ å°„å­¦ä¹ å¼•æ“ ã€æ™ºèƒ½åŒ–ã€‘

**ç°çŠ¶é—®é¢˜**:
```python
# backend/app/api/mapping_learning_api.py å­˜åœ¨ï¼Œä½†åŠŸèƒ½ç®€å•
âŒ æ²¡æœ‰çœŸæ­£çš„æœºå™¨å­¦ä¹ ç®—æ³•
âŒ æ¨èå‡†ç¡®åº¦ä½
âŒ ä¸æ”¯æŒä¸­è‹±æ–‡ç¿»è¯‘è¡¨
âŒ æ²¡æœ‰æ—¶é—´è¡°å‡å› å­
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚è¦æ±‚:
  ä¸‰é‡åŒ¹é…ç®—æ³•:
    - å®Œå…¨åŒ¹é…ï¼ˆå­¦ä¹ è¿‡çš„ç›¸åŒé¢‘é“ï¼‰40%
    - ç›¸ä¼¼åŒ¹é…ï¼ˆç¼–è¾‘è·ç¦»ï¼‰30%
    - å…³é”®è¯åŒ¹é…ï¼ˆåŒ…å«ç›¸åŒå…³é”®è¯ï¼‰20%
    - å†å²é¢‘ç‡ 10%
    
  ä¸­è‹±æ–‡ç¿»è¯‘è¡¨:
    - å…¬å‘Š â†’ announcements/announce/notice
    - æ´»åŠ¨ â†’ events/activity
    - æ›´æ–° â†’ updates/changelog
    - æŠ€æœ¯ â†’ tech/technical/dev
    
  è‡ªåŠ¨å­¦ä¹ :
    - è®°å½•æ¯æ¬¡æ˜ å°„é€‰æ‹©
    - ç»Ÿè®¡ä½¿ç”¨é¢‘ç‡
    - æŒç»­ä¼˜åŒ–å‡†ç¡®åº¦
```

**å½±å“èŒƒå›´**: ğŸŸ¡ **ä¸­é«˜** - æ˜¾è‘—æå‡é…ç½®æ•ˆç‡

**ä¼˜åŒ–æ–¹æ¡ˆ**:
```python
# backend/app/utils/mapping_learning_engine.py
import difflib
import re
from typing import List, Dict, Optional, Tuple
from collections import defaultdict
import time
import math

class MappingLearningEngine:
    """AIæ˜ å°„å­¦ä¹ å¼•æ“ï¼ˆv2.0å¢å¼ºç‰ˆï¼‰"""
    
    def __init__(self):
        # ä¸­è‹±æ–‡ç¿»è¯‘è¡¨
        self.translation_table = {
            'å…¬å‘Š': ['announcement', 'announce', 'notice', 'news'],
            'æ´»åŠ¨': ['event', 'activity', 'campaign'],
            'æ›´æ–°': ['update', 'changelog', 'release', 'patch'],
            'æŠ€æœ¯': ['tech', 'technical', 'dev', 'development'],
            'è®¨è®º': ['discuss', 'discussion', 'talk', 'chat'],
            'å¸®åŠ©': ['help', 'support', 'faq', 'question'],
            'åé¦ˆ': ['feedback', 'suggestion', 'report'],
            'é—²èŠ': ['general', 'off-topic', 'chat', 'random'],
            'è§„åˆ™': ['rule', 'guideline', 'policy'],
            'èµ„æº': ['resource', 'link', 'material'],
        }
        
        # åå‘ç¿»è¯‘è¡¨ï¼ˆè‹±æ–‡â†’ä¸­æ–‡ï¼‰
        self.reverse_translation = {}
        for cn, en_list in self.translation_table.items():
            for en in en_list:
                self.reverse_translation[en] = cn
        
        # æ˜ å°„å†å²è®°å½• {(kook_channel_id, target_channel_id): count}
        self.mapping_history = defaultdict(int)
        
        # æ˜ å°„æ—¶é—´æˆ³ {(kook_channel_id, target_channel_id): timestamp}
        self.mapping_timestamps = {}
        
        # ä»æ•°æ®åº“åŠ è½½å†å²
        self.load_history()
    
    def load_history(self):
        """ä»æ•°æ®åº“åŠ è½½å†å²æ˜ å°„è®°å½•"""
        from ..database import db
        
        # ä»mapping_learningè¡¨åŠ è½½ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        try:
            history = db.get_mapping_learning_history()
            
            for record in history:
                key = (record['kook_channel_id'], record['target_channel_id'])
                self.mapping_history[key] = record['use_count']
                self.mapping_timestamps[key] = record['last_used_timestamp']
        except:
            pass  # è¡¨ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤å€¼
    
    def recommend_mappings(
        self, 
        kook_channel: Dict, 
        target_channels: List[Dict]
    ) -> List[Tuple[Dict, float, str]]:
        """
        æ¨èæ˜ å°„ï¼ˆä¸‰é‡ç®—æ³• + å†å²é¢‘ç‡ï¼‰
        
        Args:
            kook_channel: KOOKé¢‘é“ä¿¡æ¯ {'id', 'name', 'type'}
            target_channels: ç›®æ ‡é¢‘é“åˆ—è¡¨ [{'id', 'name', 'platform'}, ...]
            
        Returns:
            æ¨èåˆ—è¡¨ [(target_channel, confidence, reason), ...]
            æŒ‰ç½®ä¿¡åº¦é™åºæ’åˆ—
        """
        kook_name = kook_channel['name'].lower()
        kook_id = kook_channel['id']
        
        recommendations = []
        
        for target in target_channels:
            target_name = target['name'].lower()
            target_id = target['id']
            
            # 1. å®Œå…¨åŒ¹é…ï¼ˆ40%æƒé‡ï¼‰
            exact_match = self._exact_match_score(kook_name, target_name)
            
            # 2. ç›¸ä¼¼åŒ¹é…ï¼ˆ30%æƒé‡ï¼‰
            similarity = self._similarity_score(kook_name, target_name)
            
            # 3. å…³é”®è¯åŒ¹é…ï¼ˆ20%æƒé‡ï¼‰
            keyword_match = self._keyword_match_score(kook_name, target_name)
            
            # 4. å†å²é¢‘ç‡ï¼ˆ10%æƒé‡ï¼‰
            history_score = self._history_score(kook_id, target_id)
            
            # ç»¼åˆç½®ä¿¡åº¦
            confidence = (
                exact_match * 0.4 +
                similarity * 0.3 +
                keyword_match * 0.2 +
                history_score * 0.1
            )
            
            # ç”Ÿæˆæ¨èåŸå› 
            reason = self._generate_reason(
                exact_match, similarity, keyword_match, history_score
            )
            
            recommendations.append((target, confidence, reason))
        
        # æŒ‰ç½®ä¿¡åº¦æ’åº
        recommendations.sort(key=lambda x: x[1], reverse=True)
        
        return recommendations
    
    def _exact_match_score(self, name1: str, name2: str) -> float:
        """
        å®Œå…¨åŒ¹é…è¯„åˆ†ï¼ˆè€ƒè™‘ç¿»è¯‘ï¼‰
        
        Returns:
            1.0 = å®Œå…¨åŒ¹é…
            0.8 = ç¿»è¯‘åŒ¹é…
            0.0 = ä¸åŒ¹é…
        """
        # å»é™¤ç‰¹æ®Šå­—ç¬¦
        clean1 = re.sub(r'[#\-_\s]+', '', name1)
        clean2 = re.sub(r'[#\-_\s]+', '', name2)
        
        # ç›´æ¥åŒ¹é…
        if clean1 == clean2:
            return 1.0
        
        # æ£€æŸ¥ç¿»è¯‘åŒ¹é…
        # ä¸­æ–‡ â†’ è‹±æ–‡
        for cn_word, en_words in self.translation_table.items():
            if cn_word in name1:
                for en_word in en_words:
                    if en_word in name2:
                        return 0.8
        
        # è‹±æ–‡ â†’ ä¸­æ–‡
        for en_word, cn_word in self.reverse_translation.items():
            if en_word in name1:
                if cn_word in name2:
                    return 0.8
        
        return 0.0
    
    def _similarity_score(self, name1: str, name2: str) -> float:
        """
        ç›¸ä¼¼åº¦è¯„åˆ†ï¼ˆç¼–è¾‘è·ç¦»ï¼‰
        
        ä½¿ç”¨SequenceMatcherè®¡ç®—å­—ç¬¦ä¸²ç›¸ä¼¼åº¦
        
        Returns:
            0.0 - 1.0
        """
        # å»é™¤ç‰¹æ®Šå­—ç¬¦
        clean1 = re.sub(r'[#\-_\s]+', '', name1)
        clean2 = re.sub(r'[#\-_\s]+', '', name2)
        
        # ä½¿ç”¨difflibè®¡ç®—ç›¸ä¼¼åº¦
        similarity = difflib.SequenceMatcher(None, clean1, clean2).ratio()
        
        return similarity
    
    def _keyword_match_score(self, name1: str, name2: str) -> float:
        """
        å…³é”®è¯åŒ¹é…è¯„åˆ†
        
        æå–å…³é”®è¯ï¼Œè®¡ç®—åŒ¹é…æ¯”ä¾‹
        
        Returns:
            0.0 - 1.0
        """
        # æå–ä¸­æ–‡å…³é”®è¯
        cn_keywords1 = re.findall(r'[\u4e00-\u9fa5]+', name1)
        cn_keywords2 = re.findall(r'[\u4e00-\u9fa5]+', name2)
        
        # æå–è‹±æ–‡å…³é”®è¯
        en_keywords1 = re.findall(r'[a-z]+', name1)
        en_keywords2 = re.findall(r'[a-z]+', name2)
        
        # åˆå¹¶
        keywords1 = set(cn_keywords1 + en_keywords1)
        keywords2 = set(cn_keywords2 + en_keywords2)
        
        if not keywords1 or not keywords2:
            return 0.0
        
        # è®¡ç®—äº¤é›†å æ¯”
        intersection = keywords1 & keywords2
        union = keywords1 | keywords2
        
        jaccard = len(intersection) / len(union) if union else 0.0
        
        # è€ƒè™‘ç¿»è¯‘åŒ¹é…
        translated_matches = 0
        for kw1 in keywords1:
            # æ£€æŸ¥ä¸­æ–‡â†’è‹±æ–‡ç¿»è¯‘
            if kw1 in self.translation_table:
                en_words = self.translation_table[kw1]
                if any(en in keywords2 for en in en_words):
                    translated_matches += 1
            
            # æ£€æŸ¥è‹±æ–‡â†’ä¸­æ–‡ç¿»è¯‘
            if kw1 in self.reverse_translation:
                cn_word = self.reverse_translation[kw1]
                if cn_word in keywords2:
                    translated_matches += 1
        
        translation_bonus = min(0.5, translated_matches * 0.2)
        
        return min(1.0, jaccard + translation_bonus)
    
    def _history_score(self, kook_channel_id: str, target_channel_id: str) -> float:
        """
        å†å²é¢‘ç‡è¯„åˆ†ï¼ˆå¸¦æ—¶é—´è¡°å‡ï¼‰
        
        å…¬å¼: score = (use_count / max_count) * time_decay
        
        æ—¶é—´è¡°å‡: decay = e^(-Î»t)ï¼Œå…¶ä¸­tä¸ºå¤©æ•°ï¼ŒÎ»=0.01
        
        Returns:
            0.0 - 1.0
        """
        key = (kook_channel_id, target_channel_id)
        
        use_count = self.mapping_history.get(key, 0)
        
        if use_count == 0:
            return 0.0
        
        # æ‰¾åˆ°æœ€å¤§ä½¿ç”¨æ¬¡æ•°ï¼ˆå½’ä¸€åŒ–ï¼‰
        max_count = max(self.mapping_history.values()) if self.mapping_history else 1
        
        normalized_count = use_count / max_count
        
        # æ—¶é—´è¡°å‡
        if key in self.mapping_timestamps:
            last_used = self.mapping_timestamps[key]
            days_ago = (time.time() - last_used) / 86400
            
            # æŒ‡æ•°è¡°å‡: e^(-0.01 * days)
            time_decay = math.exp(-0.01 * days_ago)
        else:
            time_decay = 1.0
        
        return normalized_count * time_decay
    
    def _generate_reason(
        self, 
        exact: float, 
        similarity: float, 
        keyword: float, 
        history: float
    ) -> str:
        """ç”Ÿæˆæ¨èåŸå› """
        reasons = []
        
        if exact >= 0.8:
            reasons.append("å®Œå…¨åŒ¹é…" if exact == 1.0 else "ç¿»è¯‘åŒ¹é…")
        
        if similarity >= 0.7:
            reasons.append(f"åç§°ç›¸ä¼¼åº¦{similarity*100:.0f}%")
        
        if keyword >= 0.5:
            reasons.append("å…³é”®è¯åŒ¹é…")
        
        if history >= 0.5:
            reasons.append("å†å²è®°å½•")
        
        if not reasons:
            reasons.append("ä½ç½®ä¿¡åº¦æ¨è")
        
        return " | ".join(reasons)
    
    def record_mapping(
        self, 
        kook_channel_id: str, 
        target_channel_id: str
    ):
        """è®°å½•ç”¨æˆ·çš„æ˜ å°„é€‰æ‹©ï¼ˆç”¨äºå­¦ä¹ ï¼‰"""
        key = (kook_channel_id, target_channel_id)
        
        # å¢åŠ ä½¿ç”¨æ¬¡æ•°
        self.mapping_history[key] += 1
        
        # æ›´æ–°æ—¶é—´æˆ³
        self.mapping_timestamps[key] = time.time()
        
        # ä¿å­˜åˆ°æ•°æ®åº“
        from ..database import db
        db.save_mapping_learning_record(
            kook_channel_id=kook_channel_id,
            target_channel_id=target_channel_id,
            use_count=self.mapping_history[key],
            last_used_timestamp=self.mapping_timestamps[key]
        )
    
    def get_stats(self) -> Dict:
        """è·å–å­¦ä¹ å¼•æ“ç»Ÿè®¡ä¿¡æ¯"""
        return {
            'total_mappings_learned': len(self.mapping_history),
            'total_uses': sum(self.mapping_history.values()),
            'most_used_mapping': max(
                self.mapping_history.items(), 
                key=lambda x: x[1]
            ) if self.mapping_history else None,
            'translation_table_size': len(self.translation_table)
        }

# åˆ›å»ºå…¨å±€å®ä¾‹
mapping_learning_engine = MappingLearningEngine()
```

```python
# backend/app/api/mapping_learning_ultimate.py
from fastapi import APIRouter, HTTPException
from typing import List, Dict
from ..utils.mapping_learning_engine import mapping_learning_engine

router = APIRouter(prefix="/api/mapping-learning", tags=["æ˜ å°„å­¦ä¹ "])

@router.post("/recommend")
async def recommend_mappings(
    kook_channel: Dict,
    target_channels: List[Dict]
):
    """
    è·å–AIæ¨èçš„é¢‘é“æ˜ å°„
    
    Body:
    {
      "kook_channel": {"id": "xxx", "name": "å…¬å‘Šé¢‘é“"},
      "target_channels": [
        {"id": "123", "name": "announcements", "platform": "discord"},
        {"id": "456", "name": "updates", "platform": "telegram"}
      ]
    }
    
    Response:
    [
      {
        "target_channel": {...},
        "confidence": 0.95,
        "reason": "å®Œå…¨åŒ¹é… | ç¿»è¯‘åŒ¹é…"
      },
      ...
    ]
    """
    try:
        recommendations = mapping_learning_engine.recommend_mappings(
            kook_channel, target_channels
        )
        
        return [
            {
                'target_channel': target,
                'confidence': confidence,
                'reason': reason
            }
            for target, confidence, reason in recommendations
        ]
    
    except Exception as e:
        raise HTTPException(500, f"æ¨èå¤±è´¥: {str(e)}")

@router.post("/record")
async def record_mapping(
    kook_channel_id: str,
    target_channel_id: str
):
    """
    è®°å½•ç”¨æˆ·çš„æ˜ å°„é€‰æ‹©ï¼ˆç”¨äºå­¦ä¹ ï¼‰
    
    æ¯æ¬¡ç”¨æˆ·åˆ›å»ºæˆ–ä½¿ç”¨æ˜ å°„æ—¶è°ƒç”¨
    """
    try:
        mapping_learning_engine.record_mapping(
            kook_channel_id, target_channel_id
        )
        
        return {"success": True}
    
    except Exception as e:
        raise HTTPException(500, f"è®°å½•å¤±è´¥: {str(e)}")

@router.get("/stats")
async def get_stats():
    """è·å–å­¦ä¹ å¼•æ“ç»Ÿè®¡ä¿¡æ¯"""
    return mapping_learning_engine.get_stats()
```

```vue
<!-- frontend/src/views/Mapping.vue - ä½¿ç”¨AIæ¨è -->
<template>
  <div class="mapping-page">
    <h1>ğŸ”€ é¢‘é“æ˜ å°„é…ç½®</h1>
    
    <!-- å·¦ä¾§: KOOKé¢‘é“åˆ—è¡¨ -->
    <div class="kook-channels">
      <h3>KOOKé¢‘é“</h3>
      <el-tree
        :data="kookChannels"
        @node-click="selectKookChannel"
      />
    </div>
    
    <!-- å³ä¾§: ç›®æ ‡é¢‘é“æ¨è -->
    <div class="target-channels" v-if="selectedKookChannel">
      <h3>{{ selectedKookChannel.name }} â†’ ç›®æ ‡é¢‘é“</h3>
      
      <el-alert type="info" :closable="false">
        ğŸ’¡ AIå·²ä¸ºæ‚¨æ¨èä»¥ä¸‹æ˜ å°„ï¼ˆæŒ‰ç½®ä¿¡åº¦æ’åºï¼‰
      </el-alert>
      
      <el-table :data="recommendations" style="margin-top: 20px">
        <el-table-column label="å¹³å°">
          <template #default="{ row }">
            <el-tag>{{ row.target_channel.platform }}</el-tag>
          </template>
        </el-table-column>
        
        <el-table-column label="é¢‘é“åç§°" prop="target_channel.name" />
        
        <el-table-column label="ç½®ä¿¡åº¦">
          <template #default="{ row }">
            <el-progress
              :percentage="row.confidence * 100"
              :color="getConfidenceColor(row.confidence)"
              :show-text="false"
              style="width: 100px"
            />
            <span style="margin-left: 10px">
              {{ (row.confidence * 100).toFixed(0) }}%
            </span>
          </template>
        </el-table-column>
        
        <el-table-column label="æ¨èåŸå› " prop="reason" />
        
        <el-table-column label="æ“ä½œ">
          <template #default="{ row }">
            <el-button 
              v-if="row.confidence >= 0.7"
              type="primary" 
              size="small"
              @click="createMapping(row)"
            >
              âœ… åº”ç”¨æ¨è
            </el-button>
            <el-button 
              v-else
              size="small"
              @click="createMapping(row)"
            >
              ä½¿ç”¨
            </el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <!-- ä¸€é”®åº”ç”¨æ‰€æœ‰é«˜ç½®ä¿¡åº¦æ¨è -->
      <el-button
        v-if="highConfidenceCount > 0"
        type="primary"
        size="large"
        @click="applyAllHighConfidence"
        style="margin-top: 20px"
      >
        âš¡ ä¸€é”®åº”ç”¨æ‰€æœ‰é«˜ç½®ä¿¡åº¦æ¨èï¼ˆ{{ highConfidenceCount }}ä¸ªï¼‰
      </el-button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue'
import api from '@/api'

const kookChannels = ref([])
const selectedKookChannel = ref(null)
const recommendations = ref([])

const highConfidenceCount = computed(() => {
  return recommendations.value.filter(r => r.confidence >= 0.7).length
})

async function selectKookChannel(channel) {
  selectedKookChannel.value = channel
  
  // è·å–æ‰€æœ‰ç›®æ ‡é¢‘é“
  const targetChannels = await api.getAllTargetChannels()
  
  // è¯·æ±‚AIæ¨è
  const result = await api.recommendMappings({
    kook_channel: channel,
    target_channels: targetChannels
  })
  
  recommendations.value = result
}

async function createMapping(recommendation) {
  await api.createMapping({
    kook_channel_id: selectedKookChannel.value.id,
    target_channel_id: recommendation.target_channel.id,
    target_platform: recommendation.target_channel.platform
  })
  
  // è®°å½•åˆ°å­¦ä¹ å¼•æ“
  await api.recordMappingLearning(
    selectedKookChannel.value.id,
    recommendation.target_channel.id
  )
  
  ElMessage.success('æ˜ å°„å·²åˆ›å»º')
}

async function applyAllHighConfidence() {
  const highConfidence = recommendations.value.filter(r => r.confidence >= 0.7)
  
  for (const rec of highConfidence) {
    await createMapping(rec)
  }
  
  ElMessage.success(`æˆåŠŸåº”ç”¨${highConfidence.length}ä¸ªæ˜ å°„`)
}

function getConfidenceColor(confidence) {
  if (confidence >= 0.9) return '#67C23A'  // ç»¿è‰²
  if (confidence >= 0.7) return '#409EFF'  // è“è‰²
  if (confidence >= 0.5) return '#E6A23C'  // é»„è‰²
  return '#F56C6C'  // çº¢è‰²
}
</script>
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **P1 - é‡è¦ç‰¹æ€§**

**é¢„è®¡å·¥ä½œé‡**: 4-5å¤©

---

### P1-3: ç³»ç»Ÿæ‰˜ç›˜å®æ—¶ç»Ÿè®¡ ã€ç”¨æˆ·ä½“éªŒã€‘

**ç°çŠ¶é—®é¢˜**:
```javascript
// frontend/electron/main.js å·²æœ‰æ‰˜ç›˜ä»£ç 
// ä½†åŠŸèƒ½ç®€é™‹ï¼Œç¼ºå°‘å®æ—¶ç»Ÿè®¡

âœ… æœ‰åŸºç¡€æ‰˜ç›˜å›¾æ ‡
âŒ æ²¡æœ‰å®æ—¶åˆ·æ–°ç»Ÿè®¡æ•°æ®
âŒ æ²¡æœ‰å¿«æ·æ§åˆ¶èœå•
âŒ æ²¡æœ‰æ¡Œé¢é€šçŸ¥é›†æˆ
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚è¦æ±‚:
  å®æ—¶æ˜¾ç¤ºï¼ˆæ¯5ç§’åˆ·æ–°ï¼‰:
    - è¿è¡ŒçŠ¶æ€
    - ä»Šæ—¥æ¶ˆæ¯æ•°
    - æˆåŠŸç‡
    - é˜Ÿåˆ—ç§¯å‹
    - åœ¨çº¿è´¦å·æ•°
    
  å¿«æ·æ§åˆ¶èœå•:
    - å¯åŠ¨/åœæ­¢/é‡å¯æœåŠ¡
    - æµ‹è¯•è½¬å‘
    - æ¸…ç©ºé˜Ÿåˆ—
    - æ˜¾ç¤ºä¸»çª—å£
    - å¿«æ·å¯¼èˆª
    
  æ¡Œé¢é€šçŸ¥:
    - æœåŠ¡å¼‚å¸¸
    - è´¦å·æ‰çº¿
    - é˜Ÿåˆ—ç§¯å‹
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **P1 - ç”¨æˆ·ä½“éªŒä¼˜åŒ–**

**é¢„è®¡å·¥ä½œé‡**: 2-3å¤©

---

### P1-4: å…±äº«æµè§ˆå™¨ä¼˜åŒ– ã€æ€§èƒ½ã€‘

**ç°çŠ¶é—®é¢˜**:
```python
# backend/app/kook/scraper.py å·²æœ‰å…±äº«æµè§ˆå™¨é€»è¾‘
âœ… ScraperManageræœ‰shared_browser
âš ï¸ ä½†æ¯ä¸ªè´¦å·ä»åˆ›å»ºç‹¬ç«‹Context
âš ï¸ å†…å­˜å ç”¨ä»ç„¶è¾ƒé«˜ï¼ˆ10è´¦å·çº¦1-2GBï¼‰
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚è¦æ±‚:
  å¤šè´¦å·å…±ç”¨ä¸€ä¸ªæµè§ˆå™¨å®ä¾‹:
    ä¼ ç»Ÿæ¨¡å¼: 10è´¦å· = 10æµè§ˆå™¨ = 3GBå†…å­˜
    å…±äº«æ¨¡å¼: 10è´¦å· = 1æµè§ˆå™¨ = 500MBå†…å­˜
    
  ä¼˜åŒ–æ•ˆæœ:
    - é™ä½80%å†…å­˜å ç”¨
    - æå‡50%å¯åŠ¨é€Ÿåº¦
```

**å½“å‰å®ç°è¯„ä¼°**:
- âœ… å·²æœ‰SharedBrowserï¼ˆä½†æœªå®Œå…¨ä½¿ç”¨ï¼‰
- âš ï¸ æ¯ä¸ªè´¦å·ä»ç„¶æ˜¯ç‹¬ç«‹Contextï¼ˆæ­£ç¡®çš„ï¼Œé¿å…Cookieæ··æ·†ï¼‰
- âœ… æ¶æ„è®¾è®¡åˆç†

**ç»“è®º**: ğŸŸ¢ å½“å‰å®ç°å·²æ¥è¿‘éœ€æ±‚ï¼Œä»…éœ€å¾®è°ƒ

**ä¼˜å…ˆçº§**: ğŸŸ¢ **P1 - æ¬¡è¦ä¼˜åŒ–ï¼ˆå·²åŸºæœ¬å®ç°ï¼‰**

**é¢„è®¡å·¥ä½œé‡**: 0.5-1å¤©ï¼ˆä¸»è¦æ˜¯æµ‹è¯•å’Œæ–‡æ¡£ï¼‰

---

## ğŸŸ¢ P2çº§ä¼˜åŒ–ï¼ˆé”¦ä¸Šæ·»èŠ±åŠŸèƒ½ï¼‰- æå‡å®Œå–„åº¦

### P2-1: æ•°æ®åº“ä¼˜åŒ–å·¥å…· ã€æ€§èƒ½ã€‘

**ç°çŠ¶é—®é¢˜**:
```python
# backend/app/database.py å·²æœ‰åŸºç¡€æ•°æ®åº“æ“ä½œ
# ä½†ç¼ºå°‘ç»´æŠ¤å·¥å…·

âœ… æœ‰åŸºç¡€ç´¢å¼•ï¼ˆ7ä¸ªï¼‰
âŒ æ²¡æœ‰è‡ªåŠ¨å½’æ¡£æ—§æ—¥å¿—
âŒ æ²¡æœ‰VACUUMå‹ç¼©
âŒ æ²¡æœ‰å®šæ—¶ä»»åŠ¡
```

**éœ€æ±‚å¯¹æ¯”**:
```yaml
éœ€æ±‚è¦æ±‚:
  è‡ªåŠ¨å½’æ¡£:
    - 30å¤©å‰çš„æ—¥å¿—ç§»åŠ¨åˆ°å½’æ¡£è¡¨
    - ä¿æŒä¸»è¡¨æ€§èƒ½
    
  VACUUMå‹ç¼©:
    - å‡å°‘æ•°æ®åº“æ–‡ä»¶å¤§å°30%+
    - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
    
  å®šæ—¶ä»»åŠ¡:
    - æ¯å¤©å‡Œæ™¨3ç‚¹è‡ªåŠ¨æ‰§è¡Œ
```

**ä¼˜å…ˆçº§**: ğŸŸ¢ **P2 - éç´§æ€¥**

**é¢„è®¡å·¥ä½œé‡**: 1-2å¤©

---

### P2-2: é€šçŸ¥ç³»ç»Ÿå¢å¼º ã€ç”¨æˆ·ä½“éªŒã€‘

**ç°çŠ¶é—®é¢˜**:
```
âŒ æ²¡æœ‰åˆ†ç±»é€šçŸ¥ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯ï¼‰
âŒ æ²¡æœ‰é™é»˜æ—¶æ®µè®¾ç½®
âŒ æ²¡æœ‰é€šçŸ¥å†å²è®°å½•
```

**ä¼˜å…ˆçº§**: ğŸŸ¢ **P2 - éç´§æ€¥**

**é¢„è®¡å·¥ä½œé‡**: 1-2å¤©

---

### P2-3: å®Œæ•´çš„å¸®åŠ©ç³»ç»Ÿ ã€æ–‡æ¡£ã€‘

**ç°çŠ¶é—®é¢˜**:
```
âŒ æ²¡æœ‰å†…ç½®å›¾æ–‡æ•™ç¨‹
âŒ æ²¡æœ‰è§†é¢‘æ•™ç¨‹é“¾æ¥
âŒ æ²¡æœ‰äº¤äº’å¼å¼•å¯¼ï¼ˆdriver.jsè™½ç„¶å®‰è£…äº†ä½†æœªä½¿ç”¨ï¼‰
```

**ä¼˜å…ˆçº§**: ğŸŸ¢ **P2 - éç´§æ€¥ä½†é‡è¦**

**é¢„è®¡å·¥ä½œé‡**: 3-5å¤©

---

## ğŸ“Š ä¼˜åŒ–ä¼˜å…ˆçº§æ€»ç»“

### ğŸ”´ **P0çº§ï¼ˆå¿…é¡»ç«‹å³å¤„ç†ï¼‰**- å½±å“äº§å“å¯ç”¨æ€§
1. **P0-1: çœŸæ­£çš„ä¸€é”®å®‰è£…åŒ…** â±ï¸ 5-7å¤© - æå…¶é‡è¦
2. **P0-2: ç»Ÿä¸€çš„3æ­¥é…ç½®å‘å¯¼** â±ï¸ 3-5å¤© - æ–°æ‰‹ä½“éªŒæ ¸å¿ƒ
3. **P0-3: Chromeæ‰©å±•v2.0å¢å¼º** â±ï¸ 2-3å¤© - æå‡æˆåŠŸç‡
4. **P0-4: å›¾åºŠTokenå®‰å…¨æœºåˆ¶** â±ï¸ 2å¤© - å®‰å…¨é—®é¢˜
5. **P0-5: ç¯å¢ƒæ£€æµ‹ä¸è‡ªåŠ¨ä¿®å¤** â±ï¸ 3-4å¤© - å¯ç”¨æ€§å…³é”®

**P0çº§æ€»å·¥ä½œé‡**: 15-21å¤©ï¼ˆ3-4å‘¨ï¼‰

### ğŸŸ¡ **P1çº§ï¼ˆé‡è¦å¢å¼ºï¼‰**- å½±å“ç”¨æˆ·ä½“éªŒ
1. **P1-1: å…è´£å£°æ˜å¼¹çª—** â±ï¸ 0.5å¤© - æ³•å¾‹åˆè§„
2. **P1-2: AIæ˜ å°„å­¦ä¹ å¼•æ“** â±ï¸ 4-5å¤© - æ™ºèƒ½åŒ–æ ¸å¿ƒ
3. **P1-3: ç³»ç»Ÿæ‰˜ç›˜å®æ—¶ç»Ÿè®¡** â±ï¸ 2-3å¤© - ä¾¿åˆ©æ€§
4. **P1-4: å…±äº«æµè§ˆå™¨ä¼˜åŒ–** â±ï¸ 0.5-1å¤© - å·²åŸºæœ¬å®ç°

**P1çº§æ€»å·¥ä½œé‡**: 7-9.5å¤©ï¼ˆ1.5-2å‘¨ï¼‰

### ğŸŸ¢ **P2çº§ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰**- æå‡å®Œå–„åº¦
1. **P2-1: æ•°æ®åº“ä¼˜åŒ–å·¥å…·** â±ï¸ 1-2å¤©
2. **P2-2: é€šçŸ¥ç³»ç»Ÿå¢å¼º** â±ï¸ 1-2å¤©
3. **P2-3: å®Œæ•´çš„å¸®åŠ©ç³»ç»Ÿ** â±ï¸ 3-5å¤©

**P2çº§æ€»å·¥ä½œé‡**: 5-9å¤©ï¼ˆ1-2å‘¨ï¼‰

---

## ğŸ“ˆ å®æ–½å»ºè®®

### é˜¶æ®µ1: æ ¸å¿ƒå¯ç”¨æ€§ï¼ˆP0çº§ï¼‰- 3-4å‘¨
**ç›®æ ‡**: è®©æ™®é€šç”¨æˆ·èƒ½å¤ŸçœŸæ­£ä¸‹è½½å³ç”¨

**é‡Œç¨‹ç¢‘**:
- âœ… å‘å¸ƒWindows/macOS/Linuxä¸€é”®å®‰è£…åŒ…
- âœ… æ–°æ‰‹é…ç½®æˆåŠŸç‡è¾¾åˆ°80%+
- âœ… ä¿®å¤æ‰€æœ‰å®‰å…¨æ¼æ´
- âœ… ç¯å¢ƒæ£€æµ‹é€šè¿‡ç‡90%+

### é˜¶æ®µ2: ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆP1çº§ï¼‰- 1.5-2å‘¨
**ç›®æ ‡**: æå‡ä½¿ç”¨ä¾¿åˆ©æ€§å’Œæ™ºèƒ½åŒ–

**é‡Œç¨‹ç¢‘**:
- âœ… AIæ˜ å°„å‡†ç¡®åº¦90%+
- âœ… å…è´£å£°æ˜åˆè§„
- âœ… æ‰˜ç›˜å¿«æ·æ“ä½œå®Œå–„

### é˜¶æ®µ3: ç³»ç»Ÿå®Œå–„ï¼ˆP2çº§ï¼‰- 1-2å‘¨
**ç›®æ ‡**: é•¿æœŸç¨³å®šè¿è¡Œå’Œç”¨æˆ·è‡ªåŠ©

**é‡Œç¨‹ç¢‘**:
- âœ… æ•°æ®åº“ä¼˜åŒ–ï¼Œé•¿æœŸè¿è¡Œæ— å‹åŠ›
- âœ… å®Œæ•´å¸®åŠ©ç³»ç»Ÿï¼Œç”¨æˆ·è‡ªåŠ©ç‡60%+

---

## ğŸ¯ å…³é”®æŒ‡æ ‡ï¼ˆKPIï¼‰

### æ˜“ç”¨æ€§æŒ‡æ ‡
- **é…ç½®æˆåŠŸç‡**: å½“å‰<50% â†’ ç›®æ ‡85%+
- **å¹³å‡é…ç½®æ—¶é—´**: å½“å‰15-30åˆ†é’Ÿ â†’ ç›®æ ‡5åˆ†é’Ÿå†…
- **æ–°æ‰‹æ”¾å¼ƒç‡**: å½“å‰>40% â†’ ç›®æ ‡<15%

### æ€§èƒ½æŒ‡æ ‡
- **å†…å­˜å ç”¨**: å½“å‰3GB (10è´¦å·) â†’ ç›®æ ‡<800MB
- **å¯åŠ¨æ—¶é—´**: å½“å‰30-60ç§’ â†’ ç›®æ ‡<10ç§’
- **ç¯å¢ƒæ£€æµ‹æ—¶é—´**: å½“å‰æ—  â†’ ç›®æ ‡5-10ç§’

### å®‰å…¨æŒ‡æ ‡
- **å·²çŸ¥å®‰å…¨æ¼æ´**: å½“å‰5ä¸ª â†’ ç›®æ ‡0ä¸ª
- **å›¾ç‰‡è®¿é—®æ§åˆ¶**: å½“å‰æ—  â†’ ç›®æ ‡TokenéªŒè¯
- **æ³•å¾‹åˆè§„**: å½“å‰æ— å…è´£ â†’ ç›®æ ‡å®Œæ•´å£°æ˜

---

## ğŸš¨ é£é™©è¯„ä¼°

### é«˜é£é™©é¡¹
1. **ä¸€é”®å®‰è£…åŒ…å¼€å‘** - æŠ€æœ¯å¤æ‚åº¦é«˜ï¼Œè·¨å¹³å°å…¼å®¹æ€§æŒ‘æˆ˜
   - ç¼“è§£æªæ–½: åˆ†å¹³å°é€æ­¥å®ç°ï¼Œå……åˆ†æµ‹è¯•
   
2. **å®‰å…¨æ¼æ´ä¿®å¤** - æ¶‰åŠå›¾ç‰‡è®¿é—®ï¼Œæ•°æ®æ³„éœ²é£é™©
   - ç¼“è§£æªæ–½: ä¼˜å…ˆå¤„ç†ï¼Œå®‰å…¨å®¡è®¡

### ä¸­é£é™©é¡¹
1. **AIæ˜ å°„å‡†ç¡®åº¦** - ç®—æ³•æ•ˆæœä¾èµ–æ•°æ®ç§¯ç´¯
   - ç¼“è§£æªæ–½: æä¾›æ‰‹åŠ¨è°ƒæ•´ï¼ŒæŒç»­ä¼˜åŒ–
   
2. **é…ç½®å‘å¯¼ç»Ÿä¸€** - å¤šç‰ˆæœ¬åˆå¹¶å¯èƒ½æœ‰é—æ¼
   - ç¼“è§£æªæ–½: å……åˆ†æµ‹è¯•ï¼Œç”¨æˆ·åé¦ˆ

---

## ğŸ“ ç»“è®º

å½“å‰ç³»ç»Ÿï¼ˆv10.0.0 Ultimate Editionï¼‰å·²ç»å®ç°äº†å¤§é‡åŠŸèƒ½ï¼Œä»£ç è´¨é‡è¾ƒé«˜ï¼Œæ¶æ„è®¾è®¡åˆç†ã€‚ä½†ä¸éœ€æ±‚æ–‡æ¡£ä¸­"ä¸€é”®å®‰è£…ã€å›¾å½¢åŒ–æ“ä½œã€é›¶ä»£ç åŸºç¡€å¯ç”¨"çš„ç›®æ ‡ä»æœ‰æ˜¾è‘—å·®è·ã€‚

**æ ¸å¿ƒé—®é¢˜**:
1. âŒ **å®‰è£…ä½“éªŒå·®** - éœ€è¦ç”¨æˆ·æ‰‹åŠ¨é…ç½®ç¯å¢ƒ
2. âŒ **é…ç½®æµç¨‹å¤æ‚** - å¤šä¸ªå‘å¯¼ç‰ˆæœ¬ï¼Œç¼ºä¹ç»Ÿä¸€æ€§
3. âŒ **å®‰å…¨æœºåˆ¶ä¸å®Œå–„** - å­˜åœ¨æ˜æ˜¾æ¼æ´
4. âš ï¸ **æ™ºèƒ½åŒ–ä¸è¶³** - AIæ˜ å°„ç®—æ³•è¿‡äºç®€å•

**å»ºè®®**:
1. **ä¼˜å…ˆå®ŒæˆP0çº§ä¼˜åŒ–**ï¼ˆ3-4å‘¨ï¼‰ï¼Œè§£å†³æ ¸å¿ƒå¯ç”¨æ€§é—®é¢˜
2. **ç„¶åè¿›è¡ŒP1çº§ä¼˜åŒ–**ï¼ˆ1.5-2å‘¨ï¼‰ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. **æœ€åP2çº§ä¼˜åŒ–**ï¼ˆ1-2å‘¨ï¼‰ï¼Œå®Œå–„ç³»ç»Ÿ

**é¢„è®¡æ€»å·¥ä½œé‡**: 27-32å¤©ï¼ˆçº¦6-7å‘¨ï¼‰

**å®Œæˆåé¢„æœŸæ•ˆæœ**:
- âœ… çœŸæ­£å®ç°"ä¸‹è½½å³ç”¨"
- âœ… æ–°æ‰‹é…ç½®æˆåŠŸç‡85%+
- âœ… é…ç½®æ—¶é—´ç¼©çŸ­åˆ°5åˆ†é’Ÿ
- âœ… æ— å®‰å…¨æ¼æ´ï¼Œæ³•å¾‹åˆè§„
- âœ… AIæ˜ å°„å‡†ç¡®åº¦90%+

---

**æŠ¥å‘Šç»“æŸ**

ç”Ÿæˆæ—¶é—´: 2025-10-28  
åˆ†æå·¥å…·: Claude Sonnet 4.5  
ä»£ç ä»“åº“: https://github.com/gfchfjh/CSBJJWT.git
