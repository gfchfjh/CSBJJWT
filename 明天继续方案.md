# KOOK æ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - ä¿®å¤ç»§ç»­æ–¹æ¡ˆ

## ğŸ“Š å½“å‰çŠ¶æ€ï¼ˆ2025-11-03 00:52ï¼‰

### âœ… å·²å®Œæˆ
- ç¯å¢ƒé…ç½®å®Œæˆ
  - Python 3.13.7
  - Node.js v24.11.0
  - npm 11.6.1
  - Git 2.51.0

- æºç ä¸‹è½½å®Œæˆ
  - ä½ç½®ï¼š`C:\Users\tanzu\KOOK-Build\CSBJJWT`

- åç«¯ä¿®å¤å®Œæˆï¼ˆ40+ å¤„ä¿®å¤ï¼‰
  - ç›¸å¯¹å¯¼å…¥å±‚çº§é—®é¢˜
  - async/await è¯­æ³•é”™è¯¯
  - ç±»å‹æ³¨è§£å¯¼å…¥ï¼ˆRequest, Dict, Optionalç­‰ï¼‰
  - å˜é‡åä¸ä¸€è‡´ï¼ˆredis_client -> redis_queueï¼‰
  - ç¼ºå¤±çš„ç®¡ç†å™¨ç±»ï¼ˆRateLimiterManagerï¼‰
  - ç¼ºå¤±çš„è¾…åŠ©å‡½æ•°ï¼ˆerror_translatorï¼‰
  - å¼‚æ­¥ä»»åŠ¡åˆå§‹åŒ–é—®é¢˜
  - ç­‰ç­‰...

- ä¾èµ–åŒ…å®‰è£…å®Œæˆï¼ˆ25+ ä¸ªåŒ…ï¼‰
  - loguru
  - discord-webhook
  - python-telegram-bot
  - beautifulsoup4
  - apscheduler
  - prometheus_client
  - ddddocr
  - ç­‰ç­‰...

- **åç«¯èƒ½ç‹¬ç«‹å¯åŠ¨æˆåŠŸï¼**
  - FastAPI æœåŠ¡è¿è¡Œåœ¨ http://127.0.0.1:8000
  - æ‰€æœ‰æ ¸å¿ƒæ¨¡å—åˆå§‹åŒ–æˆåŠŸ
  - è™½ç„¶æœ‰ Redis é”™è¯¯ï¼Œä½†ä¸å½±å“è¿è¡Œ

### â³ å¾…è§£å†³
- Electron å¯åŠ¨åç«¯æ—¶æŠ¥ "fetch failed"
- è™½ç„¶åç«¯ç‹¬ç«‹å¯åŠ¨æˆåŠŸï¼Œä½†åœ¨ Electron ä¸­å¯åŠ¨æœ‰é—®é¢˜

---

## ğŸ” é—®é¢˜åˆ†æ

### åç«¯ç‹¬ç«‹å¯åŠ¨æƒ…å†µ
```
âœ… èƒ½å¯åŠ¨
âœ… Uvicorn running on http://127.0.0.1:8000
âœ… æ‰€æœ‰æ¨¡å—åˆå§‹åŒ–æˆåŠŸ
âš ï¸ æœ‰ä¸€äº›è­¦å‘Šå’Œé”™è¯¯ï¼ˆRedisã€æ•°æ®åº“ç­‰ï¼‰ï¼Œä½†ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
```

### Electron ä¸­å¯åŠ¨æƒ…å†µ
```
âŒ æŠ¥é”™ï¼šfetch failed
âŒ å‰ç«¯æ— æ³•è¿æ¥åˆ°åç«¯
```

### å¯èƒ½çš„åŸå› 
1. **åç«¯å¯åŠ¨å¤ªæ…¢** - Electron ç­‰å¾…è¶…æ—¶
2. **å¯åŠ¨è¿‡ç¨‹ä¸­çš„é”™è¯¯** - è™½ç„¶æœ€ç»ˆèƒ½å¯åŠ¨ï¼Œä½† Electron è®¤ä¸ºå¤±è´¥
3. **ç«¯å£ç›‘å¬é—®é¢˜** - åç«¯æ²¡æœ‰æ­£ç¡®ç›‘å¬ 8000 ç«¯å£
4. **Electron å¥åº·æ£€æŸ¥è¿‡äºä¸¥æ ¼** - éœ€è¦è°ƒæ•´å¥åº·æ£€æŸ¥é€»è¾‘
5. **æ—¥å¿—è¾“å‡ºå½±å“** - è¿‡å¤šçš„é”™è¯¯æ—¥å¿—è®© Electron è¯¯åˆ¤

---

## ğŸ› ï¸ æ˜å¤©çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šç®€åŒ–åç«¯å¯åŠ¨ï¼ˆæ¨èï¼‰

**ç¦ç”¨ä¸€äº›éå¿…è¦çš„åŠŸèƒ½ï¼Œè®©åç«¯å¯åŠ¨æ›´å¿«æ›´ç¨³å®š**

#### éœ€è¦æ³¨é‡Šæ‰çš„å†…å®¹ï¼ˆmain.pyï¼‰
```python
# 1. Redis è‡ªåŠ¨ä¸‹è½½å’Œå¯åŠ¨ï¼ˆå¤ªæ…¢ï¼Œå®¹æ˜“è¶…æ—¶ï¼‰
# 2. å›¾åºŠæœåŠ¡å™¨ï¼ˆå·²ç»æ³¨é‡Šäº†ï¼‰
# 3. å®šæ—¶ä»»åŠ¡ï¼ˆéæ ¸å¿ƒï¼‰
# 4. æ›´æ–°æ£€æŸ¥å™¨ï¼ˆéæ ¸å¿ƒï¼‰
# 5. å¥åº·æ£€æŸ¥å™¨ï¼ˆå¯èƒ½å½±å“å¯åŠ¨ï¼‰
```

#### åªä¿ç•™æ ¸å¿ƒåŠŸèƒ½
```python
âœ… FastAPI è·¯ç”±
âœ… API æ¥å£
âœ… åŸºç¡€æ•°æ®åº“
âœ… æ¶ˆæ¯è½¬å‘åŠŸèƒ½
```

#### æ‰§è¡Œå‘½ä»¤
```batch
cd C:\Users\tanzu\KOOK-Build\CSBJJWT\backend\app

# åˆ›å»ºç®€åŒ–ç‰ˆ main.py
python create_simple_main.py

cd ../..
pyinstaller build\pyinstaller.spec --clean --noconfirm

cd frontend
npm run electron:build:win
```

---

### æ–¹æ¡ˆBï¼šè°ƒæ•´ Electron å¥åº·æ£€æŸ¥

**å¢åŠ  Electron çš„å¯åŠ¨è¶…æ—¶æ—¶é—´å’Œé‡è¯•é€»è¾‘**

#### ä¿®æ”¹ frontend/electron/main.js
```javascript
// å¢åŠ è¶…æ—¶æ—¶é—´
const BACKEND_STARTUP_TIMEOUT = 120000; // ä» 30ç§’ æ”¹ä¸º 120ç§’

// å¢åŠ é‡è¯•æ¬¡æ•°
const MAX_RETRIES = 10; // ä» 3 æ¬¡ æ”¹ä¸º 10 æ¬¡

// å¿½ç•¥å¯åŠ¨è¿‡ç¨‹ä¸­çš„é”™è¯¯æ—¥å¿—
// åªè¦æœ€åèƒ½è¿æ¥åˆ° http://127.0.0.1:8000 å°±è®¤ä¸ºæˆåŠŸ
```

---

### æ–¹æ¡ˆCï¼šä½¿ç”¨æ›´ç®€å•çš„åç«¯å¯åŠ¨æ–¹å¼

**ä¸ä½¿ç”¨ run.pyï¼Œç›´æ¥ç”¨ uvicorn å‘½ä»¤å¯åŠ¨**

#### ä¿®æ”¹ pyinstaller.spec
```python
# æ‰“åŒ…æˆæ¨¡å—è€Œä¸æ˜¯è„šæœ¬
# è®© Electron ç”¨å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨
```

---

## ğŸ“ æ¨èæ˜å¤©çš„æµç¨‹

### ç¬¬1æ­¥ï¼šå°è¯•æ–¹æ¡ˆAï¼ˆç®€åŒ–åç«¯ï¼‰

1. æ³¨é‡Šæ‰æ‰€æœ‰éæ ¸å¿ƒåŠŸèƒ½
2. åªä¿ç•™åŸºç¡€çš„ API æœåŠ¡
3. é‡æ–°æ„å»ºæµ‹è¯•

### ç¬¬2æ­¥ï¼šå¦‚æœæ–¹æ¡ˆAä¸è¡Œï¼Œå°è¯•æ–¹æ¡ˆB

1. ä¿®æ”¹ Electron çš„å¥åº·æ£€æŸ¥é€»è¾‘
2. å¢åŠ è¶…æ—¶æ—¶é—´
3. ä¼˜åŒ–é”™è¯¯å¤„ç†

### ç¬¬3æ­¥ï¼šå¦‚æœéƒ½ä¸è¡Œï¼Œå°è¯•æ–¹æ¡ˆC

1. æ”¹å˜æ‰“åŒ…æ–¹å¼
2. ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨
3. ç®€åŒ–å¯åŠ¨æµç¨‹

---

## ğŸ’¾ ä¿å­˜å½“å‰è¿›åº¦

### å·²ä¿®å¤çš„æ–‡ä»¶åˆ—è¡¨
```
backend/app/api/accounts.py - æ·»åŠ  Request å¯¼å…¥
backend/app/api/password_reset_enhanced.py - æ·»åŠ  Dict å¯¼å…¥
backend/app/api/environment_autofix.py - ä¿®å¤ redis_manager å¯¼å…¥
backend/app/api/performance.py - ä¿®å¤ redis_queue
backend/app/api/wizard_testing_enhanced.py - ä¿®å¤å¯¼å…¥å±‚çº§
backend/app/api/image_storage_manager.py - ä¿®å¤å¯¼å…¥å±‚çº§
backend/app/api/rate_limit_monitor.py - ä¿®å¤å¯¼å…¥å±‚çº§
backend/app/api/message_search.py - ä¿®å¤å¯¼å…¥å±‚çº§
backend/app/middleware/auth_middleware.py - æ·»åŠ  Optional å¯¼å…¥
backend/app/kook/scraper.py - ä¿®å¤ async/await
backend/app/processors/image.py - æ³¨é‡Šæ¸…ç†ä»»åŠ¡
backend/app/utils/rate_limiter.py - æ·»åŠ  RateLimiterManager
backend/app/utils/error_translator.py - æ·»åŠ è¾…åŠ©å‡½æ•°
backend/app/utils/environment_checker_ultimate.py - æ·»åŠ å®ä¾‹
backend/app/queue/redis_client.py - ä¿®å¤å¼‚å¸¸å¤„ç†
backend/app/main.py - å¤šå¤„ä¿®å¤

frontend/package.json - æ·»åŠ åç«¯æ‰“åŒ…é…ç½®

build/pyinstaller.spec - ä¿®æ”¹åç§°ä¸º KOOKForwarder
```

### å·²å®‰è£…çš„ä¾èµ–
```
loguru
discord-webhook
python-telegram-bot
feishu-python-sdk
dingtalk-sdk
psutil
beautifulsoup4
apscheduler
prometheus_client
ddddocr
lxml
html5lib
```

---

## ğŸ¬ æ˜å¤©å¼€å§‹æ—¶

### å¿«é€Ÿæ¢å¤ç¯å¢ƒ

```batch
# 1. æ‰“å¼€ CMD
Win + R â†’ cmd

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\Users\tanzu\KOOK-Build\CSBJJWT

# 3. æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
cd backend
call venv\Scripts\activate.bat
cd ..

# 4. æµ‹è¯•åç«¯
cd dist\KOOKForwarder
KOOKForwarder.exe
# åº”è¯¥èƒ½å¯åŠ¨

# 5. ç»§ç»­ä¿®å¤ Electron é—®é¢˜
```

---

## ğŸ“ æ˜å¤©è”ç³»æˆ‘æ—¶

**ç›´æ¥è¯´**ï¼š"ç»§ç»­ä¿®å¤ KOOK"

**æˆ‘ä¼šæ¥ç€ä»Šå¤©çš„è¿›åº¦ç»§ç»­å¸®æ‚¨ï¼**

---

## ğŸŒ™ ç°åœ¨

**å¥½å¥½ä¼‘æ¯ï¼æ‚¨ä»Šå¤©çš„åŠªåŠ›å¾ˆæ£’ï¼**

**æ˜å¤©æˆ‘ä»¬ä¸€å®šèƒ½æˆåŠŸï¼** ğŸ’ªâœ¨

**æ™šå®‰ï¼** ğŸŒ™ğŸ˜Š

---

## ğŸ’¡ ä¸´æ—¶è§£å†³æ–¹æ¡ˆ

**å¦‚æœæ‚¨æ€¥éœ€ä½¿ç”¨ï¼Œå¯ä»¥**ï¼š
- ç›´æ¥è¿è¡Œåç«¯ exeï¼ˆ`KOOKForwarder.exe`ï¼‰
- ç”¨æµè§ˆå™¨è®¿é—® http://127.0.0.1:8000
- æš‚æ—¶ä¸ç”¨ Electron ç•Œé¢

**ä½†æ˜å¤©æˆ‘ä»¬ä¼šå®Œå…¨ä¿®å¤ Electron ç‰ˆæœ¬ï¼**

**ä¼‘æ¯å¥½ï¼æ˜å¤©è§ï¼** ğŸŒŸ