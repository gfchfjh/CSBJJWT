# v1.9.1 安装和使用指南

**版本**: v1.9.1  
**发布日期**: 2025-10-20  
**适用人群**: 所有用户

---

## 🚀 快速安装

### 方法一：从源码安装（推荐）

```bash
# 1. 克隆仓库
git clone https://github.com/gfchfjh/CSBJJWT.git
cd CSBJJWT

# 2. 运行一键安装脚本
./install.sh  # Linux/macOS
# 或
install.bat   # Windows

# 3. 安装新依赖（v1.9.1新增）
cd frontend
npm install  # 会自动安装vue-i18n等新依赖

# 4. 启动服务
cd ..
./start.sh  # Linux/macOS
# 或
start.bat  # Windows
```

### 方法二：使用CI/CD构建包（即将可用）

```bash
# 等待v1.9.1 Tag推送后，GitHub Actions会自动构建
# 届时可从Release页面下载：
# - KookForwarder_v1.9.1_Windows_x64.exe
# - KookForwarder_v1.9.1_macOS.dmg
# - KookForwarder_v1.9.1_Linux_x64.AppImage
```

---

## 🆕 v1.9.1 新功能使用

### 1. 邮箱验证功能 🔐

#### 配置SMTP服务器

1. **进入系统设置**
   ```
   左侧菜单 → ⚙️ 系统设置 → 🔔 通知设置
   ```

2. **启用邮件告警并配置**
   ```
   启用邮件告警: [开启]
   
   SMTP服务器: smtp.gmail.com  (或其他邮箱服务器)
   SMTP端口: 587
   发件邮箱: your-email@gmail.com
   邮箱密码: [应用专用密码或授权码]
   收件邮箱: admin@example.com
   ```

3. **测试连接**
   ```
   点击"发送测试邮件"按钮
   检查邮箱是否收到测试邮件
   ```

#### 使用密码重置

1. **忘记密码时**
   ```
   登录页面 → 点击"忘记密码？"
   输入邮箱 → 点击"获取验证码"
   ```

2. **查收邮件**
   ```
   打开邮箱
   查看"密码重置验证码"邮件
   复制6位数字验证码
   ```

3. **完成重置**
   ```
   在对话框输入验证码
   点击"验证" → 设置新密码
   确认新密码 → 点击"重置密码"
   完成！使用新密码登录
   ```

**常用SMTP配置**:
```
Gmail:
  服务器: smtp.gmail.com
  端口: 587
  需要: 应用专用密码
  教程: https://support.google.com/accounts/answer/185833

QQ邮箱:
  服务器: smtp.qq.com
  端口: 465
  需要: 授权码
  教程: 邮箱设置 → 账户 → POP3/SMTP服务

163邮箱:
  服务器: smtp.163.com
  端口: 465
  需要: 授权码
```

---

### 2. 语言切换 🌍

#### 切换界面语言

1. **找到语言切换按钮**
   ```
   界面右上角 → 🇨🇳 简体中文（或🇺🇸 English）
   ```

2. **选择语言**
   ```
   点击下拉菜单
   选择：
   - 🇨🇳 简体中文
   - 🇺🇸 English
   ```

3. **完成切换**
   ```
   界面自动切换到所选语言
   偏好自动保存，下次启动生效
   ```

**当前支持语言**:
- 🇨🇳 简体中文 - 100%完整
- 🇺🇸 English - 80%完成（持续完善中）

**即将支持**:
- 🇯🇵 日本語
- 🇭🇰 繁體中文

---

### 3. CI/CD自动构建 🤖

#### 触发自动构建

**前提条件**:
- 拥有GitHub仓库的push权限
- 代码已推送到GitHub

**操作步骤**:

1. **提交代码**
   ```bash
   git add .
   git commit -m "Your changes"
   git push origin main
   ```

2. **创建并推送Tag**
   ```bash
   # 创建Tag
   git tag v1.9.1 -m "Release v1.9.1"
   
   # 推送Tag
   git push origin v1.9.1
   ```

3. **查看构建进度**
   ```
   打开GitHub仓库
   → Actions标签
   → 查看"Build and Release"工作流
   ```

4. **等待构建完成**
   ```
   预计耗时: 15-20分钟
   
   构建产物:
   ✓ Windows .exe (约150MB)
   ✓ macOS .dmg (约180MB)
   ✓ Linux .AppImage (约160MB)
   ```

5. **下载安装包**
   ```
   GitHub仓库 → Releases
   → 找到v1.9.1
   → 下载对应平台的安装包
   ```

#### 手动触发构建

```
GitHub仓库
→ Actions标签
→ "Build and Release"工作流
→ 点击"Run workflow"
→ 选择分支
→ 点击"Run workflow"按钮
```

---

## 🧪 测试验证

### 运行新增测试

#### 错误边界测试
```bash
cd backend
pytest tests/test_error_edge_cases.py -v

# 预期输出：
# test_network_timeout PASSED
# test_invalid_cookie_format PASSED
# test_auto_reconnect_mechanism PASSED
# ... (共24个测试)
# ========================= 24 passed in 10.5s =========================
```

#### 并发场景测试
```bash
pytest tests/test_concurrent_scenarios.py -v

# 预期输出：
# test_concurrent_account_startup PASSED
# test_high_volume_messages PASSED
# test_multiple_webhooks_load_balancing PASSED
# ... (共14个测试)
# ========================= 14 passed in 8.2s =========================
```

#### 所有测试（推荐）
```bash
# 运行所有测试并生成覆盖率报告
pytest tests/ -v --cov=app --cov-report=html

# 查看覆盖率报告
# Windows: start htmlcov/index.html
# macOS: open htmlcov/index.html
# Linux: xdg-open htmlcov/index.html
```

---

## 📋 组件使用示例

### EmailVerificationDialog组件

```vue
<template>
  <div>
    <el-button @click="showVerify = true">
      验证邮箱
    </el-button>
    
    <EmailVerificationDialog
      v-model="showVerify"
      :email="userEmail"
      @verified="handleVerified"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import EmailVerificationDialog from '@/components/EmailVerificationDialog.vue'

const showVerify = ref(false)
const userEmail = ref('user@example.com')

const handleVerified = (data) => {
  console.log('验证成功:', data)
  // data.email - 邮箱地址
  // data.resetToken - 重置令牌
}
</script>
```

### PasswordResetDialog组件

```vue
<template>
  <div>
    <el-button @click="showReset = true">
      重置密码
    </el-button>
    
    <PasswordResetDialog
      v-model="showReset"
      :email="userEmail"
      @success="handleSuccess"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import PasswordResetDialog from '@/components/PasswordResetDialog.vue'

const showReset = ref(false)
const userEmail = ref('user@example.com')

const handleSuccess = () => {
  console.log('密码重置成功')
  // 提示用户重新登录
}
</script>
```

### LanguageSwitcher组件

```vue
<template>
  <div class="header">
    <LanguageSwitcher />
  </div>
</template>

<script setup>
import LanguageSwitcher from '@/components/LanguageSwitcher.vue'
</script>
```

### i18n使用

```vue
<template>
  <div>
    <!-- 基础翻译 -->
    <h1>{{ $t('app.title') }}</h1>
    
    <!-- 带参数 -->
    <p>{{ $t('message.greeting', { name: userName }) }}</p>
    
    <!-- 在脚本中 -->
    <el-button @click="showMessage">
      {{ buttonText }}
    </el-button>
  </div>
</template>

<script setup>
import { computed } from 'vue'
import { useI18n } from 'vue-i18n'

const { t } = useI18n()

const userName = ref('张三')
const buttonText = computed(() => t('common.save'))

const showMessage = () => {
  console.log(t('message.success'))
}
</script>
```

---

## ⚙️ 配置说明

### 新增配置项

#### frontend/package.json
```json
{
  "version": "1.9.1",  // 版本号更新
  "dependencies": {
    "vue-i18n": "^9.8.0"  // 新增
  },
  "devDependencies": {
    "@vue/test-utils": "^2.4.3",  // 新增
    "vitest": "^1.1.0",  // 新增
    "@vitest/ui": "^1.1.0",  // 新增
    "@vitest/coverage-v8": "^1.1.0"  // 新增
  }
}
```

### 环境变量（可选）

#### 邮件配置
```env
# 如果使用环境变量配置SMTP
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

---

## 🐛 故障排查

### 问题1：npm install失败

**症状**: 安装vue-i18n时报错

**解决**:
```bash
# 清除缓存
npm cache clean --force

# 重新安装
rm -rf node_modules package-lock.json
npm install
```

### 问题2：测试运行失败

**症状**: pytest找不到模块

**解决**:
```bash
# 确保在backend目录
cd backend

# 安装测试依赖
pip install -r requirements-dev.txt

# 重新运行测试
pytest tests/ -v
```

### 问题3：CI/CD构建失败

**症状**: GitHub Actions报错

**解决**:
1. 检查workflow文件语法
2. 查看Actions日志定位错误
3. 确保依赖版本兼容

### 问题4：语言切换无效

**症状**: 点击语言切换后界面无变化

**解决**:
```bash
# 确保已安装vue-i18n
cd frontend
npm list vue-i18n

# 如果未安装
npm install vue-i18n@9

# 重启开发服务器
npm run dev
```

---

## 📚 相关文档

### 详细技术文档
- 📖 `完善工作总结报告.md` - 最详细的技术报告（800行）
- 📋 `CHANGELOG_v1.9.1.md` - 完整更新日志（300行）
- 📝 `本次完善说明-v1.9.1.md` - 快速参考（500行）

### 使用指南
- 🌍 `frontend/src/i18n/README.md` - 国际化使用指南（200行）
- 📖 `docs/完整用户手册.md` - 完整用户手册
- 🎓 `docs/开发指南.md` - 开发者指南

---

## ✅ 功能检查清单

安装完成后，请按此清单验证：

### 基础功能
- [ ] 后端服务正常启动（端口9527）
- [ ] 前端界面正常显示
- [ ] 可以登录系统（如有主密码）
- [ ] 可以添加KOOK账号

### 新增功能（v1.9.1）
- [ ] 语言切换按钮显示正常
- [ ] 可以在中英文之间切换
- [ ] Settings页面有邮件告警配置
- [ ] 可以发送测试邮件（配置SMTP后）

### 测试功能
- [ ] `pytest tests/test_error_edge_cases.py` 通过
- [ ] `pytest tests/test_concurrent_scenarios.py` 通过
- [ ] 测试覆盖率 ≥ 88%

### CI/CD功能
- [ ] `.github/workflows/build-and-release.yml` 存在
- [ ] 推送Tag后触发构建（可选验证）

---

## 🎯 推荐工作流

### 首次使用

```
1. 安装依赖
   └─> npm install

2. 配置SMTP（可选）
   └─> Settings → 邮件告警

3. 运行测试
   └─> pytest tests/ -v

4. 启动服务
   └─> ./start.sh

5. 体验新功能
   └─> 语言切换、邮箱验证
```

### 开发工作流

```
1. 开发新功能
   └─> 编写代码

2. 添加测试
   └─> pytest tests/

3. 运行测试
   └─> pytest -v

4. 提交代码
   └─> git commit

5. 创建Tag
   └─> git tag v1.9.x

6. 推送
   └─> git push --tags

7. 等待CI/CD
   └─> GitHub Actions自动构建
```

---

## 💡 使用技巧

### 技巧1：快速测试邮件功能

```bash
# 使用Gmail快速测试
1. 获取Gmail应用专用密码：
   https://myaccount.google.com/apppasswords

2. 在Settings配置：
   SMTP: smtp.gmail.com
   端口: 587
   邮箱: your-email@gmail.com
   密码: [应用专用密码]

3. 点击"发送测试邮件"
```

### 技巧2：快速切换语言

```
快捷键（计划中）:
Ctrl/Cmd + L → 打开语言菜单

或点击：
右上角 → 🇨🇳/🇺🇸 图标
```

### 技巧3：验证CI/CD不破坏功能

```bash
# 创建测试Tag（不会发布）
git tag v1.9.1-test
git push origin v1.9.1-test

# 查看构建
# 构建成功后删除测试Tag
git tag -d v1.9.1-test
git push origin :refs/tags/v1.9.1-test
```

---

## ⚠️ 注意事项

### 邮件功能
- ⚠️ **需要真实SMTP服务器** - 测试环境可用Gmail
- ⚠️ **授权码不是登录密码** - QQ/163需要单独申请
- ⚠️ **端口选择**: 587（TLS）或465（SSL）

### 语言切换
- ⚠️ **部分内容未翻译** - 英文翻译约80%完成
- ⚠️ **Element Plus语言** - 需手动同步切换
- ⚠️ **刷新可能需要** - 部分组件需要刷新页面

### CI/CD构建
- ⚠️ **首次构建较慢** - 需要下载依赖，约20-30分钟
- ⚠️ **macOS签名** - 需要额外配置Apple开发者证书
- ⚠️ **产物保存期** - GitHub Artifacts保存7天

---

## 🆘 获取帮助

### 文档资源
1. **完善工作总结报告.md** - 技术细节
2. **v1.9.1完善说明.md** - 快速参考
3. **frontend/src/i18n/README.md** - i18n使用
4. **docs/** - 完整用户手册

### 在线资源
- GitHub Issues: https://github.com/gfchfjh/CSBJJWT/issues
- 文档中心: https://github.com/gfchfjh/CSBJJWT/tree/main/docs

### 常见问题

**Q: 如何获取Gmail应用专用密码？**
A: https://support.google.com/accounts/answer/185833

**Q: 验证码收不到怎么办？**
A: 检查垃圾邮件文件夹，确认SMTP配置正确

**Q: CI/CD构建失败怎么办？**
A: 查看Actions日志，确保依赖版本兼容

**Q: 语言切换后部分文字未变？**
A: 英文翻译还在完善中，预计v1.9.2完成

---

## 🎉 总结

v1.9.1 带来了4个重要完善：

1. ✅ **邮件告警100%完整** - 验证、重置、通知
2. ✅ **CI/CD全自动化** - 构建、测试、发布
3. ✅ **测试更完善** - +38个用例，88%覆盖率
4. ✅ **国际化就绪** - 中英双语，易扩展

**立即开始使用这些新功能吧！** 🚀

---

**文档版本**: v1.0  
**最后更新**: 2025-10-20  
**维护者**: KOOK Forwarder Team
