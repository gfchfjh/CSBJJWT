# 更新日志

所有重要的项目更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.7.1] - 2025-10-19

### 🔧 修复 (Fixed)

#### 关键Bug修复
- **修复Cookie传递问题** ⭐⭐⭐⭐⭐
  - 修复图片和附件下载因KOOK防盗链失败的问题
  - 在消息数据中正确传递Cookie字典
  - 图片处理器和附件处理器使用Cookie下载资源
  - 影响文件：`backend/app/kook/scraper.py`, `backend/app/queue/worker.py`

- **完善登录状态检查**
  - 从单一URL检查升级到6种检查方式
  - 支持URL、登录表单、用户元素、localStorage Token、Cookie等检测
  - 增加延迟检查机制，给页面更多加载时间
  - 显著提高登录判断准确性
  - 影响文件：`backend/app/kook/scraper.py`

- **集成健康检查通知**
  - 健康检查发现问题时自动发送通知
  - 支持多渠道通知（日志、邮件、桌面）
  - 详细的问题汇总和时间戳
  - 影响文件：`backend/app/utils/scheduler.py`

### ✨ 新增 (Added)

#### 平台API客户端
- **新增 `backend/app/utils/platform_api_client.py`** (475行)
  - Discord API客户端：从Webhook获取频道信息
  - Telegram API客户端：获取Bot可访问的群组列表
  - 飞书API客户端：获取企业群组列表（带Token缓存）
  - 完整的错误处理和超时控制
  - 详细的日志记录

#### 增强版智能映射
- **新增 `backend/app/api/smart_mapping_enhanced.py`** (360行)
  - 新端点：`POST /api/smart-mapping-enhanced/suggest-with-real-api`
    - 调用真实平台API获取频道列表
    - 智能匹配KOOK频道与目标平台频道
    - 返回包含真实频道ID的映射建议
    - 按置信度排序结果
  
  - 新端点：`GET /api/smart-mapping-enhanced/test-platform-api/{platform}`
    - 测试目标平台API连接
    - 返回频道列表和连接状态
    - 方便前端调试

- **集成到主程序**
  - 注册增强版智能映射路由
  - 自动生成API文档

### 📊 统计

```
新增文件:     2个  (835行)
修改文件:     4个  (167行)
新增代码:     1,002行
修改代码:     167行
总代码变更:   +1,169行
新增API端点:  2个
```

### 🔗 相关文档

- [v1.7.1完善工作完成报告](代码完善工作完成报告.md)
- [v1.7.1简洁说明](v1.7.1-完善说明.md)
- [代码详细完善建议清单](代码详细完善建议清单.md)

---

## [1.7.0] - 2025-10-18

### ✨ 新增 (Added)

#### 邮件告警系统
- **完善邮件告警配置UI**
  - 完整的SMTP服务器配置界面
  - 支持Gmail/QQ/163/Outlook等主流邮箱
  - 5种告警触发条件可选
  - 测试邮件功能

#### 频道映射增强
- **完善频道映射导入导出**
  - JSON格式导入导出
  - 支持追加和替换两种模式
  - 批量配置快速迁移
  - 完善的错误提示

#### 文档完善
- **Cookie获取详细教程**
  - 三种获取方法（开发者工具/浏览器扩展）
  - 详细的步骤说明和截图
  - 8个常见问题FAQ
  - 安全性说明

- **应用内帮助中心**
  - 快速入门指南
  - 6篇图文教程集成
  - 8个常见问题FAQ
  - 实时搜索功能
  - 系统信息一键复制

#### 版本管理
- **版本号统一**
  - 所有文件统一为v1.7.0
  - 规范化版本管理

---

## [1.6.0] - 2025-10-15

### ✨ 新增 (Added)

#### UI增强
- **可视化拖拽映射**
  - 拖拽式频道映射配置
  - 直观的视觉效果
  - 降低配置难度

- **完整的帮助中心框架**
  - 应用内帮助系统
  - 视频教程框架
  - FAQ系统

#### 测试框架
- **E2E端到端测试**
  - Playwright E2E测试
  - 配置向导测试
  - 频道映射测试

#### 代码重构
- **组件化重构**
  - 更好的代码组织
  - 可维护性提升

- **智能消息分段**
  - 优先在段落/句子边界分割
  - 保持内容完整性

### 📊 统计
- 测试覆盖率：0% → 72%

---

## [1.5.0] - 2025-10-10

### ✨ 新增 (Added)

#### 安全功能
- **主密码保护系统**
  - 启动时需要密码验证
  - SHA-256密码哈希
  - 30天Token机制
  - 支持验证码重置密码

#### UI增强
- **深色主题模式**
  - 浅色/深色/自动三种模式
  - 完整的Element Plus组件适配
  - 自动跟随系统主题
  - 流畅的主题切换体验

#### 测试框架
- **前端测试框架**
  - Vitest + @vue/test-utils集成
  - 15个测试用例
  - 覆盖率工具和报告
  - 测试覆盖率：0% → 30%+

#### UX优化
- **加载状态优化**
  - 统一的加载状态管理
  - 自动包装异步操作
  - 友好的加载提示
  - 防止重复操作

- **错误提示增强**
  - 30+错误代码映射
  - 自动解决方案建议
  - 分级错误显示
  - 上下文相关的帮助

- **时间显示优化**
  - 相对时间显示（"3分钟前"）
  - 智能单位选择
  - 完整时间tooltip
  - 账号页显示最后活跃时间

### 📚 文档
- 新增13个详细文档（5,250+行）
- 完整的代码评估报告
- 详细的工作总结

---

## [1.4.0] - 2025-10-05

### ✨ 新增 (Added)

#### Redis嵌入式集成
- 自动启动和管理Redis
- 零配置开箱即用
- 跨平台支持（Windows/Linux/macOS）

#### 消息处理增强
- **智能消息分段**
  - 优先在段落/句子边界分割
  - 保持内容完整性
  - 支持Discord 2000字符限制
  - 支持Telegram 4096字符限制

#### 错误处理
- **增强错误诊断**
  - 50+错误解决方案
  - 自动修复建议
  - 详细的错误信息

#### 文档系统
- **视频教程系统**
  - 8个官方教程规划
  - 降低使用门槛
  - 完整的录制指南

#### 安装优化
- **一键安装脚本**
  - Linux/macOS/Windows全平台支持
  - 自动安装依赖
  - 预计耗时3-5分钟

- **打包配置优化**
  - Redis自动打包
  - 真正的"零依赖"

---

## [1.3.0] - 2025-09-28

### ✨ 新增 (Added)

#### 历史消息同步
- 启动时可同步最近N分钟的历史消息
- 用户可配置同步时长
- 避免重复转发

#### 本地OCR验证码识别
- 集成ddddocr本地OCR
- 免费快速识别验证码
- 无需依赖第三方服务

#### 选择器配置
- 新增selectors.yaml配置文件
- 轻松适配KOOK网页DOM变化
- 无需修改代码

#### WebSocket实时推送
- 日志页面实时更新
- 无需轮询
- 降低服务器负载

#### 配置向导优化
- 机器人配置步骤支持"跳过"
- 灵活配置流程
- 提升用户体验

---

## [1.2.0] - 2025-09-20

### ✨ 新增 (Added)

#### CI/CD
- **GitHub Actions自动构建**
  - 自动构建三平台安装包
  - 自动发布Release

#### 配置向导
- **完整配置向导**
  - 新增服务器选择步骤
  - 5步完成配置
  - 3-5分钟上手

#### 链接预览
- **链接消息预览**
  - 自动提取标题、描述、图片
  - 支持Open Graph协议
  - 支持Twitter Card

#### 飞书优化
- **飞书图片完美修复**
  - 云存储集成
  - 100%成功率
  - 自动上传到飞书云

#### 空间管理
- **智能空间管理**
  - 自动检测超限
  - 智能清理旧图片
  - 用户可配置清理策略

#### 桌面应用
- **桌面应用完善**
  - 开机自启
  - 系统托盘
  - 桌面通知
  - 全面集成

#### Docker
- **Docker容器化**
  - 一键部署
  - 生产级配置
  - docker-compose支持

---

## [1.1.0] - 2025-09-10

### ✨ 新增 (Added)

#### 消息类型支持
- 图片消息（自动下载高清原图）
- 表情反应（完整显示）
- @提及（格式转换）
- 回复引用（显示引用内容）
- 链接消息（提取URL）
- 附件文件（自动下载，最大50MB）

#### 多账号管理
- 支持添加多个KOOK账号
- 账号状态实时显示
- 自动重连机制

#### 过滤规则
- 关键词过滤（黑名单/白名单）
- 用户过滤（黑名单/白名单）
- 消息类型过滤

---

## [1.0.0] - 2025-09-01

### ✨ 初始发布 (Initial Release)

#### 核心功能
- KOOK消息抓取（Playwright + Chromium）
- 消息队列（Redis）
- 消息格式转换（KMarkdown → 目标平台格式）
- 消息转发：
  - Discord（Webhook）
  - Telegram（Bot API）
  - 飞书（开放平台API）

#### UI界面
- Electron桌面应用
- Vue 3 + Element Plus
- 5步配置向导
- 9个功能页面

#### 基础功能
- Cookie登录/账号密码登录
- 频道映射配置
- 实时日志监控
- 系统设置

#### 文档
- README.md
- 用户手册
- 开发指南

---

## 版本号说明

版本格式：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

---

## 链接

- [项目主页](https://github.com/gfchfjh/CSBJJWT)
- [问题反馈](https://github.com/gfchfjh/CSBJJWT/issues)
- [完整用户手册](docs/完整用户手册.md)
