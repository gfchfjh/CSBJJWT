# KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ v1.1.0 - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ‰ æ–°åŠŸèƒ½ä»‹ç»

æœ¬ç‰ˆæœ¬æ–°å¢äº†ä»¥ä¸‹é‡è¦åŠŸèƒ½ï¼š

### 1. ğŸ“¸ å›¾ç‰‡è½¬å‘åŠŸèƒ½
- è‡ªåŠ¨ä¸‹è½½å¹¶è½¬å‘å›¾ç‰‡æ¶ˆæ¯
- æ”¯æŒå›¾ç‰‡å‹ç¼©ï¼ˆèŠ‚çœç©ºé—´ï¼‰
- å†…ç½®å›¾åºŠæœåŠ¡ï¼ˆå¸¦Tokenå®‰å…¨éªŒè¯ï¼‰
- ä¸‰ç§å¤„ç†ç­–ç•¥å¯é€‰

### 2. ğŸ¯ é¦–æ¬¡é…ç½®å‘å¯¼
- å…¨æ–°çš„4æ­¥é…ç½®æµç¨‹
- å›¾å½¢åŒ–å¼•å¯¼ï¼Œé™ä½é…ç½®éš¾åº¦
- è‡ªåŠ¨æ£€æµ‹é¦–æ¬¡å¯åŠ¨

### 3. ğŸ”§ å®Œæ•´çš„è¿‡æ»¤è§„åˆ™
- å…³é”®è¯é»‘/ç™½åå•
- ç”¨æˆ·é»‘/ç™½åå•
- æ¶ˆæ¯ç±»å‹è¿‡æ»¤
- æ•°æ®æŒä¹…åŒ–

### 4. ğŸ“¦ æ‰“åŒ…é…ç½®
- å®Œæ•´çš„æ‰“åŒ…è„šæœ¬
- æ”¯æŒWindows/macOS/Linux
- ä¸€é”®æ‰“åŒ…å‘½ä»¤

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
# åç«¯ä¾èµ–
cd backend
pip install -r requirements.txt
playwright install chromium

# å‰ç«¯ä¾èµ–
cd ../frontend
npm install

cd ..
```

### æ­¥éª¤2: å¯åŠ¨Redis

```bash
# Linux/macOS
redis-server

# Windows
# ä¸‹è½½Redis for Windowså¹¶å¯åŠ¨
redis-server.exe
```

### æ­¥éª¤3: å¯åŠ¨åç«¯æœåŠ¡

```bash
cd backend
python -m app.main
```

åç«¯å°†åœ¨ **http://localhost:9527** è¿è¡Œ

**æ–°å¢**: å›¾åºŠæœåŠ¡åœ¨ **http://localhost:9528** è¿è¡Œ

### æ­¥éª¤4: å¯åŠ¨å‰ç«¯

```bash
cd frontend
npm run dev
```

å‰ç«¯å°†åœ¨ **http://localhost:5173** è¿è¡Œ

### æ­¥éª¤5: é¦–æ¬¡é…ç½®

1. æµè§ˆå™¨æ‰“å¼€ http://localhost:5173
2. **è‡ªåŠ¨è·³è½¬åˆ°é…ç½®å‘å¯¼**ï¼ˆé¦–æ¬¡å¯åŠ¨ï¼‰
3. æŒ‰ç…§å‘å¯¼æ­¥éª¤å®Œæˆé…ç½®ï¼š
   - æ¬¢è¿é¡µ â†’ æ·»åŠ KOOKè´¦å· â†’ é…ç½®æœºå™¨äºº â†’ å®Œæˆ
4. è¿›å…¥ä¸»ç•Œé¢

---

## ğŸ¯ æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### 1. ä½¿ç”¨é¦–æ¬¡é…ç½®å‘å¯¼

#### è‡ªåŠ¨å¯åŠ¨
é¦–æ¬¡æ‰“å¼€åº”ç”¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°é…ç½®å‘å¯¼ï¼ˆ`/wizard`ï¼‰

#### æ‰‹åŠ¨è®¿é—®
```
http://localhost:5173/wizard
```

#### è·³è¿‡å‘å¯¼
å¦‚æœæƒ³è·³è¿‡å‘å¯¼ï¼Œç‚¹å‡»"è·³è¿‡å‘å¯¼"æŒ‰é’®ï¼Œæˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
localStorage.setItem('wizard_completed', 'true')
```

#### é‡æ–°é…ç½®
å¦‚æœæƒ³é‡æ–°è¿è¡Œå‘å¯¼ï¼š
```javascript
localStorage.removeItem('wizard_completed')
// ç„¶ååˆ·æ–°é¡µé¢
```

---

### 2. é…ç½®å›¾ç‰‡è½¬å‘

#### ä¿®æ”¹å›¾ç‰‡å¤„ç†ç­–ç•¥

ç¼–è¾‘ `backend/app/config.py` æˆ–åˆ›å»º `.env` æ–‡ä»¶ï¼š

```python
# .env æ–‡ä»¶
image_strategy=smart        # æ™ºèƒ½æ¨¡å¼ï¼ˆæ¨èï¼‰
# image_strategy=direct     # ä»…ç›´ä¼ 
# image_strategy=imgbed     # ä»…å›¾åºŠ

image_max_size_mb=10.0      # å•å›¾æœ€å¤§10MB
image_compression_quality=85 # å‹ç¼©è´¨é‡85%
image_cleanup_days=7        # 7å¤©åæ¸…ç†æ—§å›¾
```

#### æŸ¥çœ‹å›¾åºŠçŠ¶æ€

è®¿é—®å›¾åºŠå¥åº·æ£€æŸ¥æ¥å£ï¼š
```
http://localhost:9528/health
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "status": "ok",
  "storage_size_gb": 0.5,
  "storage_path": "/Users/xxx/Documents/KookForwarder/data/images"
}
```

#### æ‰‹åŠ¨æ¸…ç†æ—§å›¾ç‰‡

åœ¨Pythonåç«¯æ§åˆ¶å°ï¼š
```python
from app.processors.image import image_processor
await image_processor.cleanup_old_images(days=7)
```

---

### 3. ä½¿ç”¨è¿‡æ»¤è§„åˆ™

#### è®¿é—®è¿‡æ»¤è§„åˆ™é¡µé¢

```
ä¸»ç•Œé¢ â†’ ä¾§è¾¹æ  â†’ è¿‡æ»¤è§„åˆ™
```

#### é…ç½®å…³é”®è¯è¿‡æ»¤

1. **é»‘åå•**ï¼šè¾“å…¥å…³é”®è¯ï¼ŒæŒ‰å›è½¦æ·»åŠ 
   - ä¾‹å¦‚ï¼šå¹¿å‘Šã€ä»£ç»ƒã€å¤–æŒ‚
   - åŒ…å«è¿™äº›è¯çš„æ¶ˆæ¯ä¸ä¼šè½¬å‘

2. **ç™½åå•**ï¼šè¾“å…¥å…³é”®è¯ï¼ŒæŒ‰å›è½¦æ·»åŠ 
   - ä¾‹å¦‚ï¼šå®˜æ–¹å…¬å‘Šã€ç‰ˆæœ¬æ›´æ–°
   - ä»…è½¬å‘åŒ…å«è¿™äº›è¯çš„æ¶ˆæ¯ï¼ˆå¦‚æœç™½åå•ä¸ºç©ºåˆ™ä¸é™åˆ¶ï¼‰

3. **å¯ç”¨è¿‡æ»¤**ï¼šåˆ‡æ¢å¼€å…³

#### é…ç½®ç”¨æˆ·è¿‡æ»¤

1. **æ·»åŠ ç”¨æˆ·**ï¼šç‚¹å‡»"æ·»åŠ ç”¨æˆ·"æŒ‰é’®
   - è¾“å…¥ç”¨æˆ·IDæˆ–ç”¨æˆ·å
   - é€‰æ‹©æ·»åŠ åˆ°é»‘åå•æˆ–ç™½åå•

2. **é»‘åå•**ï¼šä¸è½¬å‘åˆ—è¡¨ä¸­ç”¨æˆ·çš„æ¶ˆæ¯
3. **ç™½åå•**ï¼šä»…è½¬å‘åˆ—è¡¨ä¸­ç”¨æˆ·çš„æ¶ˆæ¯

#### é…ç½®æ¶ˆæ¯ç±»å‹

å‹¾é€‰è¦è½¬å‘çš„æ¶ˆæ¯ç±»å‹ï¼š
- âœ… æ–‡æœ¬æ¶ˆæ¯
- âœ… å›¾ç‰‡æ¶ˆæ¯
- âœ… æ–‡ä»¶é™„ä»¶
- âœ… é“¾æ¥æ¶ˆæ¯
- â˜ è¡¨æƒ…ååº”
- â˜ @æåŠ

#### ç‰¹æ®Šé€‰é¡¹

- **ä»…è½¬å‘@å…¨ä½“æˆå‘˜çš„æ¶ˆæ¯**ï¼šé€‚ç”¨äºåªå…³æ³¨é‡è¦å…¬å‘Šçš„åœºæ™¯

#### ä¿å­˜è§„åˆ™

é…ç½®å®Œæˆåï¼Œç‚¹å‡»"ä¿å­˜è§„åˆ™"æŒ‰é’®ï¼Œè§„åˆ™ä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“ã€‚

---

### 4. APIä½¿ç”¨

#### è·å–è¿‡æ»¤è§„åˆ™

```bash
curl http://localhost:9527/api/system/filter-rules
```

#### ä¿å­˜è¿‡æ»¤è§„åˆ™

```bash
curl -X POST http://localhost:9527/api/system/filter-rules \
  -H "Content-Type: application/json" \
  -d '{
    "scope": "global",
    "keyword_blacklist": ["å¹¿å‘Š", "ä»£ç»ƒ"],
    "keyword_filter_enabled": true,
    "message_types": ["text", "image"]
  }'
```

#### å›¾ç‰‡å¤„ç†ç¤ºä¾‹

```python
from app.processors.image import image_processor

# ä¸‹è½½å¹¶å¤„ç†å›¾ç‰‡
result = await image_processor.process_image(
    url="https://example.com/image.jpg",
    strategy="smart",  # æ™ºèƒ½æ¨¡å¼
    cookies={"token": "xxx"},
    referer="https://www.kookapp.cn"
)

# result å¯èƒ½æ˜¯ï¼š
# - åŸå§‹URLï¼ˆç›´ä¼ æˆåŠŸï¼‰
# - æœ¬åœ°å›¾åºŠURLï¼ˆç›´ä¼ å¤±è´¥ï¼Œä½¿ç”¨å›¾åºŠï¼‰
# - åŒ…å«ä¸¤è€…çš„å­—å…¸ï¼ˆæ™ºèƒ½æ¨¡å¼ï¼‰
```

---

## ğŸ“¦ æ‰“åŒ…åº”ç”¨ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### Linux/macOS

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x build/build_all.sh

# æ‰§è¡Œæ‰“åŒ…
./build/build_all.sh
```

### Windows

```cmd
build\build_all.bat
```

### è¾“å‡ºäº§ç‰©

æ‰“åŒ…å®Œæˆåï¼Œå®‰è£…åŒ…ä½äºï¼š

```
frontend/dist-electron/
â”œâ”€â”€ KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ_v1.1.0_Windows_x64.exe      # Windows
â”œâ”€â”€ KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ_v1.1.0_macOS.dmg             # macOS
â””â”€â”€ KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ_v1.1.0_Linux_x64.AppImage    # Linux
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: é¦–æ¬¡å¯åŠ¨æ²¡æœ‰è·³è½¬åˆ°å‘å¯¼ï¼Ÿ

**A**: æ£€æŸ¥localStorageï¼š
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
console.log(localStorage.getItem('wizard_completed'))
// å¦‚æœæ˜¯ 'true'ï¼Œè¯´æ˜å·²å®Œæˆå‘å¯¼

// æ¸…é™¤çŠ¶æ€é‡æ–°è¿è¡Œ
localStorage.removeItem('wizard_completed')
location.reload()
```

### Q2: å›¾ç‰‡è½¬å‘å¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. å›¾åºŠæœåŠ¡æ˜¯å¦å¯åŠ¨ï¼ˆhttp://localhost:9528/healthï¼‰
2. å­˜å‚¨ç›®å½•æ˜¯å¦æœ‰å†™å…¥æƒé™
3. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
4. å°è¯•åˆ‡æ¢å›¾ç‰‡ç­–ç•¥ï¼ˆsmart â†’ direct â†’ imgbedï¼‰

### Q3: è¿‡æ»¤è§„åˆ™ä¸ç”Ÿæ•ˆï¼Ÿ

**A**: 
1. ç¡®è®¤å·²ç‚¹å‡»"ä¿å­˜è§„åˆ™"
2. æ£€æŸ¥æ˜¯å¦å¯ç”¨äº†è¿‡æ»¤å¼€å…³
3. é‡å¯æœåŠ¡ä½¿è§„åˆ™ç”Ÿæ•ˆ
4. æŸ¥çœ‹åç«¯æ—¥å¿—ä¸­çš„è¿‡æ»¤åŸå› 

### Q4: æ‰“åŒ…å¤±è´¥ï¼Ÿ

**A**:
1. ç¡®è®¤å·²å®‰è£…æ‰€æœ‰ä¾èµ–
   ```bash
   # æ£€æŸ¥PyInstaller
   pip show pyinstaller
   
   # æ£€æŸ¥electron-builder
   npm list electron-builder
   ```

2. æ£€æŸ¥Pythonå’ŒNode.jsç‰ˆæœ¬
   ```bash
   python --version  # éœ€è¦ 3.11+
   node --version    # éœ€è¦ 16+
   ```

3. æŸ¥çœ‹æ‰“åŒ…æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å›¾ç‰‡å­˜å‚¨ç›‘æ§

è®¿é—®å›¾åºŠå¥åº·æ£€æŸ¥ï¼š
```bash
curl http://localhost:9528/health
```

### ç³»ç»ŸçŠ¶æ€

è®¿é—®ç³»ç»ŸçŠ¶æ€æ¥å£ï¼š
```bash
curl http://localhost:9527/api/system/status
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
  "service_running": true,
  "redis_connected": true,
  "queue_size": 5,
  "active_scrapers": 1
}
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶è¯´æ˜

### backend/.env

```env
# APIæœåŠ¡
API_HOST=127.0.0.1
API_PORT=9527

# Redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# å›¾ç‰‡å¤„ç†
IMAGE_SERVER_PORT=9528
IMAGE_MAX_SIZE_MB=10.0
IMAGE_COMPRESSION_QUALITY=85
IMAGE_CLEANUP_DAYS=7
IMAGE_STORAGE_MAX_GB=10.0
IMAGE_STRATEGY=smart

# æ—¥å¿—
LOG_LEVEL=INFO
LOG_RETENTION_DAYS=3
```

---

## ğŸ“ è¿›é˜¶ç”¨æ³•

### è‡ªå®šä¹‰å›¾ç‰‡å¤„ç†

```python
from app.processors.image import image_processor

# ä¿®æ”¹å‹ç¼©è´¨é‡
image_processor.compress_image(
    image_data=data,
    max_size_mb=5.0,    # æœ€å¤§5MB
    quality=75          # è´¨é‡75%
)

# ç”Ÿæˆæ°¸ä¹…URLï¼ˆä¸è¿‡æœŸï¼‰
url = image_processor.generate_url(
    filepath="/path/to/image.jpg",
    expire_hours=8760  # 1å¹´ = 365*24
)
```

### ç¼–ç¨‹æ–¹å¼æ·»åŠ è¿‡æ»¤è§„åˆ™

```python
from app.processors.filter import message_filter

# æ·»åŠ è§„åˆ™
rules = {
    "scope": "global",
    "keyword_blacklist": ["spam", "ad"],
    "keyword_filter_enabled": True,
    "user_blacklist": [
        {"id": "123", "name": "spammer"}
    ],
    "user_filter_enabled": True,
    "message_types": ["text", "image"]
}

# ä¿å­˜
success = message_filter.save_rules(rules)
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæˆåº¦è¯„ä¼°æŠ¥å‘Š](/workspace/KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿå®Œæˆåº¦è¯„ä¼°æŠ¥å‘Š.md)
- [ä»£ç æ”¹è¿›æ€»ç»“](/workspace/ä»£ç æ”¹è¿›æ€»ç»“.md)
- [README](README.md)
- [å¼€å‘æŒ‡å—](docs/å¼€å‘æŒ‡å—.md)

---

## ğŸ™ åé¦ˆä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼š

- **GitHub Issues**: https://github.com/yourusername/kook-forwarder/issues
- **Email**: your.email@example.com

---

<div align="center">

**ç‰ˆæœ¬**: v1.1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-12  
**æ–°å¢åŠŸèƒ½**: å›¾ç‰‡è½¬å‘ + é…ç½®å‘å¯¼ + è¿‡æ»¤è§„åˆ™ + æ‰“åŒ…é…ç½®

Made with â¤ï¸ by KOOK Forwarder Team

</div>
