# 应用启动失败 - 紧急排查指南

## ⚠️ 问题：安装后没有弹出任何界面

**症状**: 双击安装包/应用图标后，完全没有窗口出现。

---

## 🔍 紧急排查步骤

应用可能已经启动，但窗口最小化到了系统托盘。

**Windows**:
1. 查看任务栏右下角（时钟旁边）
2. 点击 `^` 展开隐藏图标
3. 找是否有 KOOK 图标（或类似图标）
4. **双击图标**打开主窗口

**macOS**:
1. 查看屏幕右上角菜单栏
2. 找是否有 KOOK 图标
3. **点击图标** → 选择"显示主窗口"

**Linux**:
1. 查看系统托盘区域
2. 找 KOOK 图标
3. 双击或右键选择"显示窗口"

**如果找到了图标 → 问题解决！双击即可打开主窗口**

---

### 步骤 2：检查应用是否在运行

**Windows - 任务管理器**:
```
1. 按 Ctrl + Shift + Esc 打开任务管理器
2. 切换到"详细信息"或"进程"标签
3. 查找以下进程：
   - KOOK消息转发系统.exe
   - electron.exe
   - python.exe（可能有多个）
   
如果找到：
   → 说明应用已启动，窗口可能被隐藏
   → 右键进程 → 结束任务 → 重新打开应用
```

**macOS - 活动监视器**:
```
1. 打开"应用程序" → "实用工具" → "活动监视器"
2. 搜索：KOOK 或 electron 或 python
3. 如果找到进程：
   → 选中 → 点击 ✕ 强制退出
   → 重新打开应用
```

**Linux - 终端**:
```bash
# 检查进程
ps aux | grep -i kook
ps aux | grep -i electron
ps aux | grep python

# 如果找到进程，记下 PID，然后杀掉
kill -9 <PID>

# 重新启动应用
```

---

### 步骤 3：从终端启动查看错误信息（关键！）

这是最有效的诊断方法，能看到详细的错误信息。

**Windows - PowerShell**:
```powershell
# 1. 按 Win + X，选择"Windows PowerShell"或"终端"

# 2. 进入应用安装目录（替换为实际路径）
cd "C:\Program Files\KOOK消息转发系统"
# 或
cd "$env:LOCALAPPDATA\Programs\KOOK消息转发系统"

# 3. 运行应用
.\KOOK.exe

# 或者直接运行（如果在桌面）
& "C:\Users\$env:USERNAME\Desktop\KOOK.Setup.1.13.1.exe"
```

**macOS - 终端**:
```bash
# 1. 打开"终端"（在"应用程序" → "实用工具"）

# 2. 运行应用（替换为实际路径）
/Applications/KOOK消息转发系统.app/Contents/MacOS/KOOK消息转发系统

# 3. 查看输出的错误信息
```

**Linux - 终端**:
```bash
# 1. 打开终端

# 2. 进入 AppImage 所在目录
cd ~/Downloads  # 或您保存的位置

# 3. 添加执行权限（如果还没有）
chmod +x KOOK.-1.13.1.AppImage

# 4. 运行应用
./KOOK.-1.13.1.AppImage

# 5. 查看输出的错误信息
```

**重要**：
- ✅ 复制所有输出的错误信息
- ✅ 特别注意红色的 ERROR 或 Exception
- ✅ 把这些信息发给我，我能准确诊断

---

### 步骤 4：检查端口占用

应用需要使用端口 **9527**（后端API），如果被占用会启动失败。

**Windows**:
```powershell
# 检查端口 9527 是否被占用
netstat -ano | findstr :9527

# 如果有输出，说明端口被占用
# 记下最后一列的 PID，然后在任务管理器中结束该进程
```

**macOS/Linux**:
```bash
# 检查端口 9527
lsof -i :9527

# 或
netstat -tunlp | grep 9527

# 如果被占用，杀掉进程
kill -9 <PID>
```

---

### 步骤 5：查看日志文件（关键诊断）

应用会生成日志文件，里面有详细的启动信息和错误。

**日志文件位置**:

**Windows**:
```
C:\Users\[您的用户名]\Documents\KookForwarder\data\logs\
```

**macOS**:
```
/Users/[您的用户名]/Documents/KookForwarder/data/logs/
```

**Linux**:
```
/home/[您的用户名]/Documents/KookForwarder/data/logs/
```

**查看最新日志**:
1. 进入上述目录
2. 找最新的日志文件（按时间排序）
3. 用文本编辑器打开
4. 找 ERROR、Exception、Failed 等关键词
5. **把错误信息发给我**

---

## 🔧 常见问题和解决方案

### 问题 1：缺少 Python 环境

**症状**: 
```
python: command not found
或
'python' 不是内部或外部命令
```

**原因**: 虽然应用打包了 Python，但某些系统可能需要额外配置。

**解决**:
- Windows: 重新下载安装包，确保完整下载（88.9 MB）
- macOS: 允许来自"身份不明开发者"的应用
- Linux: 确保 AppImage 有执行权限

---

### 问题 2：端口 9527 被占用

**症状**:
```
Address already in use
或
OSError: [Errno 98] Address already in use
```

**解决**:
```bash
# Windows PowerShell
netstat -ano | findstr :9527
# 找到 PID，在任务管理器中结束

# macOS/Linux
lsof -i :9527
kill -9 <PID>
```

---

### 问题 3：权限不足

**症状**:
```
Permission denied
或
Access is denied
```

**解决**:

**Windows**:
- 右键应用 → 以管理员身份运行
- 或安装到用户目录而非 Program Files

**macOS**:
```bash
# 允许应用运行
xattr -cr /Applications/KOOK消息转发系统.app
```

**Linux**:
```bash
# 添加执行权限
chmod +x KOOK.-1.13.1.AppImage
```

---

### 问题 4：Chromium 下载失败

**症状**:
```
Failed to download Chromium
或
Playwright installation failed
```

**原因**: 首次启动时需要下载 Chromium 浏览器（~170MB）

**解决**:
1. 确保网络连接正常
2. 等待 5-10 分钟（下载需要时间）
3. 如果网络慢，可能需要更长时间
4. 查看日志确认下载进度

**手动下载** (如果自动下载失败):
```bash
# 进入 Playwright 缓存目录
cd ~/.cache/ms-playwright  # Linux/macOS
cd %USERPROFILE%\.cache\ms-playwright  # Windows

# 检查 Chromium 是否存在
ls -la
```

---

### 问题 5：杀毒软件拦截

**症状**: 应用闪退，或完全没反应

**原因**: 杀毒软件可能误报应用为病毒

**解决**:
1. 检查杀毒软件隔离区
2. 将应用添加到白名单
3. 临时禁用杀毒软件测试（不推荐长期）

**常见误报的杀毒软件**:
- Windows Defender
- 360安全卫士
- 火绒安全
- Avast

---

### 问题 6：安装包损坏

**症状**: 安装过程报错，或安装后无法运行

**解决**:
1. 重新下载安装包
2. 验证文件大小：
   - Windows: 88.9 MB (93,212,293 字节)
   - macOS: 113.5 MB (118,967,593 字节)
   - Linux: 124.0 MB (129,992,033 字节)
3. 如果大小不对，说明下载不完整

**下载链接**:
https://github.com/gfchfjh/CSBJJWT/releases/latest

---

## 📋 收集诊断信息

如果以上方法都无法解决，请提供以下信息：

### ✅ 必需信息

1. **操作系统**

   - macOS: 版本号（例如 13.0 Ventura）、Intel/Apple Silicon
   - Linux: 发行版和版本（例如 Ubuntu 22.04）

2. **从终端启动的完整输出**
   - 复制所有文本（包括错误信息）
   
3. **日志文件**
   - 最新的日志文件内容
   - 特别是 ERROR 部分

4. **端口检查结果**
   - `netstat -ano | findstr :9527` (Windows)
   - `lsof -i :9527` (macOS/Linux)

5. **进程检查结果**
   - 任务管理器/活动监视器截图

---

## 🎯 快速修复检查清单

按顺序检查，找到问题就停止：

- [ ] 步骤 1: 检查系统托盘（双击图标）
- [ ] 步骤 2: 检查进程是否在运行（结束后重试）
- [ ] 步骤 3: 从终端启动（查看错误）
- [ ] 步骤 4: 检查端口占用（释放 9527）
- [ ] 步骤 5: 查看日志文件（找错误信息）
- [ ] 步骤 6: 重新下载安装包（验证大小）
- [ ] 步骤 7: 关闭杀毒软件（临时测试）
- [ ] 步骤 8: 以管理员运行（Windows）

---

## 💡 最可能的原因（统计）

根据常见情况，问题最可能是：

1. **50%**: 应用已启动，窗口在系统托盘（双击托盘图标）
2. **20%**: 端口 9527 被占用（释放端口后重试）
3. **15%**: 首次启动正在下载 Chromium（等待 5-10 分钟）
4. **10%**: 权限不足（以管理员运行）
5. **5%**: 其他原因（需要查看日志）

---

## 🚨 紧急联系

如果问题紧急且以上方法都无效：

1. 提供完整的诊断信息（见上方"收集诊断信息"）
2. 附上从终端启动的完整输出
3. 附上最新的日志文件

**临时替代方案**（手动启动后端+前端）:
```bash
# 仅作为紧急情况使用，不推荐
# 这需要您本地有 Python 和 Node.js 环境
```

---

**生成时间**: 2025-10-22  
**适用版本**: v1.13.1  
**优先级**: 🔴 高（启动失败）
