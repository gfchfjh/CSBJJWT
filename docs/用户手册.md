# KOOK消息转发系统 - 用户手册 v15.0.0

## 📚 目录

- [1. 系统简介](#1-系统简介)
- [2. 快速开始](#2-快速开始)
- [3. 功能详解](#3-功能详解)
- [4. 常见问题](#4-常见问题)
- [5. 故障排查](#5-故障排查)

---

## 1. 系统简介

### 1.1 什么是KOOK消息转发系统？

KOOK消息转发系统是一款**面向普通用户**的KOOK消息自动转发工具。无需任何编程知识，只需3步配置，即可将KOOK频道的消息自动转发到Discord、Telegram、飞书等平台。

### 1.2 主要功能

- ✅ **零代码配置** - 图形化界面，鼠标点击完成所有操作
- ✅ **3步配置向导** - 5分钟完成配置
- ✅ **Cookie一键导入** - Chrome扩展自动发送
- ✅ **自动获取服务器** - KOOK官方API，成功率99%+
- ✅ **可视化映射** - 拖拽连线创建映射
- ✅ **实时统计** - Dashboard展示转发数据
- ✅ **智能过滤** - 关键词、正则、用户黑白名单
- ✅ **自动更新** - 应用内检测和安装新版本

### 1.3 v15.0.0 新特性

#### 重大改进

- 配置时间大幅缩短
- Cookie导入成功率大幅提升
- 服务器获取成功率大幅提升

#### 核心优化

1. **3步配置向导** - 从6步精简到3步
2. **Chrome扩展一键导入** - 无需手动复制Cookie
3. **KOOK官方API** - 不再依赖页面DOM
4. **可视化映射编辑器** - 拖拽连线，直观易懂
5. **完整图文教程** - 新手5分钟上手

---

## 2. 快速开始

### 2.1 下载安装

#### 2.1.1 下载安装包

访问 [GitHub Releases](https://github.com/gfchfjh/CSBJJWT/releases) 下载对应平台的安装包：

- **Windows**: `KOOK消息转发系统-v15.0.0-Windows-x64.exe` (~150MB)
- **macOS**: `KOOK消息转发系统-v15.0.0-macOS.dmg` (~140MB)
- **Linux**: `KOOK消息转发系统-v15.0.0-Linux-x64.AppImage` (~160MB)

#### 2.1.2 安装应用

**Windows**:
1. 双击 `.exe` 文件
2. 选择安装路径（推荐默认）
3. 点击"安装"
4. 安装完成后自动启动

**macOS**:
1. 打开 `.dmg` 文件
2. 拖拽应用到"应用程序"文件夹
3. 首次打开：右键 → "打开"（绕过安全检查）

**Linux**:
1. 赋予执行权限：`chmod +x *.AppImage`
2. 双击运行或命令行：`./*.AppImage`

### 2.2 首次配置（3步向导）

应用首次启动会自动进入配置向导：

#### 步骤1：欢迎页

- 了解系统功能
- 查看预计耗时（3-5分钟）
- 点击"开始配置"

#### 步骤2：登录KOOK

**方法一：Cookie导入（推荐）**

1. 点击"下载Chrome扩展"
2. 安装扩展到Chrome浏览器
3. 在KOOK网页版登录
4. 点击扩展图标
5. Cookie自动导入！✅

**方法二：账号密码登录**

1. 输入KOOK邮箱
2. 输入密码
3. 点击"登录"
4. 如有验证码，按提示输入

#### 步骤3：选择频道

1. 系统自动获取您的所有服务器
2. 勾选要监听的频道
   - 支持全选/全不选
   - 支持搜索频道
3. 点击"完成配置"

#### 完成！

配置完成后，您可以：

- **选项1**: 开始监听（仅记录消息，不转发）
- **选项2**: 配置转发Bot（设置目标平台）
- **选项3**: 设置频道映射（指定转发规则）

### 2.3 配置转发Bot

#### 2.3.1 Discord Webhook

1. 进入"机器人配置" → "Discord"
2. 在Discord中创建Webhook：
   - 右键频道 → 编辑频道
   - 整合 → Webhook → 创建
   - 复制Webhook URL
3. 粘贴URL到软件
4. 点击"测试连接"
5. 测试成功后保存

**详细教程**: [Discord配置教程](tutorials/03-discord-webhook.md)

#### 2.3.2 Telegram Bot

1. 进入"机器人配置" → "Telegram"
2. 与 @BotFather 对话创建Bot
3. 获取Bot Token
4. 填写到软件
5. 添加Bot到群组
6. 获取Chat ID
7. 保存配置

**详细教程**: [Telegram配置教程](tutorials/04-Telegram配置教程.md)

#### 2.3.3 飞书Bot

1. 进入"机器人配置" → "飞书"
2. 在飞书开放平台创建自建应用
3. 获取App ID和App Secret
4. 填写到软件
5. 订阅应用到群组
6. 保存配置

**详细教程**: [飞书配置教程](tutorials/05-飞书配置教程.md)

### 2.4 创建频道映射

#### 2.4.1 使用可视化编辑器（推荐）

1. 进入"频道映射"页面
2. 左侧：点击KOOK频道
3. 右侧：点击目标Bot
4. 自动创建映射（显示连线）
5. 点击"保存映射"

#### 2.4.2 使用表格编辑器

1. 进入"频道映射" → 切换到"表格模式"
2. 点击"添加映射"
3. 选择源频道
4. 选择目标Bot
5. 保存

### 2.5 启动服务

1. 回到"概览"页面
2. 点击"启动服务"
3. 系统开始监听KOOK消息
4. 实时日志显示转发状态

---

## 3. 功能详解

### 3.1 主界面（概览）

#### 3.1.1 统计卡片

**今日转发**:
- 显示今日转发消息数量
- 趋势对比（同比昨日）

**成功率**:
- 转发成功率百分比
- 进度条颜色渐变
  - 绿色（≥95%）：优秀
  - 黄色（80%-95%）：良好
  - 红色（<80%）：需优化

**平均延迟**:
- 消息转发的平均延迟时间
- 延迟等级
  - 极快（<1秒）
  - 快速（1-2秒）
  - 正常（2-5秒）
  - 较慢（>5秒）

**失败消息**:
- 转发失败的消息数量
- 点击查看详情

#### 3.1.2 实时图表

**转发量折线图**:
- 显示转发量趋势
- 支持切换时间范围
  - 最近1小时
  - 最近6小时
  - 最近24小时
  - 最近7天

**平台分布饼图**:
- 显示各平台转发占比
- 颜色区分
  - Discord（蓝色）
  - Telegram（绿色）
  - 飞书（橙色）

#### 3.1.3 快捷操作

- **启动/停止服务**: 一键控制
- **重启服务**: 重新加载配置
- **查看实时日志**: 跳转到日志页面
- **清空队列**: 清空待处理消息

### 3.2 账号管理

#### 3.2.1 查看账号列表

- 显示所有已添加的KOOK账号
- 账号状态：在线/离线
- 监听频道数量

#### 3.2.2 添加账号

1. 点击"添加账号"
2. 选择导入方式
   - Cookie导入（推荐）
   - 账号密码登录
3. 完成认证
4. 选择要监听的频道

#### 3.2.3 编辑账号

- 修改账号备注
- 更新Cookie
- 修改监听频道
- 启用/禁用账号

#### 3.2.4 删除账号

- 选择账号 → "删除"
- 确认删除
- 账号及相关配置会被清除

### 3.3 机器人配置

#### 3.3.1 Discord配置

**Webhook配置**:
- Webhook名称（备注）
- Webhook URL
- 测试连接

**高级选项**:
- 伪装原始发送者
- 使用Embed卡片
- 自定义用户名
- 自定义头像URL

#### 3.3.2 Telegram配置

**Bot配置**:
- Bot Token
- Chat ID（群组或频道）
- 测试连接

**高级选项**:
- 消息格式（Markdown/HTML）
- 禁用网页预览
- 禁用通知

#### 3.3.3 飞书配置

**应用配置**:
- App ID
- App Secret
- Chat ID
- 测试连接

**高级选项**:
- 消息格式
- @提及转换

### 3.4 频道映射

#### 3.4.1 可视化编辑器

**功能**:
- 左侧：KOOK频道列表（树形结构）
- 右侧：目标Bot列表
- 中间：SVG连线层

**操作**:
- 点击创建：左侧点击频道 → 右侧点击Bot
- 删除映射：点击连线上的删除按钮
- 启用/禁用：切换映射状态

**筛选**:
- 搜索KOOK频道
- 搜索目标Bot
- 按平台筛选

#### 3.4.2 表格编辑器

**功能**:
- 表格式展示所有映射
- 支持批量操作

**操作**:
- 添加映射
- 编辑映射
- 删除映射
- 启用/禁用
- 批量删除

### 3.5 过滤规则

#### 3.5.1 关键词过滤

**黑名单**:
- 包含黑名单关键词的消息不转发
- 支持批量输入（逗号分隔）
- 示例：`广告, 代练, 外挂`

**白名单**:
- 仅转发包含白名单关键词的消息
- 支持批量输入
- 示例：`官方公告, 版本更新, 重要通知`

#### 3.5.2 正则表达式

**添加规则**:
- 正则表达式模式
- 规则描述
- 类型（黑名单/白名单）

**示例**:
```regex
^\\[广告\\].*        # 匹配以[广告]开头的消息
@everyone          # 匹配包含@everyone的消息
http[s]?://.*      # 匹配包含链接的消息
```

#### 3.5.3 用户过滤

**黑名单用户**:
- 添加用户名或ID
- 该用户的消息不转发

**白名单用户**:
- 添加用户名或ID
- 仅转发这些用户的消息

#### 3.5.4 消息类型

选择要转发的消息类型：
- ✅ 文本消息
- ✅ 图片消息
- ✅ 链接消息
- ✅ 表情反应
- ✅ 文件附件
- ✅ @提及

#### 3.5.5 特殊规则

- **仅转发@全体成员的消息**
- **忽略Bot发送的消息**

#### 3.5.6 测试过滤

**功能**:
- 输入测试消息
- 选择发送者
- 选择消息类型
- 点击"运行测试"
- 查看是否会被拦截

**结果**:
- ✅ 会被转发
- ❌ 会被拦截
  - 拦截原因
  - 匹配规则
  - 优化建议

### 3.6 实时日志

#### 3.6.1 日志列表

**显示内容**:
- 时间戳
- 来源（KOOK频道）
- 目标（平台+Bot）
- 消息内容（截断）
- 状态（成功/失败）
- 延迟时间

**筛选**:
- 按状态（全部/成功/失败）
- 按平台（Discord/Telegram/飞书）
- 按时间范围
- 关键词搜索

#### 3.6.2 日志详情

点击日志条目查看详情：
- 完整消息内容
- 源频道信息
- 目标Bot信息
- 转发状态
- 错误信息（如果失败）
- 重试次数

#### 3.6.3 日志导出

- 导出为CSV
- 导出为JSON
- 选择时间范围
- 选择筛选条件

### 3.7 系统设置

#### 3.7.1 基础设置

**应用设置**:
- 开机自启动
- 最小化到系统托盘
- 关闭时最小化（不退出）

**语言设置**:
- 简体中文
- English（规划中）

**主题设置**:
- 浅色主题
- 深色主题
- 跟随系统

#### 3.7.2 消息设置

**转发设置**:
- 最大重试次数
- 重试间隔时间
- 超时时间
- 批量转发间隔

**队列设置**:
- 队列最大长度
- 队列清理策略
- 优先级设置

#### 3.7.3 日志设置

**日志级别**:
- DEBUG（详细）
- INFO（一般）
- WARNING（警告）
- ERROR（错误）

**日志保留**:
- 保留天数
- 最大文件大小
- 自动清理

#### 3.7.4 安全设置

**主密码**:
- 设置主密码
- 启动时要求输入
- 修改主密码

**数据加密**:
- Cookie加密存储
- API Token加密
- 导出时加密

#### 3.7.5 高级设置

**性能优化**:
- 并发线程数
- 内存限制
- CPU限制

**网络设置**:
- 代理设置
- 超时设置
- 重试策略

### 3.8 帮助中心

#### 3.8.1 内置教程

- 快速入门指南
- Cookie获取教程
- Discord配置教程
- Telegram配置教程
- 飞书配置教程
- 频道映射详解
- 过滤规则技巧

#### 3.8.2 常见问题

- 配置相关问题
- 转发失败问题
- 性能优化问题
- 安全相关问题

#### 3.8.3 视频教程

- 完整配置演示
- Chrome扩展使用
- 可视化映射编辑
- 过滤规则设置

#### 3.8.4 在线支持

- 查看在线文档
- 提交问题反馈
- 加入社区讨论

---

## 4. 常见问题

### 4.1 安装问题

**Q: Windows提示"无法验证发布者"？**

A: 这是正常的安全警告。点击"更多信息" → "仍要运行"。

**Q: macOS提示"无法打开，因为来自身份不明的开发者"？**

A: 右键点击应用 → 选择"打开" → 点击"打开"确认。

**Q: Linux无法运行AppImage？**

A: 确保已赋予执行权限：`chmod +x *.AppImage`

### 4.2 配置问题

**Q: Cookie导入失败？**

A: 
1. 确保Chrome扩展已安装
2. 确保软件正在运行
3. 尝试手动粘贴Cookie
4. 查看[Cookie获取教程](tutorials/02-cookie-guide.md)

**Q: 无法获取服务器列表？**

A:
1. 检查Cookie是否有效
2. 尝试重新登录
3. 查看错误日志
4. 确保网络连接正常

**Q: Webhook测试连接失败？**

A:
1. 检查Webhook URL是否正确
2. 确保Webhook未被删除
3. 检查网络连接
4. 查看详细错误信息

### 4.3 转发问题

**Q: 消息没有转发？**

A:
1. 检查服务是否启动
2. 检查频道映射是否配置
3. 检查过滤规则是否过严
4. 查看实时日志

**Q: 转发延迟很高？**

A:
1. 检查网络连接
2. 减少并发转发数量
3. 检查目标平台限流
4. 优化过滤规则

**Q: 图片无法转发？**

A:
1. 检查图片大小（默认限制10MB）
2. 检查图床服务是否正常
3. 查看错误日志
4. 尝试重启服务

### 4.4 性能问题

**Q: CPU占用过高？**

A:
1. 减少监听频道数量
2. 降低并发线程数
3. 增加转发间隔
4. 检查是否有死循环

**Q: 内存占用过高？**

A:
1. 清空消息队列
2. 减少日志保留天数
3. 清理图片缓存
4. 重启服务

**Q: 磁盘占用过大？**

A:
1. 清理旧日志文件
2. 清理图片缓存
3. 导出并删除历史数据
4. 设置自动清理策略

### 4.5 安全问题

**Q: Cookie会被上传吗？**

A: 不会！Cookie完全存储在本地，经过加密，不会上传到任何服务器。

**Q: 如何保护我的数据？**

A:
1. 设置主密码
2. 定期更换Cookie
3. 不要分享配置文件
4. 使用独立的KOOK账号

**Q: 如何备份配置？**

A:
1. 进入"系统设置" → "备份恢复"
2. 点击"导出配置"
3. 选择保存位置
4. 定期备份

---

## 5. 故障排查

### 5.1 诊断工具

#### 5.1.1 系统健康检查

进入"概览" → "系统诊断"：
- 检查服务状态
- 检查数据库连接
- 检查Redis连接
- 检查网络连接

#### 5.1.2 日志分析

查看日志文件：
- 位置：`~/Documents/KookForwarder/data/logs/`
- 最新日志：`app.log`
- 历史日志：`app.log.1`, `app.log.2`, ...

#### 5.1.3 连接测试

测试各项连接：
- KOOK API连接
- Discord Webhook连接
- Telegram Bot连接
- 飞书应用连接

### 5.2 常见错误

#### 5.2.1 "Cookie无效或已过期"

**原因**: Cookie已失效

**解决**:
1. 重新登录KOOK网页版
2. 重新导出Cookie
3. 更新到软件

#### 5.2.2 "无法连接到KOOK服务器"

**原因**: 网络问题或KOOK服务异常

**解决**:
1. 检查网络连接
2. 尝试访问KOOK网站
3. 检查防火墙设置
4. 稍后重试

#### 5.2.3 "转发失败：限流"

**原因**: 触发平台限流机制

**解决**:
1. 降低转发频率
2. 增加转发间隔
3. 分散到多个Bot
4. 等待限流解除

#### 5.2.4 "数据库错误"

**原因**: 数据库文件损坏

**解决**:
1. 备份数据目录
2. 删除数据库文件
3. 重启应用（自动重建）
4. 重新配置

### 5.3 获取支持

#### 5.3.1 查看文档

- [快速入门](tutorials/01-quick-start.md)
- [完整教程](tutorials/)
- [API文档](API接口文档.md)
- [架构设计](架构设计.md)

#### 5.3.2 社区支持

- GitHub Issues
- Discord社区
- QQ群
- Telegram群组

#### 5.3.3 专业支持

- 邮箱：support@kookforwarder.com
- 提供详细错误日志
- 描述问题复现步骤
- 附上系统信息

---

## 附录

### A. 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+R` | 刷新当前页面 |
| `Ctrl+L` | 跳转到日志页面 |
| `Ctrl+S` | 保存当前配置 |
| `Ctrl+,` | 打开设置 |
| `Ctrl+H` | 打开帮助中心 |
| `F5` | 刷新数据 |
| `Esc` | 关闭弹窗 |

### B. 系统要求

| 项目 | 最低要求 | 推荐配置 |
|------|---------|---------|
| 操作系统 | Windows 10 / macOS 10.15 / Ubuntu 20.04 | 最新版本 |
| CPU | 双核 2GHz | 四核 2.5GHz+ |
| 内存 | 4GB | 8GB+ |
| 磁盘 | 500MB可用空间 | 2GB+ |
| 网络 | 稳定的互联网连接 | 宽带连接 |

### C. 数据目录

| 目录 | 路径 | 用途 |
|------|------|------|
| 配置 | `~/Documents/KookForwarder/data/config/` | 数据库和配置文件 |
| 日志 | `~/Documents/KookForwarder/data/logs/` | 应用日志 |
| 图片 | `~/Documents/KookForwarder/data/images/` | 图片缓存 |
| Redis | `~/Documents/KookForwarder/data/redis/` | Redis数据 |

### D. 更新历史

- **v15.0.0** (2025-10-29) - Ultimate Edition大版本更新
- **v7.0.0** (2025-06-15) - 基础功能版本
- 更多历史版本见 [CHANGELOG.md](../CHANGELOG.md)

---

<div align="center">

**KOOK消息转发系统 v15.0.0**

零代码基础 · 一键安装 · 3分钟上手

[返回首页](../README.md) · [查看教程](tutorials/) · [问题反馈](https://github.com/gfchfjh/CSBJJWT/issues)

</div>
