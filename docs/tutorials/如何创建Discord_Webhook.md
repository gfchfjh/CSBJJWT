# 如何创建Discord Webhook

本教程将详细介绍如何在Discord服务器中创建Webhook，用于接收KOOK消息转发。

---

## 📋 目录

1. [什么是Discord Webhook](#什么是discord-webhook)
2. [前置准备](#前置准备)
3. [创建Webhook详细步骤](#创建webhook详细步骤)
4. [测试Webhook](#测试webhook)
5. [常见问题](#常见问题)

---

## 什么是Discord Webhook

**Webhook** 是Discord提供的一种简单的HTTP回调机制，允许外部应用程序向Discord频道发送消息，无需创建完整的Bot。

### 特点
- ✅ **无需编程**：只需一个URL即可发送消息
- ✅ **即时生效**：创建后立即可用
- ✅ **权限简单**：只需"管理Webhook"权限
- ✅ **自定义头像和昵称**：可以伪装成不同的用户

### 限制
- ⚠️ **仅能发送消息**：不能读取消息或监听事件
- ⚠️ **频率限制**：每5秒最多5条消息
- ⚠️ **需要服务器管理权限**：创建Webhook需要"管理Webhook"权限

---

## 前置准备

### 1. Discord账号
- 已注册Discord账号
- 已登录Discord客户端或网页版

### 2. 服务器权限
您必须在目标服务器中拥有以下权限之一：
- ✅ **服务器所有者**（自动拥有所有权限）
- ✅ **管理员**权限
- ✅ **管理Webhook**权限

> **如何检查权限**：
> 1. 右键点击服务器图标
> 2. 选择"服务器设置"
> 3. 查看左侧"角色"菜单
> 4. 检查您的角色是否有"管理Webhook"权限

> **截图说明**：
> - [ ] 截图：服务器设置入口
> - [ ] 截图：角色权限列表
> - [ ] 截图："管理Webhook"权限勾选框（用红框标注）

---

## 创建Webhook详细步骤

### 步骤1：打开服务器设置

1. 打开Discord应用（桌面端或网页版）
2. 在左侧服务器列表中，找到您要设置的服务器
3. **右键点击服务器图标**，选择 **"服务器设置"**

> **或者**：点击服务器名称旁的下拉箭头 → "服务器设置"

> **截图说明**：
> - [ ] 截图：右键菜单，标注"服务器设置"选项
> - [ ] 截图：服务器设置页面

---

### 步骤2：进入集成页面

1. 在服务器设置左侧菜单中，找到 **"集成"**（Integrations）
2. 点击"集成"

> **位置**：通常在"角色"和"表情符号"之间

> **截图说明**：
> - [ ] 截图：左侧菜单，标注"集成"选项
> - [ ] 截图：集成页面

---

### 步骤3：创建新的Webhook

1. 在集成页面，点击 **"Webhooks"** 标签
2. 点击右上角的 **"新建Webhook"**（New Webhook）按钮
3. Discord会自动创建一个默认的Webhook

> **首次创建**：如果这是第一次创建，页面会显示"创建第一个Webhook"的引导

> **截图说明**：
> - [ ] 截图：Webhooks标签
> - [ ] 截图："新建Webhook"按钮（用红框标注）
> - [ ] 截图：Webhook创建成功

---

### 步骤4：配置Webhook

Webhook创建后，您会看到配置页面：

#### 1. 修改名称（可选）
- 默认名称：`Spidey Bot`（或其他随机名称）
- 建议修改为：`KOOK转发Bot`、`游戏公告Bot` 等
- 这个名称会显示在消息的发送者位置

#### 2. 选择频道（重要）
- 点击"频道"下拉菜单
- 选择您希望接收消息的目标频道
- 例如：`#公告`、`#通知`、`#转发消息` 等

> **重要**：Webhook只能向选定的频道发送消息

#### 3. 上传头像（可选）
- 点击左侧的头像框
- 上传自定义头像（PNG、JPG、GIF格式）
- 建议使用KOOK或游戏相关的图标

#### 4. 复制Webhook URL（关键）
- 在配置页面底部，找到 **"WEBHOOK URL"**
- 点击 **"复制Webhook URL"** 按钮
- URL格式类似：
  ```
  https://discord.com/api/webhooks/1234567890123456789/ABCdefGHIjklMNOpqrsTUVwxyzABCdefGHIjklMNOpqrsTUVwxyzABC
  ```

> **安全提示**：
> - ⚠️ Webhook URL包含密钥，请勿泄露
> - ⚠️ 任何拥有此URL的人都能向该频道发送消息
> - ✅ 如果不慎泄露，可以删除后重新创建

> **截图说明**：
> - [ ] 截图：Webhook配置页面（标注各个字段）
> - [ ] 截图：名称输入框
> - [ ] 截图：频道选择下拉菜单
> - [ ] 截图：Webhook URL（部分打码）
> - [ ] 截图："复制Webhook URL"按钮（用红框标注）

---

### 步骤5：保存设置

1. 确认所有配置正确
2. 点击页面底部的 **"保存更改"**（Save Changes）按钮
3. Discord会提示"更改已保存"

> **截图说明**：
> - [ ] 截图："保存更改"按钮
> - [ ] 截图：保存成功提示

---

## 测试Webhook

### 在转发系统中测试

1. 打开KOOK消息转发系统
2. 进入 **"机器人配置"** 页面
3. 选择 **"Discord"** 平台
4. 填写Webhook信息：
   - **Webhook名称**：`游戏公告Bot`（备注用）
   - **Webhook URL**：粘贴刚才复制的URL
5. 点击 **"🧪 测试连接"** 按钮

**预期结果**：
- ✅ 系统显示：`测试成功！已发送测试消息到目标平台`
- ✅ Discord频道中收到一条测试消息

> **测试消息示例**：
> ```
> 🧪 测试消息
> 这是一条测试消息，来自KOOK消息转发系统。
> 如果您看到这条消息，说明Webhook配置成功！
> 
> 时间：2025-10-31 12:34:56
> ```

> **截图说明**：
> - [ ] 截图：转发系统的测试按钮
> - [ ] 截图：测试成功提示
> - [ ] 截图：Discord频道中收到的测试消息

---

### 手动测试（高级）

如果想直接测试Webhook，可以使用以下方法：

#### 方法1：使用curl命令

```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{
    "content": "这是一条测试消息！",
    "username": "测试Bot",
    "avatar_url": "https://example.com/avatar.png"
  }' \
  https://discord.com/api/webhooks/YOUR_WEBHOOK_URL
```

#### 方法2：使用在线工具

1. 访问 [Discord Webhook Tester](https://discohook.org/)
2. 粘贴Webhook URL
3. 输入测试消息
4. 点击"发送"

> **截图说明**：
> - [ ] 截图：Discohook网站界面
> - [ ] 截图：发送测试消息

---

## 常见问题

### ❓ 1. 找不到"服务器设置"选项

**可能原因**：
- 您不是服务器所有者
- 您的角色没有相关权限

**解决方法**：
1. 联系服务器所有者
2. 请求"管理Webhook"权限
3. 或请服务器所有者帮您创建

---

### ❓ 2. 创建Webhook时提示"权限不足"

**原因**：您的角色缺少"管理Webhook"权限

**解决方法**：
1. 联系服务器管理员
2. 申请"管理Webhook"权限
3. 或使用其他拥有权限的账号

---

### ❓ 3. Webhook URL泄露了怎么办？

**解决方法**：
1. 立即删除该Webhook
2. 重新创建新的Webhook
3. 更新转发系统中的URL配置

**删除步骤**：
1. 进入"服务器设置" → "集成" → "Webhooks"
2. 找到泄露的Webhook
3. 点击"删除Webhook"

> **截图说明**：
> - [ ] 截图：删除Webhook按钮

---

### ❓ 4. 测试时提示"404 Not Found"

**可能原因**：
1. Webhook已被删除
2. Webhook URL复制不完整
3. Webhook URL格式错误

**解决方法**：
- 确保复制了完整的URL（包括最后的随机字符串）
- 重新创建Webhook并获取新的URL
- 检查URL中没有多余的空格或换行符

---

### ❓ 5. 消息发送频率限制

**Discord限制**：
- 每个Webhook：**每5秒最多5条消息**
- 超限会返回 `429 Too Many Requests`

**转发系统的处理**：
- ✅ 自动限流：系统会自动控制发送速度
- ✅ 排队机制：超限消息会进入队列等待
- ✅ 不会丢失：所有消息都会最终发送

---

### ❓ 6. 能否多个频道使用同一个Webhook？

**答案**：
- ❌ **不能**！一个Webhook只能对应一个频道
- 如果需要向多个频道转发，需要创建多个Webhook

**操作方法**：
1. 为每个目标频道创建独立的Webhook
2. 在转发系统中分别添加
3. 在"频道映射"中指定不同的Webhook

---

### ❓ 7. Webhook消息能否被编辑或删除？

**答案**：
- ✅ **可以编辑和删除**，但需要保存Webhook返回的消息ID
- 转发系统默认不保存消息ID（为了简化）
- 如需此功能，可以开启"消息管理"选项（高级功能）

---

### ❓ 8. Webhook消息能否@某人？

**答案**：
- ✅ **可以**！使用 `<@USER_ID>` 格式

**示例**：
```
<@123456789012345678> 您有新消息！
```

**如何获取User ID**：
1. 在Discord中启用"开发者模式"（设置 → 高级 → 开发者模式）
2. 右键点击用户头像
3. 选择"复制ID"

> **转发系统支持**：
> - 自动将KOOK的@提及转换为Discord格式
> - 需要在"映射配置"中设置用户ID对应关系

---

### ❓ 9. 能否发送Embed（嵌入消息）？

**答案**：
- ✅ **可以**！Webhook支持发送富文本格式的Embed

**Embed示例**：
```json
{
  "embeds": [{
    "title": "公告标题",
    "description": "公告内容",
    "color": 5814783,
    "thumbnail": {
      "url": "https://example.com/image.png"
    }
  }]
}
```

> **转发系统支持**：
> - 自动将KOOK的卡片消息转换为Discord Embed
> - 无需手动配置

---

### ❓ 10. 如何批量创建多个Webhook？

**推荐方法**：
1. 使用Discord API（需要编程知识）
2. 或手动创建（每个约30秒）

**时间估算**：
- 创建10个Webhook：约5分钟
- 创建50个Webhook：约25分钟

**批量管理**：
- 建议在转发系统中使用"导出/导入配置"功能
- 可以一次性保存所有Webhook URL
- 换设备时快速恢复

---

## 🎉 总结

### 创建流程总结

| 步骤 | 操作 | 时间 |
|------|------|------|
| 1 | 打开服务器设置 | 10秒 |
| 2 | 进入集成 → Webhooks | 5秒 |
| 3 | 新建Webhook | 5秒 |
| 4 | 配置名称、频道 | 20秒 |
| 5 | 复制URL | 5秒 |
| 6 | 保存设置 | 5秒 |
| **总计** | **约1分钟** | |

### 关键要点
1. ✅ 需要"管理Webhook"权限
2. ✅ 一个Webhook对应一个频道
3. ✅ Webhook URL是敏感信息
4. ✅ 测试连接确保配置正确
5. ⚠️ 注意频率限制（每5秒5条）

### 下一步
- ✅ 在转发系统中添加Webhook
- ✅ 配置频道映射
- ✅ 启动转发服务

---

## 📞 需要帮助？

如果按照教程操作仍有问题：
1. 查看系统的 **FAQ** 页面
2. 查看 **视频教程**（更直观）
3. 检查Discord服务器日志

---

## 🔗 相关教程

- [Telegram Bot创建教程](./如何创建Telegram_Bot.md)
- [飞书自建应用教程](./如何配置飞书自建应用.md)
- [频道映射配置教程](./频道映射配置详解.md)

---

**最后更新时间**：2025-10-31  
**适用版本**：v18.0.0+  
**Discord API版本**：v10
