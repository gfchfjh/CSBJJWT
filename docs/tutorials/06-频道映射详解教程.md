# 06. 频道映射详解教程

**版本**: v12.1.0 深度优化版  
**预计阅读时间**: 8-10分钟  
**适合人群**: 所有用户  
**最后更新**: 2025-10-28

---

## 📋 目录

1. [什么是频道映射](#什么是频道映射)
2. [配置方式](#配置方式)
3. [智能映射功能](#智能映射功能)
4. [可视化编辑器](#可视化编辑器)
5. [一对多映射](#一对多映射)
6. [常见问题](#常见问题)

---

## 什么是频道映射

频道映射就是**告诉系统：KOOK的哪个频道 到 转发到 到 哪个Discord/Telegram/飞书**。

### 示例

```
KOOK频道            到  目标平台
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📢 #公告频道         到  Discord #announcements
                    到  Telegram 公告群
                    到  飞书 运营群

🎉 #活动频道         到  Discord #events
                    到  Telegram 活动群
```

> 💡 **重点**: 一个KOOK频道可以同时转发到多个目标！

---

## 配置方式

### 方式1: AI智能映射（强烈推荐）

**适合**: 频道名称有规律（如：公告、活动、技术等）

**v12.1.0增强**:
- ✅ **智能匹配算法**: 完全匹配 + 相似度 + 关键词 + 历史学习
- ✅ **时间衰减**: 持续优化推荐
- ✅ **关键词库**: 中英文智能映射
- ✅ **高准确度**: 智能推荐系统
- ✅ **学习能力**: 记录用户选择，持续改进

**步骤**:

1. 进入"配置向导"或"频道映射"页面

2. 点击"AI智能映射"按钮

3. 系统自动分析，显示推荐结果

```
📊 AI推荐结果:

KOOK: 游戏讨论
  ├─ 🎯 gaming ← 推荐
  ├─ game-chat
  └─ general
```

4. 确认并应用（系统自动学习您的选择）

> 💡 **提示**: v12.1.0的AI引擎会根据您的使用习惯持续学习优化！

---

### 方式2: 可视化编辑器（直观）

**适合**: 喜欢拖拽操作的用户

**步骤**:

1. 点击"可视化编辑器"标签

![可视化编辑器](./images/visual-editor.png)

2. 从左侧拖动KOOK频道到右侧Bot卡片

![拖拽操作](./images/drag-and-drop.gif)

3. 系统自动绘制SVG连接线

![连接线](./images/connection-lines.png)

4. 底部实时预览所有映射

![映射预览](./images/mapping-preview.png)

---

### 方式3: 手动配置（精确）

**适合**: 需要精确控制的用户

**步骤**:

1. 点击"添加映射"按钮

2. 手动选择：
   - KOOK服务器
   - KOOK频道
   - 目标平台（Discord/Telegram/飞书）
   - 目标Bot
   - 目标频道/群组

3. 保存

> ⚠️ **注意**: 手动配置需要准确填写所有信息

---

## 智能映射功能

### 60+中英文映射规则

系统内置60+频道名称翻译规则：

| 中文 | 英文匹配 |
|------|---------|
| 公告 | announcements, announcement, news, notice |
| 活动 | events, event, activities, activity |
| 更新 | updates, update, changelog, changes |
| 技术 | tech, technical, technology, development |
| 帮助 | help, support, assistance |
| ... | ... |

完整规则列表见：`后端代码/utils/smart_mapping_rules_enhanced.py`

### 匹配算法

1. **完全匹配**（置信度100%）
   - `公告` = `公告` ✅
   - `announcements` = `announcements` ✅

2. **翻译匹配**（置信度90%）
   - `公告` 到 `announcements` ✅
   - `活动` 到 `events` ✅

3. **包含匹配**（置信度70%）
   - `官方公告` 包含 `announcements` ✅

4. **模糊匹配**（置信度50-70%）
   - 使用Levenshtein距离算法
   - `公告频道` vs `announcement-channel` 到 中等匹配度

### 置信度等级

- 🟢 **高置信度（≥80%）**: 推荐直接使用
- 🟡 **中等置信度（50-80%）**: 可能正确，建议确认
- 🔴 **低置信度（<50%）**: 需要人工确认

---

## 可视化编辑器

### 左右分栏布局

```
┌────────────────┬─────────────┬────────────────┐
│  KOOK频道      │  SVG连接线  │  目标Bot       │
│  （源）        │             │  （接收）      │
│                │             │                │
│  📢 公告频道   ├─────────────到  Discord Bot  │
│  🎉 活动频道   ├─────────────到  Telegram Bot │
│  💬 技术讨论   │             │  飞书 Bot      │
└────────────────┴─────────────┴────────────────┘
```

### SVG贝塞尔曲线

系统使用SVG绘制美观的连接线：

- 🎨 **渐变色**: 从蓝色到绿色的平滑渐变
- ➡️ **箭头标记**: 清晰显示转发方向
- ✨ **悬停效果**: 鼠标悬停时高亮并显示详情
- 🗑️ **点击删除**: 点击连接线可删除映射

---

## 一对多映射

### 什么是一对多？

一个KOOK频道可以同时转发到多个目标平台。

### 示例场景

**场景**: 游戏公告需要同时发送到所有平台

```
KOOK #公告频道
    ├─到 Discord #announcements （游戏公告Bot）
    ├─到 Telegram 公告群 （游戏公告TG Bot）
    └─到 飞书 运营群 （游戏公告飞书Bot）
```

### 配置方法

**方式1: 可视化编辑器**
- 拖动同一个KOOK频道到多个Bot卡片
- 系统自动绘制多条连接线

**方式2: 智能映射**
- 系统自动推荐所有可能的映射
- 手动选择需要的

**方式3: 手动配置**
- 多次添加映射，使用相同的KOOK频道

---

## 常见问题

### Q: 智能映射找不到匹配？

**A**: 可能原因：
1. 频道名称差异太大
2. 目标平台没有配置Bot
3. 置信度阈值设置太高

**解决方案**:
- 降低置信度阈值（设置页 到 最低50%）
- 使用手动配置
- 修改频道名称使其更相似

---

### Q: 一对多映射会重复发送吗？

**A**: 不会！系统会：
1. 并行发送到所有目标
2. 每个目标独立处理
3. 某个目标失败不影响其他目标

---

### Q: 如何临时禁用某个映射？

**A**: 
1. 在映射列表找到要禁用的映射
2. 点击"禁用"按钮（保留配置，不删除）
3. 需要时可以重新启用

---

### Q: 映射太多了，如何管理？

**A**: 建议：
1. 使用导出功能备份映射
2. 按平台分组查看
3. 使用搜索功能快速定位
4. 定期清理不需要的映射

---

## 📺 视频教程

🎬 [观看视频: 频道映射完整配置（6分钟）](/help/videos?id=mapping)

---

## 🔗 相关教程

- [智能映射算法原理](./07-智能映射算法详解.md)
- [过滤规则配置](./08-过滤规则使用技巧.md)
- [常见问题排查](./FAQ-常见问题.md)

---

## 💬 需要帮助？

- 💬 [GitHub Discussions](https://github.com/gfchfjh/CSBJJWT/discussions)
- 🐛 [报告问题](https://github.com/gfchfjh/CSBJJWT/issues)
- 📧 [联系我们](mailto:support@example.com)

---

**教程完成日期**: 2025-10-27  
**贡献者**: KOOK Forwarder Team  
**版本**: v1.0
