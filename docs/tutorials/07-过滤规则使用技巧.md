# 07. 过滤规则使用技巧

**预计阅读时间**: 8分钟  
**难度等级**: ⭐⭐ 简单  
**适合人群**: 需要精准控制转发内容的用户  
**最后更新**: 2025-10-27

---

## 📋 目录

1. [什么是过滤规则](#什么是过滤规则)
2. [关键词过滤](#关键词过滤)
3. [用户过滤](#用户过滤)
4. [消息类型过滤](#消息类型过滤)
5. [组合规则](#组合规则)
6. [实战案例](#实战案例)
7. [常见问题](#常见问题)

---

## 什么是过滤规则

过滤规则用于**精准控制哪些消息需要转发，哪些不需要**。

### 为什么需要过滤？

- ✅ 避免转发广告、刷屏等垃圾消息
- ✅ 只转发重要的官方公告
- ✅ 过滤特定用户的消息
- ✅ 控制转发的消息类型

### 过滤模式

- **黑名单模式**: 排除包含指定关键词的消息（默认全转发）
- **白名单模式**: 仅转发包含指定关键词的消息（默认不转发）

> ⚠️ **注意**: 黑名单和白名单不能同时启用！

---

## 关键词过滤

### 黑名单（排除模式）

**使用场景**: 过滤广告、刷屏等垃圾消息

**示例**:

```
黑名单关键词:
广告, 代练, 外挂, 刷金, 刷级, 点卡, 充值, 低价, 包过, 代刷
```

**效果**:
- ❌ "专业代练，价格优惠" → 不转发（包含"代练"）
- ❌ "出售外挂，私聊" → 不转发（包含"外挂"）
- ✅ "官方公告：版本更新" → 正常转发

### 白名单（仅转发模式）

**使用场景**: 只转发官方公告、重要通知

**示例**:

```
白名单关键词:
官方公告, 版本更新, 维护通知, 重要通知, 活动, 补偿
```

**效果**:
- ✅ "【官方公告】服务器维护" → 转发（包含"官方公告"）
- ✅ "版本更新2.0即将上线" → 转发（包含"版本更新"）
- ❌ "大家好，我是新人" → 不转发（不包含白名单关键词）

### 配置步骤

1. 进入"过滤规则"页面

![过滤规则页面](./images/filter-rules-page.png)

2. 选择"关键词过滤"

![关键词过滤](./images/keyword-filter.png)

3. 选择黑名单或白名单模式

4. 输入关键词（用逗号分隔）

```
示例输入:
官方公告, 版本更新, 重要通知, 活动, 补偿
```

5. 启用关键词过滤

![启用过滤](./images/enable-filter.png)

6. 保存配置

---

## 用户过滤

### 黑名单用户（不转发）

**使用场景**: 屏蔽广告机器人、刷屏用户

**步骤**:

1. 点击"添加用户"

![添加黑名单用户](./images/add-blacklist-user.png)

2. 输入用户名或ID

```
示例:
• 广告机器人A
• 刷屏用户123
• spam_bot
```

3. 保存

**效果**: 这些用户的所有消息都不会被转发

### 白名单用户（仅转发）

**使用场景**: 只转发官方管理员、运营团队的消息

**步骤**:

1. 点击"添加用户"到白名单

![添加白名单用户](./images/add-whitelist-user.png)

2. 输入用户名

```
示例:
• 官方管理员
• 运营团队
• 客服小助手
```

3. 保存

**效果**: 只有这些用户的消息会被转发

> 💡 **提示**: 可以在KOOK中查看用户ID（右键用户 → 复制ID）

---

## 消息类型过滤

### 支持的类型

- ✅ 文本消息
- ✅ 图片消息
- ✅ 链接消息
- ✅ 表情反应
- ✅ 文件附件
- ✅ @提及消息

### 配置示例

**场景1**: 只转发文本，不转发图片

```
☑️ 文本消息
☐ 图片消息     ← 取消勾选
☑️ 链接消息
```

**场景2**: 只转发@全体成员的消息

```
☑️ @提及（仅全体成员）
☐ 其他类型全部取消
```

![消息类型过滤](./images/message-type-filter.png)

---

## 组合规则

### 规则优先级

```
用户过滤 > 关键词过滤 > 消息类型过滤
```

### 示例1: 精准转发官方公告

```
配置:
1. 用户白名单: 官方管理员, 运营团队
2. 关键词白名单: 公告, 更新, 通知
3. 消息类型: 仅文本和图片

结果:
只转发"官方管理员"或"运营团队"发送的、
包含"公告/更新/通知"关键词的、
文本或图片类型的消息
```

### 示例2: 过滤垃圾消息

```
配置:
1. 用户黑名单: 广告机器人A, 刷屏用户B
2. 关键词黑名单: 广告, 代练, 外挂
3. 消息类型: 全部启用

结果:
不转发黑名单用户的消息，
也不转发包含黑名单关键词的消息
```

---

## 实战案例

### 案例1: 游戏社区（过滤广告）

**需求**: 转发游戏公告，过滤广告和代练

**配置**:

```yaml
黑名单关键词:
  - 广告
  - 代练
  - 外挂
  - 刷金
  - 低价
  - 包过

白名单用户:
  - 官方管理员
  - 游戏GM
  
消息类型:
  - ✅ 文本消息
  - ✅ 图片消息
  - ✅ 链接消息
  - ☐ 表情反应（太频繁）
```

### 案例2: 技术社区（只转发技术内容）

**需求**: 只转发技术讨论，过滤闲聊

**配置**:

```yaml
白名单关键词:
  - 技术
  - 代码
  - bug
  - 问题
  - 教程
  - 分享

消息类型:
  - ✅ 文本消息
  - ✅ 链接消息
  - ✅ 文件附件（代码、文档）
  - ☐ 表情反应
```

### 案例3: 官方公告频道（极简模式）

**需求**: 只转发官方的重要公告

**配置**:

```yaml
用户白名单:
  - 官方账号
  - 运营团队

关键词白名单:
  - 公告
  - 更新
  - 维护
  - 补偿
  
消息类型:
  - ✅ 文本消息
  - ✅ 图片消息
  - ☐ 其他全部禁用
```

---

## 常见问题

### Q: 黑名单和白名单可以同时用吗？

**A**: 不可以！两种模式互斥：
- 黑名单模式: 默认全转发，排除黑名单
- 白名单模式: 默认不转发，仅转发白名单

### Q: 如何测试过滤规则是否生效？

**A**: 
1. 配置完成后，发送测试消息
2. 查看"实时日志"页面
3. 检查消息是否被过滤（状态显示"已过滤"）

### Q: 关键词是否区分大小写？

**A**: 不区分！系统会自动转换为小写匹配。

### Q: 可以使用正则表达式吗？

**A**: 当前版本不支持，计划在v7.0添加。

### Q: 过滤规则可以导入导出吗？

**A**: 可以！
1. 导出: 过滤规则页面 → 导出按钮 → 保存JSON文件
2. 导入: 过滤规则页面 → 导入按钮 → 选择JSON文件

---

## 💡 最佳实践

### 1. 从简单开始

不要一次性配置过多规则，建议：
1. 先运行一段时间，观察消息情况
2. 发现垃圾消息，逐步添加黑名单
3. 逐步完善规则

### 2. 定期检查日志

定期查看"实时日志"：
- 检查是否有误过滤的消息
- 调整规则
- 优化关键词

### 3. 备份规则

重要规则配置完成后：
1. 导出为JSON文件
2. 保存到安全位置
3. 可以随时恢复

### 4. 使用模板

系统提供常用模板：
- 游戏社区模板
- 技术社区模板
- 官方公告模板

点击"加载模板"即可快速配置！

---

## 📺 视频教程

🎬 [观看视频: 过滤规则完整配置（5分钟）](/help/videos?id=filter-rules)

---

## 🔗 相关教程

- [频道映射配置](./06-频道映射详解教程.md)
- [常见问题FAQ](./FAQ-常见问题.md)

---

**教程完成日期**: 2025-10-27  
**版本**: v1.0
