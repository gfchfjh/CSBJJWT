# KOOK消息转发系统 - 常见问题解答（FAQ）

**版本**: v17.0.0  
**更新时间**: 2025-10-31

---

## 📋 目录

- [安装与配置](#安装与配置)
- [账号与登录](#账号与登录)
- [Bot配置](#bot配置)
- [频道映射](#频道映射)
- [消息转发](#消息转发)
- [故障排查](#故障排查)
- [高级功能](#高级功能)
- [性能优化](#性能优化)

---

## 安装与配置

### Q1: 如何选择合适的版本？

**A**: 根据您的需求选择：

- **Electron桌面应用** - 推荐！无需环境，双击运行，自带托盘功能
- **Production Web版** - 备用方案，浏览器访问
- **Runnable版** - 技术用户，可查看源码

### Q2: 安装后无法启动怎么办？

**A**: 检查以下几点：

1. **端口占用**: 
   - 检查9527端口是否被占用
   - Windows: `netstat -ano | findstr 9527`
   - Linux/Mac: `lsof -i:9527`
   
2. **防火墙**:
   - 允许应用通过防火墙
   - 暂时关闭杀毒软件测试

3. **权限问题**:
   - Windows: 右键"以管理员身份运行"
   - Linux: 确保有执行权限 `chmod +x`

### Q3: 数据存储在哪里？

**A**: 所有数据存储在：

```
~/.kook-forwarder/
├── data/
│   ├── config.db      # 配置数据库
│   ├── images/        # 图片缓存
│   └── plugins/       # 插件目录
└── logs/              # 日志文件
```

**清理方法**:
- 删除上述目录即可完全卸载
- 配置导出后可安全删除

---

## 账号与登录

### Q4: KOOK账号一直显示"离线"？

**A**: 可能的原因和解决方案：

**原因1: Cookie已过期**
- 解决: 重新登录账号
- 步骤: 账号管理 → 点击账号 → 重新登录

**原因2: IP被限制**
- 解决: 更换网络或使用代理
- 检查: 尝试在浏览器访问KOOK网页版

**原因3: 账号被封禁**
- 解决: 联系KOOK客服
- 预防: 避免频繁操作，设置合理限流

### Q5: 如何获取KOOK Cookie？

**A**: 两种方法：

**方法1: Chrome扩展（推荐）**
1. 安装项目提供的Chrome扩展
2. 登录KOOK网页版
3. 点击扩展图标 → 自动发送到应用

**方法2: 手动导出**
1. 登录KOOK网页版
2. F12打开开发者工具
3. Application → Cookies → 复制全部
4. 粘贴到应用的"Cookie导入"框

### Q6: 支持多少个账号同时监听？

**A**: 
- 理论上**无限制**
- 实际建议: **不超过5个**
- 原因: 
  - 每个账号占用资源
  - 过多账号可能触发KOOK限制
  - 系统性能考虑

---

## Bot配置

### Q7: Discord Webhook如何创建？

**A**: 详细步骤：

1. 打开Discord，进入目标频道
2. 右键频道 → 编辑频道
3. 集成 → Webhooks → 创建Webhook
4. 复制Webhook URL
5. 粘贴到本应用的"Bot配置"页

**注意事项**:
- URL格式: `https://discord.com/api/webhooks/...`
- 保管好URL，不要泄露
- 可为不同频道创建多个Webhook

### Q8: Telegram Bot创建失败？

**A**: 常见问题：

**问题1: Bot Token无效**
- 检查: Token格式应为 `1234567890:ABCdefGHI...`
- 解决: 与 @BotFather 对话重新获取

**问题2: Chat ID获取失败**
- 方法1: 使用应用内置的"自动获取"功能
- 方法2: 手动方法：
  1. 将Bot添加到群组
  2. 发送一条消息
  3. 访问: `https://api.telegram.org/bot<TOKEN>/getUpdates`
  4. 查找 `"chat":{"id":-100xxxx}`

**问题3: Bot无权限**
- 解决: 确保Bot是群组管理员
- 设置: 群组设置 → 管理员 → 添加Bot

### Q9: 飞书自建应用配置复杂吗？

**A**: 跟随指南很简单：

**步骤总览**:
1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 创建企业自建应用
3. 开启机器人能力
4. 获取 App ID 和 App Secret
5. 将机器人添加到群组
6. 在应用中填入配置

**常见错误**:
- ❌ 忘记发布应用版本
- ❌ 未开启消息权限
- ❌ 未将机器人添加到群组

**提示**: 应用内提供详细视频教程

---

## 频道映射

### Q10: 什么是频道映射？

**A**: 
频道映射定义了**消息转发规则**：

```
KOOK频道A  →  Discord Webhook1
KOOK频道A  →  Telegram Group1
KOOK频道B  →  飞书Group1
```

**特点**:
- 一对多: 一个KOOK频道可转发到多个目标
- 灵活配置: 可随时启用/禁用
- 双视图: 表格视图/流程图视图

### Q11: 智能映射如何使用？

**A**: 
**智能映射**能自动匹配同名频道：

**使用步骤**:
1. 频道映射页 → 点击"智能映射"
2. 系统自动识别KOOK频道名称
3. 在目标平台查找相似名称
4. 自动建立映射关系
5. 手动调整（可选）

**示例**:
```
KOOK "#公告"      →  Discord "#announcements"
KOOK "#活动"      →  Telegram "活动群"
KOOK "#技术讨论"  →  飞书 "技术交流群"
```

### Q12: 如何批量管理映射？

**A**: 
使用**表格视图**更高效：

**功能**:
- ✅ 批量启用/禁用
- ✅ 筛选排序
- ✅ 导出/导入配置
- ✅ 一键测试

**快捷操作**:
- Ctrl+A: 全选
- Delete: 删除选中
- 双击: 编辑映射

---

## 消息转发

### Q13: 消息转发延迟很大（超过10秒）？

**A**: 排查步骤：

**1. 检查队列状态**
- 进入实时监控页
- 查看"队列中"消息数
- 如果>50条，说明积压

**解决方案**:
- 减少映射数量
- 降低转发频率
- 增加系统资源

**2. 检查网络**
- 测试网络连接速度
- 尝试使用代理
- 检查目标平台是否限流

**3. 检查限流设置**
- 设置 → 限流保护
- 适当调整限流参数

### Q14: 图片转发失败？

**A**: 三种可能：

**情况1: 图片被防盗链**
- 现象: 显示"403 Forbidden"
- 解决: 应用已自动处理，重试即可

**情况2: 图片过大**
- 限制: Discord 8MB, Telegram 10MB
- 解决: 
  - 自动压缩功能（设置中启用）
  - 使用图床模式

**情况3: 目标平台限制**
- 解决: 切换图片处理策略
  - 设置 → 图片处理 → 智能模式

### Q15: 部分消息类型无法转发？

**A**: 检查过滤规则：

**步骤**:
1. 过滤规则页
2. 检查"消息类型过滤"
3. 确保目标类型已勾选
4. 检查黑名单关键词

**消息类型支持**:
- ✅ 文本消息
- ✅ 图片消息
- ✅ 链接消息
- ✅ 文件附件（≤50MB）
- ✅ 表情反应
- ✅ @提及
- ✅ 回复引用

---

## 故障排查

### Q16: 如何查看错误日志？

**A**: 多种方式：

**方式1: 应用内查看**
- 实时日志页 → 筛选"失败"状态
- 点击消息查看详细错误

**方式2: 日志文件**
- 位置: `~/.kook-forwarder/logs/`
- 文件: `app_YYYY-MM-DD.log`
- 查看最新: `tail -f app_*.log`

**方式3: 系统设置**
- 设置 → 日志设置 → 打开日志文件夹

### Q17: 服务突然停止运行？

**A**: 排查清单：

**1. 检查进程**
```bash
# Windows
tasklist | findstr kook

# Linux/Mac
ps aux | grep kook
```

**2. 查看崩溃日志**
- 日志目录查找ERROR级别
- 寻找异常堆栈信息

**3. 常见原因**:
- 内存不足（增加swap）
- Redis连接断开（自动重启Redis）
- 数据库损坏（恢复备份）

### Q18: 如何重置配置？

**A**: 两种方法：

**方法1: 应用内重置**
- 设置 → 备份与恢复 → 恢复默认配置

**方法2: 手动删除**
```bash
# 备份现有配置
mv ~/.kook-forwarder ~/.kook-forwarder.bak

# 重启应用会重新初始化
```

**注意**: 重置后需重新配置账号和映射

---

## 高级功能

### Q19: 如何使用插件？

**A**: 

**安装插件**:
1. 插件管理页
2. 点击"安装插件"
3. 拖拽.zip插件包
4. 等待安装完成

**启用插件**:
1. 已安装列表
2. 切换插件开关
3. 配置插件参数（如需）

**插件市场**:
- 查看官方和社区插件
- 点击"安装"按钮一键安装
- 查看插件评分和下载量

### Q20: 邮件告警如何配置？

**A**: 

**SMTP配置**:
1. 设置 → 邮件告警
2. 填写SMTP服务器信息：
   - 服务器: smtp.gmail.com
   - 端口: 587
   - 用户名/密码
3. 点击"测试连接"

**常用SMTP**:
- Gmail: `smtp.gmail.com:587`
- QQ邮箱: `smtp.qq.com:587`
- 163邮箱: `smtp.163.com:465`

**告警类型**:
- 服务异常
- 账号掉线
- 转发失败（可选）

### Q21: 审计日志有什么用？

**A**: 

**用途**:
- 追踪所有操作历史
- 安全审计
- 问题排查
- 合规要求

**记录内容**:
- 用户登录/登出
- 配置修改
- 映射变更
- 服务启停
- 插件安装

**查看方式**:
- 审计日志页
- 筛选/导出
- 统计分析

---

## 性能优化

### Q22: 如何提升转发性能？

**A**: 优化建议：

**1. 数据库优化**
- 定期清理日志（设置 → 日志清理）
- 保留天数设为3-7天
- 定期备份并重建数据库

**2. Redis优化**
- 增加Redis内存限制
- 启用持久化（已默认）
- 监控队列长度

**3. 映射优化**
- 减少不必要的映射
- 禁用闲置映射
- 合并相似频道

**4. 限流调整**
- 根据实际需求调整
- 避免设置过低
- 监控API限流情况

### Q23: 系统资源占用过高？

**A**: 

**正常占用**:
- CPU: 空闲<5%, 转发时<30%
- 内存: 200-500MB
- 磁盘I/O: <20MB/s

**异常排查**:
1. **CPU过高**
   - 检查是否有死循环
   - 查看日志错误
   - 减少并发转发

2. **内存过高**
   - 清理图片缓存
   - 重启服务
   - 检查内存泄漏

3. **磁盘I/O过高**
   - 调整日志级别
   - 使用SSD
   - 定期清理

---

## 联系支持

### 获取帮助

- **GitHub Issues**: [提交问题](https://github.com/gfchfjh/CSBJJWT/issues)
- **文档**: [完整文档](../docs/)
- **API文档**: `http://localhost:9527/docs`

### 常用命令

```bash
# 查看版本
./kook-forwarder --version

# 查看日志
tail -f ~/.kook-forwarder/logs/app_*.log

# 测试连接
curl http://localhost:9527/health

# 清理缓存
rm -rf ~/.kook-forwarder/data/images/*
```

---

**提示**: 如果以上方法都无法解决问题，请提供以下信息以获得更好的支持：
- 操作系统和版本
- 应用版本号
- 错误日志
- 重现步骤

**最后更新**: 2025-10-31
