# 配置向导未自动打开 - 诊断指南

## 🔍 用户情况
- 首次安装 v1.13.2
- 从未使用过旧版本
- 配置向导没有自动打开

---

## 📋 诊断步骤

### 步骤 1：确认当前界面

**问题**：安装后，您现在看到的是什么界面？

**A. 免责声明对话框** ⚠️ 重要提示
```
标题：⚠️ 重要：免责声明
内容：使用本软件前，请您务必仔细阅读并理解以下条款...
```
→ **正常流程**：需要勾选"我已阅读"并点击"同意并继续"

---

**B. 登录/设置密码界面** 🔑
```
标题：KOOK消息转发系统
提示：首次设置密码 / 请输入主密码
```
→ **正常流程**：
1. 首次使用应该显示"首次设置密码"
2. 输入 6-20 位密码
3. 点击"设置密码"
4. 应该自动跳转到配置向导

---

**C. 主界面/仪表盘** 📊
```
显示：实时监控、统计图表、菜单栏等
```
→ **异常**：这说明系统认为您已经配置完成
→ **原因**：可能存在旧数据或缓存

---

**D. 配置向导界面** ✅
```

```
→ **正常**：这就是应该出现的界面！

---

**E. 空白页面或加载错误** ❌
```
页面一片空白 或 显示错误信息
```
→ **问题**：前端或后端启动失败

---

### 步骤 2：检查浏览器控制台（重要！）

**操作**：
1. 在应用界面按 `F12` 键（或 `Ctrl + Shift + I`）
2. 打开开发者工具
3. 切换到 **Console（控制台）** 标签
4. 查看是否有**红色错误信息**

**常见错误及含义**：

```javascript
// 错误 1：后端连接失败
Failed to fetch http://localhost:9527/...
// → 后端服务没有启动

// 错误 2：CORS错误
Access to fetch at 'http://localhost:9527/...' has been blocked by CORS policy
// → 后端配置问题

// 错误 3：路由错误
Cannot GET /wizard
// → 前端路由配置问题

// 错误 4：没有错误，但有警告
检测到首次启动或配置不完整，跳转到配置向导
// → 应该正常跳转，如果没跳转说明路由有问题
```

**请复制控制台中的错误信息**，我会帮您分析！

---

### 步骤 3：检查后端服务状态

**方法 1：通过浏览器访问**

在应用内按 `F12` 打开控制台，输入：

```javascript
fetch('http://localhost:9527/health')
  .then(r => r.json())
  .then(d => console.log('后端状态:', d))
  .catch(e => console.error('后端未启动:', e))
```

**预期结果**：
- ✅ 正常：显示 `后端状态: {status: "ok", ...}`
- ❌ 异常：显示 `后端未启动: ...`

---

**方法 2：检查系统托盘**

查看系统托盘（Windows右下角 / macOS右上角）：
- 是否有 KOOK 图标？
- 右键图标，是否显示"运行中"？

---

### 步骤 4：检查数据库状态

**操作**：在控制台执行

```javascript
fetch('http://localhost:9527/api/accounts')
  .then(r => r.json())
  .then(d => console.log('账号数量:', d.length, '个'))
  .catch(e => console.error('API错误:', e))

fetch('http://localhost:9527/api/bots')
  .then(r => r.json())
  .then(d => console.log('Bot数量:', d.length, '个'))
  .catch(e => console.error('API错误:', e))
```

**预期结果（首次安装）**：
- ✅ 正常：`账号数量: 0 个`，`Bot数量: 0 个`
- ❌ 异常：显示有账号或Bot（说明有旧数据）

---

### 步骤 5：检查 localStorage

**操作**：在控制台执行

```javascript
console.log('免责声明:', localStorage.getItem('disclaimer_accepted'))
console.log('向导完成:', localStorage.getItem('wizard_completed'))
console.log('认证Token:', localStorage.getItem('auth_token'))
```

**预期结果（首次安装）**：
- ✅ 正常：全部显示 `null`
- ⚠️ 异常：有任何非 null 值（说明有缓存）

**如果有缓存，执行清理**：
```javascript
localStorage.clear()
console.log('✅ 缓存已清除')
location.reload()  // 刷新页面
```

---

### 步骤 6：检查密码状态

**操作**：在控制台执行

```javascript
fetch('http://localhost:9527/auth/status')
  .then(r => r.json())
  .then(d => console.log('密码设置状态:', d))
  .catch(e => console.error('API错误:', e))
```

**预期结果（首次安装）**：
- ✅ 正常：`{password_set: false}`（未设置密码）
- ❌ 异常：`{password_set: true}`（已设置密码）

**如果已设置密码但您不记得**：
- 说明数据库中有密码记录
- 需要重置或清理数据

---

## 🔧 快速修复方案

### 方案 A：清除浏览器缓存（最快）

```javascript
// 在控制台执行
localStorage.clear()
sessionStorage.clear()
console.log('✅ 缓存已清除')
location.reload()
```

---

### 方案 B：手动进入向导

```javascript
// 在控制台执行
window.location.href = '/#/wizard'
```

或者通过菜单：
1. 点击左侧菜单的 **"帮助中心"**
2. 找到 **"启动配置向导"** 按钮
3. 点击进入

---

### 方案 C：完全重置（最彻底）

**Windows**:
```powershell
# 1. 关闭应用
# 2. 删除数据目录
Remove-Item -Recurse -Force "$env:USERPROFILE\Documents\KookForwarder"
# 3. 重新打开应用
```

**macOS**:
```bash
# 1. 关闭应用
# 2. 删除数据目录
rm -rf ~/Documents/KookForwarder
# 3. 重新打开应用
```

**Linux**:
```bash
# 1. 关闭应用
# 2. 删除数据目录
rm -rf ~/Documents/KookForwarder
# 3. 重新打开应用
```

---

## 📊 收集诊断信息

如果上述方法都无效，请提供以下信息：

### ✅ 必需信息

1. **当前界面截图**
   - 完整的应用界面
   
2. **控制台输出**
   - 按 F12 打开
   - Console 标签的所有内容（包括红色错误）
   
3. **诊断结果**
   - 步骤 3 的结果（后端状态）
   - 步骤 4 的结果（数据库状态）
   - 步骤 5 的结果（localStorage）
   - 步骤 6 的结果（密码状态）

### 📋 系统信息

- **操作系统**：Windows / macOS / Linux
- **版本号**：（例如 Windows 11, macOS 13.0）
- **安装方式**：直接下载 exe/dmg/AppImage
- **是否第一次打开**：是 / 否

---

## 💡 常见原因排查表

| 现象 | 可能原因 | 解决方案 |
|------|---------|---------|
| 直接进入主界面 | 有旧数据或缓存 | 方案 A 或 C |
| 停在登录界面 | 未输入密码 | 设置密码后自动跳转 |
| 停在免责声明 | 未同意条款 | 勾选并点击"同意" |
| 空白页面 | 前端加载失败 | 检查控制台错误 |
| 提示后端错误 | 后端未启动 | 检查系统托盘，重启应用 |

---

## 🎯 预期的正常流程

**首次安装应该是这样的**：

```
1. 打开应用
   ↓
2. 显示免责声明对话框
   ↓ 勾选"我已阅读"并点击"同意"
   ↓
3. 显示"首次设置密码"界面
   ↓ 输入 6-20 位密码
   ↓
4. 自动跳转到配置向导（5步）
   ✅ 步骤 1：欢迎
   ✅ 步骤 2：添加 KOOK 账号
   ✅ 步骤 3：选择服务器/频道
   ✅ 步骤 4：配置转发 Bot
   ✅ 步骤 5：完成
   ↓
5. 完成后进入主界面
```

**如果任何一步卡住了，请告诉我您在哪一步！**

---

## 📞 联系支持

如果以上方法都无法解决，请提供：
- 完整的诊断信息（见上方"收集诊断信息"）
- 应用日志文件（位置见下）

**日志文件位置**：
- Windows: `C:\Users\[用户名]\Documents\KookForwarder\data\logs\`
- macOS: `/Users/[用户名]/Documents/KookForwarder/data/logs/`
- Linux: `/home/[用户名]/Documents/KookForwarder/data/logs/`

---

**生成时间**: 2025-10-22  
**适用版本**: v1.13.1  
**文档版本**: 1.0
