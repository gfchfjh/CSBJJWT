# KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - å‹åŠ›æµ‹è¯•è¯´æ˜æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•æ¦‚è§ˆ

æœ¬é¡¹ç›®åŒ…å«ä¸‰å¥—å®Œæ•´çš„å‹åŠ›æµ‹è¯•ç³»ç»Ÿï¼Œå…¨é¢æµ‹è¯•KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿçš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ã€‚

### æµ‹è¯•å¥—ä»¶

1. **åŸæœ‰å‹åŠ›æµ‹è¯•** (`stress_test.py`)
   - åŸºç¡€APIç«¯ç‚¹æµ‹è¯•
   - å¹¶å‘è¯·æ±‚æµ‹è¯•
   - æ•°æ®åº“æ€§èƒ½æµ‹è¯•
   - æ¶ˆæ¯é˜Ÿåˆ—æµ‹è¯•
   - é™æµå™¨æµ‹è¯•

2. **å…¨é¢å‹åŠ›æµ‹è¯•** (`comprehensive_stress_test.py`)
   - APIç«¯ç‚¹å‹åŠ›æµ‹è¯•ï¼ˆå¤šå¹¶å‘çº§åˆ«ï¼‰
   - æ¶ˆæ¯æ ¼å¼è½¬æ¢å‹åŠ›æµ‹è¯•
   - Redisé˜Ÿåˆ—å‹åŠ›æµ‹è¯•ï¼ˆå¤šæ‰¹æ¬¡å¤§å°ï¼‰
   - é™æµå™¨å‹åŠ›æµ‹è¯•ï¼ˆå¤šç§é…ç½®ï¼‰
   - æ•°æ®åº“å¹¶å‘æ“ä½œæµ‹è¯•
   - å›¾ç‰‡å¤„ç†å‹åŠ›æµ‹è¯•
   - ç«¯åˆ°ç«¯é›†æˆå‹åŠ›æµ‹è¯•

3. **æ¨¡å—ä¸“é¡¹æµ‹è¯•** (`module_specific_stress_test.py`)
   - æ¶ˆæ¯éªŒè¯å™¨å‹åŠ›æµ‹è¯•
   - è¿‡æ»¤å™¨å‹åŠ›æµ‹è¯•
   - åŠ å¯†è§£å¯†å‹åŠ›æµ‹è¯•
   - æ—¥å¿—è®°å½•å‹åŠ›æµ‹è¯•
   - WebSocketè¿æ¥å‹åŠ›æµ‹è¯•
   - ç¼“å­˜ç³»ç»Ÿå‹åŠ›æµ‹è¯•
   - é”™è¯¯å¤„ç†å‹åŠ›æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

1. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   cd backend
   python -m app.main
   ```

2. **å¯åŠ¨RedisæœåŠ¡**
   ```bash
   redis-server
   # æˆ–è€…ä½¿ç”¨é¡¹ç›®æä¾›çš„è„šæœ¬
   cd redis
   ./start_redis.sh  # Linux/macOS
   ./start_redis.bat # Windows
   ```

3. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r backend/requirements.txt
   pip install -r backend/requirements-dev.txt
   ```

### è¿è¡Œæµ‹è¯•

#### æ–¹å¼1: è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰

**Linux/macOS:**
```bash
./run_all_stress_tests.sh
```

**Windows:**
```bash
run_all_stress_tests.bat
```

#### æ–¹å¼2: å•ç‹¬è¿è¡Œæµ‹è¯•

```bash
# åŸæœ‰å‹åŠ›æµ‹è¯•
python stress_test.py

# å…¨é¢å‹åŠ›æµ‹è¯•
python comprehensive_stress_test.py

# æ¨¡å—ä¸“é¡¹æµ‹è¯•
python module_specific_stress_test.py
```

## ğŸ“Š æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. APIæ¥å£æµ‹è¯•

- **æµ‹è¯•å†…å®¹**:
  - å¥åº·æ£€æŸ¥æ¥å£
  - è´¦å·ç®¡ç†æ¥å£
  - Boté…ç½®æ¥å£
  - é¢‘é“æ˜ å°„æ¥å£
  - æ—¥å¿—æŸ¥è¯¢æ¥å£
  - ç³»ç»ŸçŠ¶æ€æ¥å£

- **å¹¶å‘çº§åˆ«**: 1, 5, 10, 20, 50, 100, 200

- **æµ‹è¯•æŒ‡æ ‡**:
  - QPS (æ¯ç§’è¯·æ±‚æ•°)
  - å¹³å‡å“åº”æ—¶é—´
  - P50/P90/P99å“åº”æ—¶é—´
  - æˆåŠŸç‡

### 2. æ¶ˆæ¯å¤„ç†æµ‹è¯•

- **æ ¼å¼è½¬æ¢**:
  - KMarkdown â†’ Discord Markdown
  - KMarkdown â†’ Telegram HTML
  - KMarkdown â†’ é£ä¹¦å¯Œæ–‡æœ¬
  - æ¶ˆæ¯åˆ†æ®µå¤„ç†

- **æµ‹è¯•è§„æ¨¡**: 1000, 5000, 10000, 50000 æ¬¡è¿­ä»£

- **æµ‹è¯•æŒ‡æ ‡**:
  - è½¬æ¢é€Ÿåº¦ (ops/s)
  - å†…å­˜ä½¿ç”¨
  - CPUä½¿ç”¨

### 3. Redisé˜Ÿåˆ—æµ‹è¯•

- **æµ‹è¯•æ“ä½œ**:
  - æ¶ˆæ¯å…¥é˜Ÿ
  - æ¶ˆæ¯å‡ºé˜Ÿ
  - æ‰¹é‡æ“ä½œ
  - é˜Ÿåˆ—å¤§å°ç®¡ç†

- **æ‰¹é‡å¤§å°**: 10, 50, 100, 500, 1000, 5000

- **æµ‹è¯•æŒ‡æ ‡**:
  - å…¥é˜ŸQPS
  - å‡ºé˜ŸQPS
  - æ‰¹é‡æ“ä½œQPS
  - å»¶è¿Ÿæ—¶é—´

### 4. é™æµå™¨æµ‹è¯•

- **æµ‹è¯•é…ç½®**:
  - Discordé™æµ (5è¯·æ±‚/5ç§’)
  - Telegramé™æµ (30è¯·æ±‚/1ç§’)
  - é£ä¹¦é™æµ (20è¯·æ±‚/1ç§’)
  - è‡ªå®šä¹‰é™æµ (100è¯·æ±‚/10ç§’)

- **æµ‹è¯•æŒ‡æ ‡**:
  - é™æµå‡†ç¡®åº¦
  - ç­‰å¾…æ—¶é—´
  - ååé‡

### 5. æ•°æ®åº“æµ‹è¯•

- **æµ‹è¯•æ“ä½œ**:
  - ç®€å•æŸ¥è¯¢
  - å¤æ‚æŸ¥è¯¢ (JOIN)
  - æ‰¹é‡æ’å…¥
  - å¹¶å‘è¯»å†™

- **æ“ä½œæ•°é‡**: 100, 500, 1000, 5000, 10000

- **æµ‹è¯•æŒ‡æ ‡**:
  - æŸ¥è¯¢QPS
  - å†™å…¥QPS
  - äº‹åŠ¡æ€§èƒ½
  - å¹¶å‘å®‰å…¨æ€§

### 6. å›¾ç‰‡å¤„ç†æµ‹è¯•

- **æµ‹è¯•å°ºå¯¸**:
  - å°å›¾: 800Ã—600
  - ä¸­å›¾: 1920Ã—1080
  - 4Kå›¾: 3840Ã—2160
  - 8Kå›¾: 7680Ã—4320

- **æµ‹è¯•æ“ä½œ**:
  - JPEGå‹ç¼©
  - PNGå‹ç¼©
  - å›¾ç‰‡ç¼©æ”¾
  - æ‰¹é‡å¤„ç†

- **æµ‹è¯•æŒ‡æ ‡**:
  - å¤„ç†é€Ÿåº¦
  - å‹ç¼©ç‡
  - å†…å­˜å ç”¨

### 7. ç«¯åˆ°ç«¯æµ‹è¯•

- **å®Œæ•´æµç¨‹**:
  1. æ¥æ”¶æ¶ˆæ¯
  2. æ ¼å¼è½¬æ¢
  3. è¿‡æ»¤è§„åˆ™åº”ç”¨
  4. é™æµæ§åˆ¶
  5. è½¬å‘åˆ°ç›®æ ‡å¹³å°
  6. è®°å½•æ—¥å¿—

- **æµ‹è¯•è§„æ¨¡**: 10, 50, 100, 500 æ¡æ¶ˆæ¯

- **æµ‹è¯•æŒ‡æ ‡**:
  - ç«¯åˆ°ç«¯å»¶è¿Ÿ
  - ååé‡
  - æˆåŠŸç‡
  - èµ„æºä½¿ç”¨

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### æ¨èé…ç½®ä¸‹çš„æ€§èƒ½åŸºå‡†

| æµ‹è¯•é¡¹ | æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| API QPS | å¹¶å‘100 | >500 QPS | ä¿è¯å“åº”æ—¶é—´<100ms |
| æ ¼å¼è½¬æ¢ | Discord | >10000 ops/s | åŸºç¡€æ ¼å¼è½¬æ¢ |
| æ ¼å¼è½¬æ¢ | Telegram | >8000 ops/s | HTMLæ ¼å¼è½¬æ¢ |
| Rediså…¥é˜Ÿ | æ‰¹é‡1000 | >5000 msg/s | æ¶ˆæ¯é˜Ÿåˆ—æ€§èƒ½ |
| Rediså‡ºé˜Ÿ | æ‰¹é‡1000 | >5000 msg/s | æ¶ˆè´¹è€…æ€§èƒ½ |
| æ•°æ®åº“æŸ¥è¯¢ | ç®€å•æŸ¥è¯¢ | >1000 QPS | åŸºç¡€æŸ¥è¯¢ |
| æ•°æ®åº“å†™å…¥ | æ‰¹é‡æ’å…¥ | >500 QPS | äº‹åŠ¡å†™å…¥ |
| ç«¯åˆ°ç«¯å»¶è¿Ÿ | å•æ¡æ¶ˆæ¯ | <50ms | å®Œæ•´æµç¨‹ |
| ç«¯åˆ°ç«¯åå | æ‰¹é‡å¤„ç† | >100 msg/s | æ‰¹é‡è½¬å‘ |

## ğŸ“„ æµ‹è¯•æŠ¥å‘Š

### ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶

æµ‹è¯•å®Œæˆåä¼šåœ¨ `test_results/` ç›®å½•ä¸‹ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶:

1. **JSONæŠ¥å‘Š** (æœºå™¨å¯è¯»):
   - `stress_test_report.json` - åŸæœ‰å‹åŠ›æµ‹è¯•ç»“æœ
   - `comprehensive_stress_test_report.json` - å…¨é¢å‹åŠ›æµ‹è¯•ç»“æœ
   - `module_stress_test_report.json` - æ¨¡å—ä¸“é¡¹æµ‹è¯•ç»“æœ

2. **MarkdownæŠ¥å‘Š** (äººç±»å¯è¯»):
   - `å‹åŠ›æµ‹è¯•æŠ¥å‘Š.md` - åŸæœ‰æµ‹è¯•æŠ¥å‘Š
   - `å…¨é¢å‹åŠ›æµ‹è¯•æŠ¥å‘Š.md` - å…¨é¢æµ‹è¯•æŠ¥å‘Š
   - `å®Œæ•´æµ‹è¯•æŠ¥å‘Šæ±‡æ€».md` - æ‰€æœ‰æµ‹è¯•æ±‡æ€»

3. **æ—¥å¿—æ–‡ä»¶**:
   - `stress_test.log` - åŸæœ‰æµ‹è¯•æ—¥å¿—
   - `comprehensive_stress_test.log` - å…¨é¢æµ‹è¯•æ—¥å¿—
   - `module_specific_stress_test.log` - æ¨¡å—æµ‹è¯•æ—¥å¿—

4. **ç®€æŠ¥**:
   - `æµ‹è¯•ç»“æœç®€æŠ¥.txt` - æµ‹è¯•ç»“æœå¿«é€Ÿæ¦‚è§ˆ

### ç”Ÿæˆæ±‡æ€»æŠ¥å‘Š

```bash
python generate_test_summary.py
```

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### ä¿®æ”¹æµ‹è¯•å‚æ•°

ç¼–è¾‘æµ‹è¯•è„šæœ¬ä¸­çš„é…ç½®å­—å…¸:

```python
# comprehensive_stress_test.py
COMPREHENSIVE_TEST_CONFIG = {
    "concurrent_levels": [1, 5, 10, 20, 50, 100],  # ä¿®æ”¹å¹¶å‘çº§åˆ«
    "message_batch_sizes": [10, 50, 100, 500],     # ä¿®æ”¹æ‰¹é‡å¤§å°
    "test_duration_seconds": 60,                    # ä¿®æ”¹æµ‹è¯•æ—¶é•¿
    # ... å…¶ä»–é…ç½®
}
```

### æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•

åœ¨æµ‹è¯•ç±»ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ–¹æ³•:

```python
async def test_custom_feature(self):
    """è‡ªå®šä¹‰åŠŸèƒ½æµ‹è¯•"""
    # æµ‹è¯•é€»è¾‘
    pass
```

## ğŸ› æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **åç«¯æœåŠ¡æœªè¿è¡Œ**
   ```
   è§£å†³: cd backend && python -m app.main
   ```

2. **Redisè¿æ¥å¤±è´¥**
   ```
   è§£å†³: ç¡®ä¿RedisæœåŠ¡è¿è¡Œåœ¨ 127.0.0.1:6379
   ```

3. **æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨**
   ```
   è§£å†³: é¦–æ¬¡è¿è¡Œåç«¯æœåŠ¡ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“
   ```

4. **ä¾èµ–åŒ…ç¼ºå¤±**
   ```
   è§£å†³: pip install aiohttp redis pillow
   ```

5. **æµ‹è¯•è¶…æ—¶**
   ```
   è§£å†³: å¢åŠ timeoutå‚æ•°æˆ–å‡å°‘æµ‹è¯•è§„æ¨¡
   ```

### è°ƒè¯•æ¨¡å¼

è¿è¡Œå•ä¸ªæµ‹è¯•å¹¶æŸ¥çœ‹è¯¦ç»†è¾“å‡º:

```bash
python comprehensive_stress_test.py -v
```

## ğŸ“Š æŒç»­é›†æˆ

### GitHub Actions é…ç½®ç¤ºä¾‹

```yaml
name: Stress Tests

on: [push, pull_request]

jobs:
  stress-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      run: |
        pip install -r backend/requirements.txt
        pip install -r backend/requirements-dev.txt
    
    - name: Start Redis
      run: |
        sudo systemctl start redis
    
    - name: Run stress tests
      run: |
        ./run_all_stress_tests.sh
    
    - name: Upload test results
      uses: actions/upload-artifact@v2
      with:
        name: test-results
        path: test_results/
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å®šæœŸè¿è¡Œ**: åœ¨æ¯æ¬¡é‡å¤§æ›´æ–°å‰è¿è¡Œå®Œæ•´å‹åŠ›æµ‹è¯•

2. **ç›‘æ§è¶‹åŠ¿**: ä¿å­˜å†å²æµ‹è¯•ç»“æœï¼Œç›‘æ§æ€§èƒ½è¶‹åŠ¿

3. **çœŸå®ç¯å¢ƒ**: åœ¨æ¥è¿‘ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸‹è¿è¡Œæµ‹è¯•

4. **é€æ­¥å¢å‹**: ä»ä½å¹¶å‘å¼€å§‹ï¼Œé€æ­¥å¢åŠ å‹åŠ›

5. **èµ„æºç›‘æ§**: æµ‹è¯•æ—¶ç›‘æ§CPUã€å†…å­˜ã€ç£ç›˜IOç­‰èµ„æºä½¿ç”¨

6. **æ¸…ç†æ•°æ®**: æµ‹è¯•ååŠæ—¶æ¸…ç†æµ‹è¯•æ•°æ®

## ğŸ“š å‚è€ƒèµ„æ–™

- [å‹åŠ›æµ‹è¯•æœ€ä½³å®è·µ](https://example.com/stress-testing)
- [Pythonå¼‚æ­¥ç¼–ç¨‹æŒ‡å—](https://docs.python.org/3/library/asyncio.html)
- [Redisæ€§èƒ½ä¼˜åŒ–](https://redis.io/topics/optimization)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜å’Œæ”¹è¿›å»ºè®®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License
