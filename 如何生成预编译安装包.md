# 🚀 如何生成预编译安装包 - 5分钟快速指南

**目标**: 生成 Windows/macOS/Linux 三平台安装包  
**方式**: GitHub Actions 自动构建（零配置）  
**时间**: 15-20 分钟（全自动）

---

## 📋 快速步骤（推荐）

### 步骤1: 运行发布脚本（30秒）

```bash
# Linux/macOS
./release_package.sh

# Windows (Git Bash)
bash release_package.sh
```

### 步骤2: 按提示操作（1分钟）

脚本会询问：
1. 是否继续发布？输入 `y`
2. 输入新版本号（如 `1.13.3`），或留空使用当前版本
3. 是否更新package.json？输入 `y`
4. 确认创建发布？输入 `y`

### 步骤3: 等待构建完成（15-20分钟）

脚本会自动：
- ✅ 创建Git Tag
- ✅ 推送到GitHub
- ✅ 触发GitHub Actions
- ✅ 打开浏览器查看进度

您可以：
- 访问 https://github.com/gfchfjh/CSBJJWT/actions 查看进度
- 或者去喝杯咖啡，等待构建完成 ☕

### 步骤4: 下载安装包（1分钟）

构建完成后：
1. 访问 https://github.com/gfchfjh/CSBJJWT/releases
2. 找到最新的Release（如 v1.13.3）
3. 下载对应平台的安装包：
   - 🪟 Windows: `KookForwarder-Setup-1.13.3.exe` (~450MB)
   - 🍎 macOS: `KookForwarder-1.13.3.dmg` (~480MB)
   - 🐧 Linux: `KookForwarder-1.13.3.AppImage` (~420MB)

**完成！** 🎉

---

## 🎯 详细说明

### 什么是预编译安装包？

预编译安装包是打包了所有依赖的完整应用程序，用户可以直接下载安装，无需安装Python、Node.js、Redis等依赖。

**包含内容**:
- ✅ Python 3.11 运行时
- ✅ Chromium 浏览器（~170MB）
- ✅ Redis 服务（~5MB）
- ✅ 所有Python依赖（58个包）
- ✅ Electron桌面应用
- ✅ 完整前端资源

**安装方式**:
- Windows: 双击.exe，下一步下一步完成
- macOS: 打开.dmg，拖拽到应用程序文件夹
- Linux: `chmod +x *.AppImage && ./KookForwarder.AppImage`

---

## 🔧 构建流程说明

### GitHub Actions自动化流程

推送Git Tag后，GitHub Actions会自动执行以下任务：

#### 1️⃣ 构建后端（并行，5-8分钟）
- **Ubuntu**: 构建Linux后端可执行文件
- **Windows**: 构建Windows后端可执行文件
- **macOS**: 构建macOS后端可执行文件

每个平台的构建包括：
- 下载并打包Chromium浏览器
- 准备Redis二进制文件
- 使用PyInstaller打包Python应用
- 生成单个可执行文件

#### 2️⃣ 构建Electron应用（并行，3-6分钟）
- **Windows**: 生成.exe安装程序
- **macOS**: 生成.dmg磁盘镜像
- **Linux**: 生成.AppImage便携应用

每个平台的构建包括：
- 下载对应平台的后端可执行文件
- 安装前端依赖
- 构建前端资源
- 打包Electron应用
- 生成安装程序

#### 3️⃣ 构建Docker镜像（并行，5-8分钟）
- 构建多架构镜像（amd64 + arm64）
- 推送到GitHub Container Registry
- 生成多个标签（latest, 1.13.3, 1.13, 1）

#### 4️⃣ 创建GitHub Release（1-2分钟）
- 下载所有构建产物
- 创建Release页面
- 上传所有安装包
- 生成发布说明

**总耗时**: 约15-20分钟

---

## 📊 构建进度查看

### 方法1: GitHub Actions页面（推荐）

访问: https://github.com/gfchfjh/CSBJJWT/actions

**查看内容**:
- 当前运行的工作流
- 每个任务的状态（等待中/运行中/完成/失败）
- 实时日志输出
- 预计剩余时间

**状态说明**:
- 🟡 黄色圆圈：等待中
- 🔵 蓝色旋转：运行中
- ✅ 绿色对勾：成功
- ❌ 红色叉号：失败

### 方法2: Release页面

访问: https://github.com/gfchfjh/CSBJJWT/releases

构建完成后会自动出现新版本。

### 方法3: 邮件通知

如果启用了GitHub通知，构建完成（成功或失败）会收到邮件。

---

## ⚠️ 常见问题

### Q1: 构建失败了怎么办？

**步骤**:
1. 访问GitHub Actions页面
2. 点击失败的工作流
3. 查看错误日志
4. 根据错误信息解决问题
5. 删除旧Tag并重新发布：
   ```bash
   # 删除本地和远程Tag
   git tag -d v1.13.3
   git push origin :refs/tags/v1.13.3
   
   # 重新运行发布脚本
   ./release_package.sh
   ```

### Q2: 如何查看构建日志？

1. 访问 https://github.com/gfchfjh/CSBJJWT/actions
2. 点击最新的 "Build and Release" 工作流
3. 点击任意任务（如 "build-backend (ubuntu-latest)"）
4. 展开步骤查看详细日志

### Q3: 构建卡住不动了？

**可能原因**:
- GitHub Actions队列繁忙（等待中）
- 网络问题（下载依赖缓慢）
- 资源不足（内存/磁盘）

**解决方法**:
- 等待5-10分钟
- 如果超过30分钟，取消并重试
- 检查GitHub Status: https://www.githubstatus.com/

### Q4: 我没有推送权限怎么办？

**解决方法**:
1. Fork本仓库到您的账号
2. 在您的仓库中执行发布脚本
3. GitHub Actions会在您的仓库中构建
4. 从您的Release页面下载安装包

### Q5: 如何手动触发构建？

如果不想创建新Tag，可以手动触发：

1. 访问 https://github.com/gfchfjh/CSBJJWT/actions
2. 点击 "Build and Release" 工作流
3. 点击右上角 "Run workflow"
4. 输入版本号（如 v1.13.3）
5. 点击 "Run workflow"

---

## 🎓 高级用法

### 本地构建（不推荐）

如果您想在本地构建（不推荐，比较复杂）：

```bash
# 1. 安装所有依赖
pip install -r backend/requirements.txt
pip install pyinstaller
playwright install chromium
cd frontend && npm install

# 2. 构建后端
cd /workspace
python build/build_backend.py

# 3. 构建前端
cd frontend
npm run build
npm run electron:build

# 4. 查看输出
ls -lh frontend/dist-electron/
```

**缺点**:
- 需要手动安装大量依赖
- 不同平台需要在对应平台上构建
- 耗时更长（首次需下载Chromium，~170MB）
- 容易出错

**优点**:
- 可以本地测试构建流程
- 无需等待GitHub Actions

### 修改构建配置

如需自定义构建配置：

1. **PyInstaller配置**: 编辑 `build/build_backend.py`
2. **Electron配置**: 编辑 `frontend/package.json` → `build` 节点
3. **GitHub Actions配置**: 编辑 `.github/workflows/build-and-release.yml`

---

## 📚 相关文档

**详细文档**:
- [BUILD_RELEASE_GUIDE.md](BUILD_RELEASE_GUIDE.md) - 完整构建指南
- [RELEASE_GUIDE.md](RELEASE_GUIDE.md) - 发布流程指南
- [build/README_BUILD.md](build/README_BUILD.md) - 构建系统说明

**使用文档**:
- [QUICK_START.md](QUICK_START.md) - 快速开始
- [INSTALLATION_GUIDE.md](INSTALLATION_GUIDE.md) - 安装指南
- [README.md](README.md) - 项目说明

---

## 🎉 成功案例

### 示例输出

构建成功后，Release页面应该显示：

```
KOOK消息转发系统 v1.13.3

📦 Assets (3)
├─ KookForwarder-Setup-1.13.3.exe        450 MB
├─ KookForwarder-1.13.3.dmg              480 MB
└─ KookForwarder-1.13.3.AppImage         420 MB

🐳 Docker镜像:
docker pull ghcr.io/gfchfjh/csbjjwt:1.13.3
```

### 验证清单

下载安装包后，请验证：

**Windows**:
- [ ] .exe文件大小约450MB
- [ ] 双击可以正常安装
- [ ] 安装完成后可以启动
- [ ] 配置向导正常显示

**macOS**:
- [ ] .dmg文件大小约480MB
- [ ] 可以正常打开
- [ ] 拖拽到应用程序文件夹成功
- [ ] 首次打开时右键→打开可以绕过安全检查

**Linux**:
- [ ] .AppImage文件大小约420MB
- [ ] `chmod +x`后可以执行
- [ ] 双击或命令行运行正常
- [ ] 界面正常显示

---

## 💡 提示

### 最佳实践

1. **发布前测试**: 确保本地测试通过再发布
2. **版本号规范**: 遵循语义化版本（1.13.3）
3. **更新文档**: 发布后更新README和CHANGELOG
4. **备份Tag**: 发布后不要删除Tag，保留版本历史

### 时间安排

建议在以下时间发布：
- ✅ 工作日白天（便于处理问题）
- ✅ 非高峰时段（GitHub Actions队列较短）
- ❌ 周五晚上或周末（出问题难以及时处理）

### 沟通建议

发布后建议：
- 在GitHub Release中添加详细说明
- 在项目README中更新版本号和下载链接
- 在社交媒体/论坛发布公告
- 通知现有用户升级

---

## 🆘 获取帮助

如有问题：
1. 查看 [BUILD_RELEASE_GUIDE.md](BUILD_RELEASE_GUIDE.md) 详细文档
2. 查看GitHub Actions日志
3. 搜索GitHub Issues中的类似问题
4. 提交新Issue: https://github.com/gfchfjh/CSBJJWT/issues/new

---

**祝您构建顺利！** 🎉

如果觉得这份指南有帮助，请给项目点个⭐Star！

---

**文档版本**: v1.0  
**更新日期**: 2025-10-23  
**作者**: KOOK Forwarder Team
