# KOOK消息转发系统 - 压力测试文件清单

## 📁 文件结构

```
workspace/
├── 压力测试脚本/
│   ├── stress_test.py                      # 原有压力测试
│   ├── comprehensive_stress_test.py        # 全面压力测试  
│   ├── module_specific_stress_test.py      # 模块专项测试
│   └── demo_stress_test.py                 # 演示测试（无需服务）
│
├── 运行脚本/
│   ├── run_all_stress_tests.sh             # Linux/macOS自动化运行
│   └── run_all_stress_tests.bat            # Windows自动化运行
│
├── 工具脚本/
│   └── generate_test_summary.py            # 测试报告汇总生成器
│
├── 文档/
│   ├── 压力测试说明.md                      # 完整使用指南
│   ├── 压力测试完成总结.md                  # 项目完成总结
│   └── 压力测试文件清单.md                  # 本文件
│
└── 测试结果/
    └── test_results/                       # 测试报告输出目录
        ├── *.json                          # JSON格式报告
        ├── *.md                            # Markdown格式报告
        └── *.log                           # 测试执行日志
```

---

## 📄 文件说明

### 1. 压力测试脚本

#### `stress_test.py` - 原有压力测试
**功能**:
- API端点响应测试
- 并发请求测试（1-200并发）
- 数据库性能测试
- 消息队列性能测试
- 限流器性能测试
- 图片处理性能测试
- 消息格式转换测试

**运行方式**:
```bash
python3 stress_test.py
```

**前置条件**:
- ✅ 后端服务运行在 http://127.0.0.1:9527
- ✅ Redis运行在 127.0.0.1:6379

---

#### `comprehensive_stress_test.py` - 全面压力测试
**功能**:
- API端点压力测试（多并发级别）
- 消息格式转换压力测试（多迭代次数）
- Redis队列压力测试（多批量大小）
- 限流器压力测试（多种配置）
- 数据库并发操作测试（多操作量级）
- 图片处理压力测试（多种尺寸）
- 端到端集成压力测试

**特点**:
- 🎨 彩色输出，清晰易读
- 📊 详细的性能指标统计
- 📈 自动生成P50/P90/P99响应时间
- 📝 自动生成JSON和Markdown报告

**运行方式**:
```bash
python3 comprehensive_stress_test.py
```

**配置参数**:
```python
COMPREHENSIVE_TEST_CONFIG = {
    "concurrent_levels": [1, 5, 10, 20, 50, 100],
    "message_batch_sizes": [10, 50, 100, 500, 1000, 5000],
    "formatter_iterations": [1000, 5000, 10000, 50000],
    # ... 更多配置
}
```

---

#### `module_specific_stress_test.py` - 模块专项测试
**功能**:
- 消息验证器压力测试
- 过滤器压力测试（关键词/用户/复合）
- 加密解密压力测试
- 日志记录压力测试
- WebSocket连接压力测试
- 缓存系统压力测试
- 错误处理压力测试

**特点**:
- 🔍 深度测试特定功能模块
- 📊 详细的性能数据收集
- 💾 自动保存JSON报告

**运行方式**:
```bash
python3 module_specific_stress_test.py
```

---

#### `demo_stress_test.py` - 演示测试
**功能**:
- 消息格式转换性能测试
- 并发处理能力测试
- 内存队列性能测试
- 限流器准确性测试
- 数据序列化性能测试
- 过滤器性能测试

**特点**:
- ✨ **无需后端服务**即可运行
- 📊 展示测试框架功能
- 🚀 快速验证测试环境
- 📝 生成示例报告

**运行方式**:
```bash
python3 demo_stress_test.py
```

**适用场景**:
- 验证测试框架是否正常工作
- 了解测试输出格式
- 快速检查Python环境

---

### 2. 运行脚本

#### `run_all_stress_tests.sh` - Linux/macOS自动化运行
**功能**:
- 自动检查环境（Python/Redis/后端服务）
- 自动安装缺失的依赖包
- 依次运行所有压力测试
- 自动收集和整理测试报告
- 彩色输出，清晰显示测试进度

**运行方式**:
```bash
chmod +x run_all_stress_tests.sh
./run_all_stress_tests.sh
```

**输出**:
- 测试日志：`test_results/*.log`
- JSON报告：`test_results/*.json`
- Markdown报告：`test_results/*.md`

---

#### `run_all_stress_tests.bat` - Windows自动化运行
**功能**: 与Linux版本相同

**运行方式**:
```cmd
run_all_stress_tests.bat
```

---

### 3. 工具脚本

#### `generate_test_summary.py` - 测试报告汇总生成器
**功能**:
- 读取所有测试结果JSON文件
- 汇总生成完整测试报告
- 提取关键性能指标
- 生成优化建议

**运行方式**:
```bash
python3 generate_test_summary.py
```

**生成报告**:
- `test_results/完整测试报告汇总.md` - Markdown格式
- `test_results/测试结果简报.txt` - 文本格式

---

### 4. 文档

#### `压力测试说明.md` - 完整使用指南
**内容**:
- 📋 测试概览
- 🚀 快速开始指南
- 📊 测试覆盖范围详解
- 📈 性能基准参考
- 📄 测试报告说明
- 🔧 自定义测试方法
- 🐛 故障排查指南
- 🎯 最佳实践
- 📚 参考资料

**适用对象**: 所有用户

---

#### `压力测试完成总结.md` - 项目完成总结
**内容**:
- 项目概述
- 完成的工作清单
- 测试覆盖范围
- 演示测试结果
- 生成的文件列表
- 使用指南
- 性能优化建议
- 注意事项
- 下一步计划

**适用对象**: 项目管理者、开发者

---

#### `压力测试文件清单.md` - 本文件
**内容**:
- 文件结构
- 文件说明
- 快速参考

**适用对象**: 快速查阅

---

## 🚀 快速开始

### 1. 运行演示测试（推荐新手）
```bash
python3 demo_stress_test.py
```
⏱️ 耗时: ~5秒  
📊 无需后端服务

### 2. 运行完整测试
```bash
# 1. 启动后端服务
cd backend && python -m app.main

# 2. 启动Redis
redis-server

# 3. 运行测试
./run_all_stress_tests.sh  # Linux/macOS
# 或
run_all_stress_tests.bat   # Windows
```
⏱️ 耗时: ~5-10分钟  
📊 需要完整环境

### 3. 查看报告
```bash
cd test_results
ls -lh
cat 演示压力测试报告.md
```

---

## 📊 测试数据示例

基于演示测试的实际结果：

| 测试项 | 性能 |
|--------|------|
| 消息格式转换 | ~970,000 ops/s |
| 并发处理 | ~4,849 msg/s (200并发) |
| 队列入队 | ~695,000 msg/s |
| 队列出队 | ~892,000 msg/s |
| JSON序列化 | ~67,587 ops/s |
| 过滤器 | ~353,631 msg/s |
| 限流器准确度 | 99.85% |

---

## 🔧 自定义配置

### 修改测试参数

编辑 `comprehensive_stress_test.py`:
```python
COMPREHENSIVE_TEST_CONFIG = {
    "concurrent_levels": [1, 5, 10],        # 修改并发级别
    "message_batch_sizes": [10, 50, 100],   # 修改批量大小
    # ... 其他配置
}
```

### 添加新测试

在任一测试脚本中添加测试方法:
```python
async def test_custom_feature(self):
    """自定义测试"""
    # 测试代码
    pass
```

---

## 📈 性能基准

### 推荐配置下的性能目标

| 指标 | 目标值 |
|------|--------|
| API QPS (并发100) | >500 |
| 格式转换 | >10,000 ops/s |
| Redis队列 | >5,000 msg/s |
| 数据库查询 | >1,000 QPS |
| 端到端延迟 | <50ms |

---

## 🐛 故障排查

### 常见问题

1. **后端服务未运行**
   ```
   错误: Connection refused
   解决: cd backend && python -m app.main
   ```

2. **Redis连接失败**
   ```
   错误: Error connecting to Redis
   解决: redis-server
   ```

3. **依赖包缺失**
   ```
   错误: ModuleNotFoundError
   解决: pip install aiohttp redis pillow
   ```

4. **数据库文件不存在**
   ```
   错误: Database file not found
   解决: 首次运行后端会自动创建
   ```

---

## 📞 获取帮助

1. 查看详细文档: `压力测试说明.md`
2. 查看测试日志: `test_results/*.log`
3. 运行演示测试验证环境: `python3 demo_stress_test.py`

---

## ✅ 检查清单

使用前请确认:

- [ ] Python 3.8+ 已安装
- [ ] 依赖包已安装 (`pip install -r backend/requirements.txt`)
- [ ] 后端服务可正常启动（完整测试需要）
- [ ] Redis服务可正常启动（完整测试需要）
- [ ] 有足够的磁盘空间（测试报告+日志约100MB）

---

**最后更新**: 2025-10-22  
**版本**: 1.0.0  
**状态**: ✅ 可用
