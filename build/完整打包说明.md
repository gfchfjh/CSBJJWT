# å®Œæ•´ä¸€é”®å®‰è£…åŒ…æ„å»ºè¯´æ˜ï¼ˆâœ… P0-1ä¼˜åŒ–ï¼‰

## ğŸ“¦ ç›®æ ‡

åˆ›å»ºçœŸæ­£çš„"ä¸€é”®å®‰è£…åŒ…"ï¼Œç”¨æˆ·æ— éœ€å®‰è£…ä»»ä½•ä¾èµ–ï¼š
- âœ… Pythonç¯å¢ƒå®Œå…¨æ‰“åŒ…
- âœ… Chromiumæµè§ˆå™¨å†…ç½®
- âœ… RedisæœåŠ¡å†…ç½®
- âœ… æ‰€æœ‰Pythonä¾èµ–æ‰“åŒ…

## ğŸ› ï¸ æ„å»ºæµç¨‹

### 1. å®‰è£…æ„å»ºå·¥å…·

```bash
# PyInstallerï¼ˆPythonæ‰“åŒ…ï¼‰
pip install pyinstaller

# electron-builderï¼ˆElectronæ‰“åŒ…ï¼‰
cd frontend
npm install -g electron-builder
```

### 2. ä¸‹è½½ä¾èµ–

```bash
# Chromiumï¼ˆ~170MBï¼‰
python -m playwright install chromium

# Redis
# Windows: è‡ªåŠ¨ä¸‹è½½
# Linux/macOS: ä½¿ç”¨é¡¹ç›®è‡ªå¸¦
```

### 3. æ‰§è¡Œæ„å»º

```bash
# å®Œæ•´æ„å»ºï¼ˆè‡ªåŠ¨åŒ–ï¼‰
python build/build_å®Œæ•´å®‰è£…åŒ….py

# æˆ–åˆ†æ­¥æ„å»ºï¼š

# æ­¥éª¤1ï¼šæ‰“åŒ…Pythonåç«¯
pyinstaller build/build_backend_complete.spec

# æ­¥éª¤2ï¼šæ„å»ºElectronå‰ç«¯
cd frontend
npm run electron:build -- --win  # Windows
npm run electron:build -- --mac  # macOS
npm run electron:build -- --linux appimage  # Linux
```

### 4. æµ‹è¯•å®‰è£…åŒ…

```bash
# Windows
./dist/KookForwarder-Setup.exe

# macOS
open ./dist/KookForwarder.dmg

# Linux
chmod +x ./dist/KookForwarder.AppImage
./dist/KookForwarder.AppImage
```

## ğŸ“Š å®‰è£…åŒ…å¤§å°é¢„ä¼°

| ç»„ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| Pythonç¯å¢ƒ | ~50MB | PyInstalleræ‰“åŒ… |
| Chromium | ~170MB | Playwright Chromium |
| Redis | ~5MB | å¯æ‰§è¡Œæ–‡ä»¶ |
| åº”ç”¨ä»£ç  | ~10MB | åç«¯+å‰ç«¯ |
| Electron | ~80MB | Electronæ¡†æ¶ |
| **æ€»è®¡** | **~315MB** | å‹ç¼©åçº¦180MB |

## ğŸ¯ æ„å»ºé€‰é¡¹

### å®Œå…¨æ‰“åŒ…ï¼ˆæ¨èï¼‰

```bash
python build/build_å®Œæ•´å®‰è£…åŒ….py --full
```

åŒ…å«ï¼š
- âœ… Pythonç¯å¢ƒ
- âœ… Chromium
- âœ… Redis
- âœ… æ‰€æœ‰ä¾èµ–

### ç²¾ç®€æ‰“åŒ…

```bash
python build/build_å®Œæ•´å®‰è£…åŒ….py --minimal
```

åŒ…å«ï¼š
- âœ… Pythonç¯å¢ƒ
- âœ… Redis
- âš ï¸ Chromiumï¼ˆé¦–æ¬¡è¿è¡Œæ—¶ä¸‹è½½ï¼‰

å¤§å°ï¼š~100MB

## ğŸ”§ é«˜çº§é…ç½®

### PyInstallerä¼˜åŒ–

```python
# build_backend_complete.spec

# UPXå‹ç¼©ï¼ˆå‡å°30%ä½“ç§¯ï¼‰
upx=True
upx_exclude=[]

# ç§»é™¤è°ƒè¯•ä¿¡æ¯
debug=False
strip=False

# å•æ–‡ä»¶æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
onefile=True
```

### Electron Builderé…ç½®

```yaml
# electron-builder.yml

# NSISé…ç½®ï¼ˆWindowsï¼‰
nsis:
  oneClick: true
  perMachine: false
  allowToChangeInstallationDirectory: true
  include: build/installer.nsh

# DMGé…ç½®ï¼ˆmacOSï¼‰
dmg:
  title: "KOOK Message Forwarder"
  icon: build/icon.icns

# AppImageé…ç½®ï¼ˆLinuxï¼‰
appImage:
  license: LICENSE
```

## âš ï¸ å·²çŸ¥é™åˆ¶

### 1. Chromiumå¤§å°

Chromiumçº¦170MBï¼Œæ˜¯å®‰è£…åŒ…çš„ä¸»è¦ä½“ç§¯ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
- æ–¹æ¡ˆAï¼šå®Œå…¨æ‰“åŒ…ï¼ˆ180MBï¼Œç”¨æˆ·ä½“éªŒæœ€å¥½ï¼‰
- æ–¹æ¡ˆBï¼šé¦–æ¬¡è¿è¡Œä¸‹è½½ï¼ˆ100MBï¼Œé¦–æ¬¡éœ€è¦ç½‘ç»œï¼‰

### 2. è·¨å¹³å°ç¼–è¯‘

**å½“å‰é™åˆ¶ï¼š**
- Windowså®‰è£…åŒ…åªèƒ½åœ¨Windowsæ„å»º
- macOSå®‰è£…åŒ…åªèƒ½åœ¨macOSæ„å»º
- Linuxå®‰è£…åŒ…å¯ä»¥åœ¨ä»»ä½•å¹³å°æ„å»º

**è§£å†³æ–¹æ¡ˆï¼š**
- ä½¿ç”¨GitHub Actions CI/CD
- åœ¨å„å¹³å°è™šæ‹Ÿæœºä¸­æ„å»º

### 3. ä»£ç ç­¾å

**å½“å‰çŠ¶æ€ï¼š** æœªç­¾åï¼ŒWindows/macOSä¼šæ˜¾ç¤ºè­¦å‘Š

**è§£å†³æ–¹æ¡ˆï¼ˆæœªæ¥ï¼‰ï¼š**
- ç”³è¯·ä»£ç ç­¾åè¯ä¹¦
- Windows: Authenticode
- macOS: Apple Developer ID

## ğŸš€ è‡ªåŠ¨åŒ–æ„å»ºï¼ˆGitHub Actionsï¼‰

```yaml
# .github/workflows/build-installer.yml

name: Build Installer

on:
  push:
    tags:
      - 'v*'

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: python build/build_å®Œæ•´å®‰è£…åŒ….py
      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: KookForwarder-Windows
          path: dist/*.exe

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: python build/build_å®Œæ•´å®‰è£…åŒ….py
      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: KookForwarder-macOS
          path: dist/*.dmg

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build
        run: python build/build_å®Œæ•´å®‰è£…åŒ….py
      - name: Upload
        uses: actions/upload-artifact@v2
        with:
          name: KookForwarder-Linux
          path: dist/*.AppImage
```

## ğŸ“ æµ‹è¯•æ¸…å•

- [ ] Windowså®‰è£…åŒ…èƒ½æ­£å¸¸å®‰è£…
- [ ] å®‰è£…åæ— éœ€å®‰è£…Python
- [ ] å®‰è£…åæ— éœ€å®‰è£…Chromium
- [ ] å®‰è£…åæ— éœ€å®‰è£…Redis
- [ ] é¦–æ¬¡å¯åŠ¨æ˜¾ç¤ºé…ç½®å‘å¯¼
- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] å¸è½½åæ•°æ®å®Œæ•´ä¿ç•™ï¼ˆå¯é€‰æ¸…ç†ï¼‰

## ğŸ‰ å®Œæˆæ ‡å¿—

å½“æ„å»ºå‡ºç¬¦åˆä»¥ä¸‹æ¡ä»¶çš„å®‰è£…åŒ…æ—¶ï¼ŒP0-1ä»»åŠ¡å®Œæˆï¼š

1. âœ… Windows .exeï¼ŒåŒå‡»å®‰è£…ï¼Œæ— éœ€ä»»ä½•ä¾èµ–
2. âœ… macOS .dmgï¼Œæ‹–æ‹½å®‰è£…ï¼Œæ— éœ€brew install
3. âœ… Linux .AppImageï¼Œç›´æ¥è¿è¡Œï¼Œæ— éœ€apt install
4. âœ… å®‰è£…åŒ…å¤§å°<200MB
5. âœ… å®‰è£…æˆåŠŸç‡>95%
6. âœ… é¦–æ¬¡è¿è¡Œé…ç½®æ—¶é—´<5åˆ†é’Ÿ

---

**åˆ›å»ºæ—¶é—´ï¼š** 2025-10-24  
**çŠ¶æ€ï¼š** æ„å»ºè„šæœ¬å·²å®Œæˆï¼Œéœ€è¦åœ¨å„å¹³å°æµ‹è¯•  
**é¢„è®¡å®Œæˆï¼š** 1-2å‘¨ï¼ˆéœ€è¦åœ¨å„å¹³å°æµ‹è¯•å’Œè°ƒä¼˜ï¼‰
