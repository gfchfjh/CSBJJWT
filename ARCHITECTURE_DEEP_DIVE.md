# KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - æ·±åº¦æ¶æ„æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**ç³»ç»Ÿç‰ˆæœ¬**: v18.0.3  
**æ›´æ–°æ—¥æœŸ**: 2025-11-06

---

## ğŸ“ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1. ä¸‰å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¡¨ç¤ºå±‚ (Presentation)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Electron   â”‚  â”‚  Vue 3 å‰ç«¯  â”‚  â”‚ Chromeæ‰©å±•   â”‚     â”‚
â”‚  â”‚ ä¸»è¿›ç¨‹     â”‚  â”‚  (ç”¨æˆ·ç•Œé¢)  â”‚  â”‚  (Cookie)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸šåŠ¡é€»è¾‘å±‚ (Business)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  APIå±‚   â”‚ â”‚ å¤„ç†å™¨   â”‚ â”‚ è½¬å‘å™¨   â”‚ â”‚ æ’ä»¶ç³»ç»Ÿ â”‚   â”‚
â”‚  â”‚ (150+ç«¯ç‚¹â”‚ â”‚ (æ¶ˆæ¯)   â”‚ â”‚ (5å¹³å°)  â”‚ â”‚ (æ‰©å±•)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å±‚ (Data)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ SQLite   â”‚ â”‚  Redis   â”‚ â”‚  KOOK    â”‚ â”‚  æ–‡ä»¶    â”‚   â”‚
â”‚  â”‚ (é…ç½®)   â”‚ â”‚ (é˜Ÿåˆ—)   â”‚ â”‚ (æ¶ˆæ¯)   â”‚ â”‚ (å›¾ç‰‡)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. è¿›ç¨‹æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Electron ä¸»è¿›ç¨‹ (Node.js)                â”‚
â”‚  - çª—å£ç®¡ç†                                         â”‚
â”‚  - æ‰˜ç›˜å›¾æ ‡                                         â”‚
â”‚  - IPCé€šä¿¡                                          â”‚
â”‚  - å­è¿›ç¨‹ç®¡ç†                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ Redis   â”‚        â”‚ Backend â”‚
    â”‚ Process â”‚        â”‚ Process â”‚
    â”‚ (6379)  â”‚        â”‚ (9527)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
            â”‚ Playwright   â”‚ â”‚  Worker     â”‚
            â”‚ Browser      â”‚ â”‚  Tasks      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ æ•°æ®æµåˆ†æ

### 1. æ¶ˆæ¯å¤„ç†å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ KOOKæœåŠ¡å™¨â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ WebSocket
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. æ¶ˆæ¯é‡‡é›† (KookScraper)                            â”‚
â”‚    - Playwrightæµè§ˆå™¨                                 â”‚
â”‚    - WebSocketç›‘å¬                                    â”‚
â”‚    - æ¶ˆæ¯è§£æ                                         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¶ˆæ¯å…¥é˜Ÿ (RedisQueue)                             â”‚
â”‚    - åºåˆ—åŒ– (JSON)                                    â”‚
â”‚    - Redis RPUSH                                      â”‚
â”‚    - æœ¬åœ°Fallback (å¯é€‰)                              â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ¶ˆæ¯å‡ºé˜Ÿ (MessageWorker)                          â”‚
â”‚    - Redis BLPOP (æ‰¹é‡10æ¡)                           â”‚
â”‚    - ååºåˆ—åŒ–                                         â”‚
â”‚    - ä»»åŠ¡åˆ†å‘                                         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ¶ˆæ¯å¤„ç† (MessageProcessor)                       â”‚
â”‚    â”œâ”€ å»é‡æ£€æŸ¥ (Redis Hash)                          â”‚
â”‚    â”œâ”€ è¿‡æ»¤è§„åˆ™ (FilterEngine)                        â”‚
â”‚    â”œâ”€ æ ¼å¼è½¬æ¢ (Formatter)                           â”‚
â”‚    â”œâ”€ åª’ä½“å¤„ç† (ImageProcessor/VideoProcessor)      â”‚
â”‚    â””â”€ æ’ä»¶é’©å­ (PluginSystem)                        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ˜ å°„æŸ¥è¯¢ (Database)                               â”‚
â”‚    - æŸ¥è¯¢channel_mappingsè¡¨                          â”‚
â”‚    - è·å–ç›®æ ‡å¹³å°å’ŒBoté…ç½®                           â”‚
â”‚    - è¿”å›æ˜ å°„åˆ—è¡¨                                    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ¶ˆæ¯è½¬å‘ (Forwarders)                             â”‚
â”‚    â”œâ”€ Discord (DiscordForwarder)                     â”‚
â”‚    â”œâ”€ Telegram (TelegramForwarder)                   â”‚
â”‚    â”œâ”€ é£ä¹¦ (FeishuForwarder)                         â”‚
â”‚    â”œâ”€ ä¼ä¸šå¾®ä¿¡ (WeChatWorkForwarder)                 â”‚
â”‚    â””â”€ é’‰é’‰ (DingTalkForwarder)                       â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ç»“æœå¤„ç†                                          â”‚
â”‚    â”œâ”€ æˆåŠŸ: è®°å½•æ—¥å¿— (message_logs)                  â”‚
â”‚    â”œâ”€ å¤±è´¥: åŠ å…¥é‡è¯•é˜Ÿåˆ— (failed_messages)           â”‚
â”‚    â””â”€ æŒ‡æ ‡: æ›´æ–°ç»Ÿè®¡ (Metrics)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç”¨æˆ·æ“ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ“ä½œ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯æ“ä½œ (Vue 3)                            â”‚
â”‚  - è¡¨å•è¾“å…¥                                  â”‚
â”‚  - æŒ‰é’®ç‚¹å‡»                                  â”‚
â”‚  - é¡µé¢å¯¼èˆª                                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ HTTP Request
      â”‚ (axios)
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ APIè·¯ç”± (FastAPI)                           â”‚
â”‚  - è®¤è¯æ£€æŸ¥                                  â”‚
â”‚  - å‚æ•°éªŒè¯                                  â”‚
â”‚  - è·¯ç”±åˆ†å‘                                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡é€»è¾‘                                    â”‚
â”‚  - æ•°æ®å¤„ç†                                  â”‚
â”‚  - ä¸šåŠ¡è§„åˆ™                                  â”‚
â”‚  - å¤–éƒ¨è°ƒç”¨                                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æŒä¹…åŒ–                                  â”‚
â”‚  - SQLiteå†™å…¥                                â”‚
â”‚  - Redisç¼“å­˜                                 â”‚
â”‚  - æ–‡ä»¶å­˜å‚¨                                  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ HTTP Response
      â”‚ (JSON)
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰ç«¯å“åº”                                    â”‚
â”‚  - æ•°æ®æ›´æ–°                                  â”‚
â”‚  - UIåˆ·æ–°                                    â”‚
â”‚  - æç¤ºåé¦ˆ                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹è¯¦è§£

### 1. æ ¸å¿ƒæ•°æ®è¡¨

#### accounts (è´¦å·è¡¨)

```sql
CREATE TABLE accounts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    email TEXT NOT NULL UNIQUE,          -- KOOKè´¦å·é‚®ç®±
    password_encrypted TEXT,              -- åŠ å¯†åçš„å¯†ç 
    cookie TEXT,                         -- Cookie JSON
    status TEXT DEFAULT 'offline',       -- online/offline/error
    last_active TIMESTAMP,               -- æœ€åæ´»è·ƒæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•
CREATE INDEX idx_accounts_email ON accounts(email);
CREATE INDEX idx_accounts_status ON accounts(status);
```

**æ•°æ®å…³ç³»**: 1ä¸ªè´¦å· â†’ Nä¸ªScraperå®ä¾‹

#### bot_configs (æœºå™¨äººé…ç½®è¡¨)

```sql
CREATE TABLE bot_configs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    platform TEXT NOT NULL,              -- discord/telegram/feishu/wechatwork/dingtalk
    name TEXT NOT NULL,                  -- Botåç§°
    config TEXT NOT NULL,                -- é…ç½®JSON
    status TEXT DEFAULT 'active',        -- active/inactive
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**é…ç½®JSONç»“æ„**:
```json
{
  "discord": {
    "webhook_url": "https://discord.com/api/webhooks/...",
    "username": "KOOKè½¬å‘",
    "avatar_url": "..."
  },
  "telegram": {
    "bot_token": "123456:ABC-DEF...",
    "chat_id": "-100123456789"
  },
  "feishu": {
    "app_id": "cli_xxx",
    "app_secret": "xxx",
    "webhook_url": "..."
  }
}
```

#### channel_mappings (é¢‘é“æ˜ å°„è¡¨)

```sql
CREATE TABLE channel_mappings (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    kook_server_id TEXT NOT NULL,        -- KOOKæœåŠ¡å™¨ID
    kook_channel_id TEXT NOT NULL,       -- KOOKé¢‘é“ID
    kook_channel_name TEXT NOT NULL,     -- KOOKé¢‘é“åç§°
    target_platform TEXT NOT NULL,       -- ç›®æ ‡å¹³å°
    target_bot_id INTEGER NOT NULL,      -- ç›®æ ‡Bot ID
    target_channel_id TEXT NOT NULL,     -- ç›®æ ‡é¢‘é“ID
    enabled INTEGER DEFAULT 1,           -- å¯ç”¨çŠ¶æ€
    FOREIGN KEY (target_bot_id) REFERENCES bot_configs(id)
);

-- æ€§èƒ½ç´¢å¼•
CREATE INDEX idx_channel_mappings_kook_channel 
ON channel_mappings(kook_channel_id, enabled);

CREATE INDEX idx_mapping_bot_platform 
ON channel_mappings(target_bot_id, target_platform);
```

**æ˜ å°„æŸ¥è¯¢ä¼˜åŒ–**:
```python
# å•é¢‘é“æŸ¥è¯¢ (O(1))
mappings = db.execute(
    "SELECT * FROM channel_mappings WHERE kook_channel_id = ? AND enabled = 1",
    (channel_id,)
).fetchall()
```

#### message_logs (æ¶ˆæ¯æ—¥å¿—è¡¨)

```sql
CREATE TABLE message_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    kook_message_id TEXT NOT NULL UNIQUE,  -- KOOKæ¶ˆæ¯ID
    kook_channel_id TEXT NOT NULL,         -- KOOKé¢‘é“ID
    content TEXT,                          -- æ¶ˆæ¯å†…å®¹
    message_type TEXT,                     -- text/image/video/file
    sender_name TEXT,                      -- å‘é€è€…
    target_platform TEXT,                  -- ç›®æ ‡å¹³å°
    target_channel TEXT,                   -- ç›®æ ‡é¢‘é“
    status TEXT,                           -- success/failed/pending
    error_message TEXT,                    -- é”™è¯¯ä¿¡æ¯
    latency_ms INTEGER,                    -- å»¶è¿Ÿ(æ¯«ç§’)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æŸ¥è¯¢ç´¢å¼•
CREATE INDEX idx_message_logs_kook_id ON message_logs(kook_message_id);
CREATE INDEX idx_message_logs_status ON message_logs(status);
CREATE INDEX idx_message_logs_created ON message_logs(created_at DESC);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_logs_channel_status 
ON message_logs(kook_channel_id, status, created_at DESC);
```

**æŸ¥è¯¢æ€§èƒ½**:
- å•æ¶ˆæ¯æŸ¥è¯¢: O(1) (å”¯ä¸€ç´¢å¼•)
- çŠ¶æ€æŸ¥è¯¢: O(log n) (B-Treeç´¢å¼•)
- æ—¶é—´èŒƒå›´æŸ¥è¯¢: O(log n + k)

### 2. Redisæ•°æ®ç»“æ„

#### æ¶ˆæ¯é˜Ÿåˆ—

```redis
# ä¸»é˜Ÿåˆ—
LIST kook_messages
  - JSONåºåˆ—åŒ–çš„æ¶ˆæ¯å¯¹è±¡
  - RPUSHå…¥é˜Ÿ, BLPOPå‡ºé˜Ÿ
  - æ”¯æŒæ‰¹é‡å‡ºé˜Ÿ

# å¤±è´¥é‡è¯•é˜Ÿåˆ—
LIST retry_messages
  - å¤±è´¥æ¶ˆæ¯æš‚å­˜
  - æŒ‡æ•°é€€é¿é‡è¯•

# æ­»ä¿¡é˜Ÿåˆ—
LIST dead_letter_messages
  - å¤šæ¬¡å¤±è´¥çš„æ¶ˆæ¯
  - äººå·¥ä»‹å…¥å¤„ç†
```

#### æ¶ˆæ¯å»é‡

```redis
# å»é‡å“ˆå¸Œè¡¨
HASH message_dedup
  key: kook_message_id
  value: timestamp
  TTL: 86400ç§’ (24å°æ—¶)

# å¿«é€Ÿåˆ¤æ–­
EXISTS message_dedup:{message_id}
```

#### é€Ÿç‡é™åˆ¶

```redis
# Token Bucketç®—æ³•
STRING rate_limit:discord:{webhook_id}
  value: current_tokens
  TTL: åŠ¨æ€è®¡ç®—

# Sliding Windowç®—æ³•
ZSET rate_limit:telegram:{bot_id}
  member: timestamp
  score: timestamp
```

---

## ğŸ”Œ APIæ¥å£è¯¦è§£

### 1. è®¤è¯ç›¸å…³API

#### POST /api/auth/login
```python
# ç™»å½•è®¤è¯
Request:
{
  "password": "ç”¨æˆ·å¯†ç "
}

Response:
{
  "token": "JWT Token",
  "expires_in": 86400,
  "user_info": {...}
}
```

#### POST /api/auth/set-password
```python
# è®¾ç½®ä¸»å¯†ç  (é¦–æ¬¡è¿è¡Œ)
Request:
{
  "password": "æ–°å¯†ç ",
  "confirm_password": "ç¡®è®¤å¯†ç "
}

Response:
{
  "success": true,
  "message": "å¯†ç è®¾ç½®æˆåŠŸ"
}
```

### 2. è´¦å·ç®¡ç†API

#### GET /api/accounts
```python
# è·å–è´¦å·åˆ—è¡¨
Response:
[
  {
    "id": 1,
    "email": "user@example.com",
    "status": "online",
    "last_active": "2025-11-06T10:30:00",
    "created_at": "2025-11-01T08:00:00"
  }
]
```

#### POST /api/accounts
```python
# æ·»åŠ è´¦å·
Request:
{
  "email": "user@example.com",
  "password": "å¯†ç " (å¯é€‰),
  "cookie": "Cookie JSON" (å¯é€‰)
}

Response:
{
  "id": 1,
  "email": "user@example.com",
  "status": "offline"
}
```

#### POST /api/accounts/{id}/start
```python
# å¯åŠ¨è´¦å·ç›‘å¬
Response:
{
  "success": true,
  "scraper_id": "scraper_1",
  "status": "starting"
}
```

### 3. æœºå™¨äººé…ç½®API

#### GET /api/bots
```python
# è·å–Botåˆ—è¡¨
Response:
[
  {
    "id": 1,
    "platform": "discord",
    "name": "Discord Bot 1",
    "config": {
      "webhook_url": "https://..."
    },
    "status": "active"
  }
]
```

#### POST /api/bots
```python
# æ·»åŠ Boté…ç½®
Request:
{
  "platform": "discord",
  "name": "My Discord Bot",
  "config": {
    "webhook_url": "https://discord.com/api/webhooks/..."
  }
}
```

#### POST /api/bots/{id}/test
```python
# æµ‹è¯•Botè¿æ¥
Response:
{
  "success": true,
  "message": "æµ‹è¯•æ¶ˆæ¯å‘é€æˆåŠŸ",
  "latency_ms": 230
}
```

### 4. é¢‘é“æ˜ å°„API

#### GET /api/mappings
```python
# è·å–æ˜ å°„åˆ—è¡¨
Response:
[
  {
    "id": 1,
    "kook_server_id": "123456",
    "kook_channel_id": "789012",
    "kook_channel_name": "#å…¬å‘Š",
    "target_platform": "discord",
    "target_bot_id": 1,
    "target_channel_id": "987654321",
    "enabled": true
  }
]
```

#### POST /api/mappings
```python
# åˆ›å»ºæ˜ å°„
Request:
{
  "kook_server_id": "123456",
  "kook_channel_id": "789012",
  "kook_channel_name": "#å…¬å‘Š",
  "target_platform": "discord",
  "target_bot_id": 1,
  "target_channel_id": "987654321"
}
```

#### POST /api/mappings/batch
```python
# æ‰¹é‡åˆ›å»ºæ˜ å°„
Request:
{
  "mappings": [
    {...},
    {...}
  ]
}

Response:
{
  "success": 15,
  "failed": 2,
  "total": 17
}
```

### 5. å®æ—¶æ—¥å¿—API

#### GET /api/logs
```python
# è·å–æ¶ˆæ¯æ—¥å¿—
Query Parameters:
- limit: 100 (é»˜è®¤)
- status: success/failed
- start_time: ISOæ—¶é—´
- end_time: ISOæ—¶é—´

Response:
[
  {
    "id": 1,
    "kook_message_id": "msg_123",
    "content": "æµ‹è¯•æ¶ˆæ¯",
    "message_type": "text",
    "status": "success",
    "latency_ms": 230,
    "created_at": "2025-11-06T10:30:00"
  }
]
```

#### WebSocket /api/ws/logs
```python
# å®æ—¶æ—¥å¿—æ¨é€
Connect: ws://localhost:9527/api/ws/logs

Receive:
{
  "type": "log",
  "data": {
    "message_id": "msg_123",
    "status": "success",
    "content": "...",
    "timestamp": "2025-11-06T10:30:00"
  }
}
```

### 6. ç³»ç»ŸçŠ¶æ€API

#### GET /api/system/stats
```python
# è·å–ç³»ç»Ÿç»Ÿè®¡
Response:
{
  "accounts": {
    "total": 3,
    "online": 2,
    "offline": 1
  },
  "messages": {
    "total": 12345,
    "success": 12100,
    "failed": 245,
    "success_rate": 0.98
  },
  "queue": {
    "size": 10,
    "processing": 2
  },
  "uptime": 86400
}
```

#### GET /api/health
```python
# å¥åº·æ£€æŸ¥
Response:
{
  "status": "healthy",
  "components": {
    "redis": "ok",
    "database": "ok",
    "scrapers": "ok"
  },
  "timestamp": "2025-11-06T10:30:00"
}
```

---

## ğŸ” å®‰å…¨æ¶æ„

### 1. è®¤è¯æˆæƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          è®¤è¯æµç¨‹                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç”¨æˆ·è¾“å…¥å¯†ç      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ bcryptéªŒè¯      â”‚
    â”‚ (æ•°æ®åº“å“ˆå¸Œ)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç”ŸæˆJWT Token   â”‚
    â”‚ (24å°æ—¶æœ‰æ•ˆ)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ è¿”å›Token       â”‚
    â”‚ (localStorage)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å¯†ç å®‰å…¨

```python
# å¯†ç å¤æ‚åº¦è¦æ±‚
PASSWORD_REQUIREMENTS = {
    "min_length": 8,
    "require_uppercase": True,
    "require_lowercase": True,
    "require_digit": True,
    "require_special": True,
    "forbidden_patterns": [
        # ç¦æ­¢å¸¸è§å¼±å¯†ç 
        "12345678", "password", "admin123", ...
    ],
    "forbidden_sequences": [
        # ç¦æ­¢è¿ç»­å­—ç¬¦
        "abc", "123", "aaa", ...
    ]
}

# å¯†ç å­˜å‚¨
def hash_password(password: str) -> str:
    salt = bcrypt.gensalt(rounds=12)
    return bcrypt.hashpw(password.encode(), salt)

# å¯†ç éªŒè¯
def verify_password(password: str, hashed: str) -> bool:
    return bcrypt.checkpw(password.encode(), hashed.encode())
```

### 3. APIè®¤è¯

```python
# ä¸­é—´ä»¶è®¤è¯
class APIAuthMiddleware:
    async def __call__(self, request: Request, call_next):
        # å…¬å¼€è·¯å¾„è·³è¿‡
        if request.url.path in PUBLIC_PATHS:
            return await call_next(request)
        
        # æ£€æŸ¥Token
        token = request.headers.get('X-API-Token')
        if not token or not verify_token(token):
            return JSONResponse(
                status_code=401,
                content={"error": "Unauthorized"}
            )
        
        return await call_next(request)
```

### 4. æ•°æ®åŠ å¯†

```python
# CookieåŠ å¯†å­˜å‚¨
from cryptography.fernet import Fernet

class CookieEncryption:
    def __init__(self, key: str):
        self.cipher = Fernet(key.encode())
    
    def encrypt(self, cookie: dict) -> str:
        """åŠ å¯†Cookie"""
        cookie_json = json.dumps(cookie)
        encrypted = self.cipher.encrypt(cookie_json.encode())
        return encrypted.decode()
    
    def decrypt(self, encrypted: str) -> dict:
        """è§£å¯†Cookie"""
        decrypted = self.cipher.decrypt(encrypted.encode())
        return json.loads(decrypted.decode())
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ•°æ®åº“ä¼˜åŒ–

```python
# 1. æ‰¹é‡æ’å…¥
def batch_insert_messages(messages: List[dict]):
    with db.get_connection() as conn:
        cursor = conn.cursor()
        cursor.executemany("""
            INSERT INTO message_logs (...)
            VALUES (?, ?, ?, ...)
        """, [(msg['id'], msg['content'], ...) for msg in messages])

# 2. ç´¢å¼•ä¼˜åŒ–
# å¤åˆç´¢å¼•: é¢‘é“ID + çŠ¶æ€ + æ—¶é—´
CREATE INDEX idx_logs_channel_status 
ON message_logs(kook_channel_id, status, created_at DESC);

# 3. æŸ¥è¯¢ä¼˜åŒ–
# ä½¿ç”¨ç´¢å¼•è¦†ç›–
SELECT id, status, created_at 
FROM message_logs 
WHERE kook_channel_id = ? AND status = 'success'
ORDER BY created_at DESC
LIMIT 100;
```

### 2. Redisä¼˜åŒ–

```python
# 1. æ‰¹é‡å‡ºé˜Ÿ (+30%åå)
async def dequeue_batch(count: int = 10):
    messages = []
    
    # é¦–æ¡é˜»å¡ç­‰å¾…
    first = await redis.blpop('kook_messages', timeout=5)
    if first:
        messages.append(json.loads(first[1]))
        
        # åç»­éé˜»å¡å¿«é€Ÿå–å‡º
        for _ in range(count - 1):
            msg = await redis.lpop('kook_messages')
            if msg:
                messages.append(json.loads(msg))
            else:
                break
    
    return messages

# 2. Pipelineæ‰¹é‡æ“ä½œ
pipe = redis.pipeline()
for key, value in items:
    pipe.set(key, value)
await pipe.execute()

# 3. è¿æ¥æ± 
redis_pool = aioredis.ConnectionPool(
    host='localhost',
    port=6379,
    max_connections=20,
    decode_responses=True
)
```

### 3. å¹¶å‘ä¼˜åŒ–

```python
# 1. asyncioå¹¶å‘å¤„ç†
async def process_messages_concurrent(messages: List[dict]):
    tasks = [process_message(msg) for msg in messages]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    return results

# 2. é™åˆ¶å¹¶å‘æ•°
from asyncio import Semaphore

semaphore = Semaphore(10)  # æœ€å¤š10ä¸ªå¹¶å‘

async def limited_process(message: dict):
    async with semaphore:
        return await process_message(message)

# 3. è¿æ¥æ± 
class DiscordForwarderPool:
    def __init__(self, webhook_urls: List[str]):
        self.forwarders = [
            DiscordForwarder() 
            for _ in webhook_urls
        ]
        self.current_index = 0
    
    def get_next(self) -> DiscordForwarder:
        """è½®è¯¢è·å–è½¬å‘å™¨"""
        forwarder = self.forwarders[self.current_index]
        self.current_index = (self.current_index + 1) % len(self.forwarders)
        return forwarder
```

### 4. ç¼“å­˜ç­–ç•¥

```python
# 1. æ˜ å°„ç¼“å­˜
class MappingCache:
    def __init__(self, ttl: int = 300):
        self.cache = {}
        self.ttl = ttl
    
    async def get_mappings(self, channel_id: str):
        # æ£€æŸ¥ç¼“å­˜
        if channel_id in self.cache:
            cached, timestamp = self.cache[channel_id]
            if time.time() - timestamp < self.ttl:
                return cached
        
        # æŸ¥è¯¢æ•°æ®åº“
        mappings = db.get_channel_mappings(channel_id)
        self.cache[channel_id] = (mappings, time.time())
        return mappings

# 2. Boté…ç½®ç¼“å­˜
@lru_cache(maxsize=100)
def get_bot_config(bot_id: int) -> dict:
    return db.get_bot_config(bot_id)
```

---

## ğŸ”§ å¯æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶ç³»ç»Ÿæ¶æ„

```python
# æ’ä»¶æ¥å£
class PluginBase(ABC):
    @abstractmethod
    def get_info(self) -> PluginInfo:
        """è·å–æ’ä»¶ä¿¡æ¯"""
        pass
    
    async def on_load(self):
        """æ’ä»¶åŠ è½½"""
        pass
    
    async def on_unload(self):
        """æ’ä»¶å¸è½½"""
        pass

# é’©å­ç³»ç»Ÿ
class PluginManager:
    def __init__(self):
        self.hooks: Dict[str, List[Callable]] = {}
    
    def register_hook(self, hook_name: str, callback: Callable):
        """æ³¨å†Œé’©å­"""
        if hook_name not in self.hooks:
            self.hooks[hook_name] = []
        self.hooks[hook_name].append(callback)
    
    async def call_hook(self, hook_name: str, *args, **kwargs):
        """è°ƒç”¨é’©å­"""
        if hook_name in self.hooks:
            for callback in self.hooks[hook_name]:
                await callback(*args, **kwargs)

# ä½¿ç”¨ç¤ºä¾‹
class MyPlugin(PluginBase):
    async def on_load(self):
        plugin_manager.register_hook(
            'before_message_forward',
            self.on_before_forward
        )
    
    async def on_before_forward(self, message: dict):
        # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
        message['content'] = f"[æ’ä»¶] {message['content']}"
```

### 2. å¹³å°æ‰©å±•

```python
# è½¬å‘å™¨æ¥å£
class ForwarderBase(ABC):
    @abstractmethod
    async def send_message(self, content: str, **kwargs) -> bool:
        """å‘é€æ–‡æœ¬æ¶ˆæ¯"""
        pass
    
    @abstractmethod
    async def send_image(self, image_url: str, **kwargs) -> bool:
        """å‘é€å›¾ç‰‡æ¶ˆæ¯"""
        pass
    
    @abstractmethod
    async def test_connection(self) -> tuple[bool, str]:
        """æµ‹è¯•è¿æ¥"""
        pass

# æ–°å¹³å°å®ç°
class SlackForwarder(ForwarderBase):
    def __init__(self, webhook_url: str):
        self.webhook_url = webhook_url
    
    async def send_message(self, content: str, **kwargs) -> bool:
        async with aiohttp.ClientSession() as session:
            async with session.post(
                self.webhook_url,
                json={"text": content}
            ) as resp:
                return resp.status == 200
```

### 3. æ•°æ®åº“è¿ç§»

```python
# ç‰ˆæœ¬ç®¡ç†
DATABASE_VERSION = 3

def migrate_database():
    current_version = db.get_config('db_version') or 0
    
    if current_version < 1:
        # è¿ç§»åˆ°ç‰ˆæœ¬1
        migrate_to_v1()
    
    if current_version < 2:
        # è¿ç§»åˆ°ç‰ˆæœ¬2
        migrate_to_v2()
    
    if current_version < 3:
        # è¿ç§»åˆ°ç‰ˆæœ¬3
        migrate_to_v3()
    
    db.set_config('db_version', str(DATABASE_VERSION))

def migrate_to_v3():
    """æ·»åŠ æ–°å­—æ®µ"""
    with db.get_connection() as conn:
        conn.execute("""
            ALTER TABLE accounts 
            ADD COLUMN avatar_url TEXT
        """)
```

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### 1. å¥åº·æ£€æŸ¥

```python
class HealthChecker:
    async def check_all(self) -> dict:
        """å…¨é¢å¥åº·æ£€æŸ¥"""
        results = {
            "redis": await self.check_redis(),
            "database": await self.check_database(),
            "scrapers": await self.check_scrapers(),
            "queue": await self.check_queue()
        }
        
        overall = all(r['status'] == 'ok' for r in results.values())
        
        return {
            "status": "healthy" if overall else "unhealthy",
            "components": results,
            "timestamp": datetime.now().isoformat()
        }
    
    async def check_redis(self) -> dict:
        """æ£€æŸ¥Redis"""
        try:
            await redis_queue.redis.ping()
            return {"status": "ok"}
        except Exception as e:
            return {"status": "error", "message": str(e)}
```

### 2. æ€§èƒ½æŒ‡æ ‡

```python
class Metrics:
    def __init__(self):
        self.counters = defaultdict(int)
        self.timers = defaultdict(list)
    
    def record_message_processed(self, platform: str, status: str):
        """è®°å½•æ¶ˆæ¯å¤„ç†"""
        key = f"message.{platform}.{status}"
        self.counters[key] += 1
    
    @contextmanager
    def measure_time(self, operation: str):
        """æµ‹é‡è€—æ—¶"""
        start = time.time()
        yield
        duration = time.time() - start
        self.timers[operation].append(duration)
    
    def get_summary(self) -> dict:
        """è·å–ç»Ÿè®¡æ‘˜è¦"""
        return {
            "counters": dict(self.counters),
            "timers": {
                k: {
                    "count": len(v),
                    "avg": sum(v) / len(v) if v else 0,
                    "min": min(v) if v else 0,
                    "max": max(v) if v else 0
                }
                for k, v in self.timers.items()
            }
        }
```

### 3. æ—¥å¿—ç®¡ç†

```python
# æ—¥å¿—é…ç½®
LOGGING_CONFIG = {
    "version": 1,
    "formatters": {
        "default": {
            "format": "[%(asctime)s] [%(levelname)s] %(message)s"
        },
        "detailed": {
            "format": "[%(asctime)s] [%(levelname)s] [%(name)s:%(lineno)d] %(message)s"
        }
    },
    "handlers": {
        "console": {
            "class": "logging.StreamHandler",
            "formatter": "default",
            "level": "INFO"
        },
        "file": {
            "class": "logging.handlers.RotatingFileHandler",
            "filename": "logs/app.log",
            "maxBytes": 10485760,  # 10MB
            "backupCount": 5,
            "formatter": "detailed",
            "level": "DEBUG"
        }
    },
    "root": {
        "level": "DEBUG",
        "handlers": ["console", "file"]
    }
}
```

---

## ğŸš€ éƒ¨ç½²æ¶æ„

### 1. å¼€å‘ç¯å¢ƒ

```
å¼€å‘æœºå™¨
â”œâ”€â”€ Python 3.12 (venv)
â”œâ”€â”€ Node.js 18
â”œâ”€â”€ Redis (æœ¬åœ°)
â”œâ”€â”€ Chrome/Chromium
â””â”€â”€ VS Code / PyCharm
```

### 2. ç”Ÿäº§ç¯å¢ƒ

```
Electronåº”ç”¨
â”œâ”€â”€ åµŒå…¥å¼Redis
â”œâ”€â”€ åµŒå…¥å¼åç«¯ (PyInstaller)
â”œâ”€â”€ å‰ç«¯èµ„æº (Viteæ‰“åŒ…)
â””â”€â”€ Playwrightæµè§ˆå™¨
```

### 3. Dockeréƒ¨ç½²

```yaml
# docker-compose.yml
version: '3.8'

services:
  kook-forwarder:
    build: .
    ports:
      - "9527:9527"
      - "5173:5173"
    volumes:
      - ./data:/app/data
    environment:
      - REDIS_HOST=redis
      - API_PORT=9527
    depends_on:
      - redis
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data

volumes:
  redis-data:
```

---

**æ–‡æ¡£ç»´æŠ¤**: è¯·åœ¨æ¯æ¬¡é‡å¤§æ¶æ„å˜æ›´åæ›´æ–°æ­¤æ–‡æ¡£  
**ç‰ˆæœ¬æ§åˆ¶**: æ–‡æ¡£ç‰ˆæœ¬åº”ä¸ç³»ç»Ÿç‰ˆæœ¬åŒæ­¥æ›´æ–°

