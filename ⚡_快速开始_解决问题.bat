@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion

:menu
cls
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘      ðŸŽ¯ KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - é—®é¢˜è§£å†³æŽ§åˆ¶å° v1.0                    â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¿«é€Ÿè¯Šæ–­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚                                                                  â”‚
echo â”‚  [1] ðŸ” ä¸€é”®è¯Šæ–­æ‰€æœ‰é—®é¢˜ï¼ˆæŽ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰                         â”‚
echo â”‚  [2] ðŸš€ å¿«é€Ÿå¯åŠ¨ç³»ç»Ÿï¼ˆå‰ç«¯+åŽç«¯ï¼‰                                 â”‚
echo â”‚  [3] ðŸ“Š ç”Ÿæˆç³»ç»ŸçŠ¶æ€æŠ¥å‘Š                                          â”‚
echo â”‚                                                                  â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆ†é¡¹æ£€æŸ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚                                                                  â”‚
echo â”‚  [4] ðŸ’¾ æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§                                          â”‚
echo â”‚  [5] ðŸ”§ æ£€æŸ¥RedisæœåŠ¡                                             â”‚
echo â”‚  [6] ðŸª éªŒè¯Cookieå­˜å‚¨                                            â”‚
echo â”‚  [7] ðŸ§ª ç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡æ£€æŸ¥                                        â”‚
echo â”‚  [8] ðŸ“ˆ ç³»ç»Ÿå¥åº·ç›‘æŽ§ï¼ˆ5åˆ†é’Ÿï¼‰                                      â”‚
echo â”‚                                                                  â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
echo â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é«˜çº§æ“ä½œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
echo â”‚                                                                  â”‚
echo â”‚  [9] ðŸ“‹ æ‰“å¼€å®Œæ•´æ“ä½œæŒ‡å¯¼æ–‡æ¡£                                      â”‚
echo â”‚  [10] ðŸ”„ é‡æ–°åˆå§‹åŒ–æ•°æ®åº“                                         â”‚
echo â”‚  [11] ðŸ› ï¸  æ‰“å¼€ä¸»æŽ§åˆ¶å°                                            â”‚
echo â”‚  [0] âŒ é€€å‡º                                                      â”‚
echo â”‚                                                                  â”‚
echo â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
echo.
set /p choice="è¯·é€‰æ‹©æ“ä½œ [0-11]: "

if "%choice%"=="1" goto full_diagnostic
if "%choice%"=="2" goto quick_start
if "%choice%"=="3" goto generate_report
if "%choice%"=="4" goto check_database
if "%choice%"=="5" goto check_redis
if "%choice%"=="6" goto verify_cookie
if "%choice%"=="7" goto e2e_check
if "%choice%"=="8" goto health_monitor
if "%choice%"=="9" goto open_guide
if "%choice%"=="10" goto reinit_database
if "%choice%"=="11" goto main_console
if "%choice%"=="0" goto end

echo âŒ æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡è¯•
timeout /t 2 >nul
goto menu

REM ========================================
REM åŠŸèƒ½1: ä¸€é”®è¯Šæ–­æ‰€æœ‰é—®é¢˜
REM ========================================
:full_diagnostic
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ” ä¸€é”®è¯Šæ–­æ‰€æœ‰é—®é¢˜
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo å°†ä¾æ¬¡æ£€æŸ¥:
echo   âœ“ çŽ¯å¢ƒé…ç½®ï¼ˆPythonã€Node.jsã€Gitï¼‰
echo   âœ“ æ•°æ®åº“å®Œæ•´æ€§
echo   âœ“ RedisæœåŠ¡çŠ¶æ€
echo   âœ“ Cookieå­˜å‚¨åŠŸèƒ½
echo   âœ“ ç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡
echo   âœ“ ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
echo.
echo â±ï¸  é¢„è®¡è€—æ—¶: 2-3åˆ†é’Ÿ
echo.
pause

cd /d %~dp0
call venv\Scripts\activate.bat

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [1/6] çŽ¯å¢ƒæ£€æŸ¥
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æ£€æŸ¥Pythonç‰ˆæœ¬:
python --version 2>nul || python3 --version
echo.
echo æ£€æŸ¥Node.jsç‰ˆæœ¬:
node --version
echo.
echo æ£€æŸ¥Gitç‰ˆæœ¬:
git --version
echo.
echo âœ… çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [2/6] æ•°æ®åº“æ£€æŸ¥
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python scripts\check_database.py 2>nul || python3 scripts\check_database.py
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [3/6] Redisæ£€æŸ¥
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python scripts\test_redis.py 2>nul || python3 scripts\test_redis.py
echo.
echo â„¹ï¸  æ³¨æ„: å¦‚æžœRedisè¿žæŽ¥å¤±è´¥ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨å†…ç½®Redis
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [4/6] CookieéªŒè¯
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python scripts\verify_cookie_storage.py 2>nul || python3 scripts\verify_cookie_storage.py
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [5/6] ç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python scripts\e2e_test_preparation.py 2>nul || python3 scripts\e2e_test_preparation.py
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo [6/6] ç”Ÿæˆç³»ç»ŸæŠ¥å‘Š
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
python scripts\generate_test_report.py 2>nul || python3 scripts\generate_test_report.py
pause

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸŽ‰ è¯Šæ–­å®Œæˆï¼
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æŠ¥å‘Šå·²ä¿å­˜åˆ°: %USERPROFILE%\Documents\KookForwarder\data\reports\
echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½2: å¿«é€Ÿå¯åŠ¨ç³»ç»Ÿ
REM ========================================
:quick_start
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸš€ å¿«é€Ÿå¯åŠ¨ç³»ç»Ÿ
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

REM æ£€æŸ¥æ˜¯å¦å·²ç»è¿è¡Œ
tasklist /FI "WINDOWTITLE eq KOOKåŽç«¯æœåŠ¡*" 2>NUL | find /I /N "cmd.exe">NUL
if "%ERRORLEVEL%"=="0" (
    echo âš ï¸  æ£€æµ‹åˆ°åŽç«¯æœåŠ¡å¯èƒ½å·²åœ¨è¿è¡Œ
    set /p kill="æ˜¯å¦å¼ºåˆ¶é‡å¯? (y/n): "
    if /i "!kill!"=="y" (
        taskkill /F /FI "WINDOWTITLE eq KOOKåŽç«¯æœåŠ¡*" 2>NUL
        taskkill /F /FI "WINDOWTITLE eq KOOKå‰ç«¯æœåŠ¡*" 2>NUL
        echo âœ… å·²åœæ­¢æ—§æœåŠ¡
        timeout /t 2 >nul
    )
)

echo.
echo [1/3] å¯åŠ¨RedisæœåŠ¡...
cd redis
tasklist /FI "IMAGENAME eq redis-server.exe" 2>NUL | find /I /N "redis-server.exe">NUL
if not "%ERRORLEVEL%"=="0" (
    start "RedisæœåŠ¡" redis-server.exe redis.windows.conf
    echo âœ… RedisæœåŠ¡å·²å¯åŠ¨
) else (
    echo â„¹ï¸  RedisæœåŠ¡å·²åœ¨è¿è¡Œ
)
cd ..

echo.
echo [2/3] å¯åŠ¨åŽç«¯æœåŠ¡ï¼ˆç«¯å£ 9527ï¼‰...
start "KOOKåŽç«¯æœåŠ¡" cmd /k "cd /d %~dp0\backend && ..\..\venv\Scripts\activate && python -m uvicorn app.main:app --host 0.0.0.0 --port 9527"
echo â³ ç­‰å¾…åŽç«¯å¯åŠ¨ï¼ˆ10ç§’ï¼‰...
timeout /t 10 /nobreak >nul

echo.
echo [3/3] å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£ 5173ï¼‰...
cd frontend
start "KOOKå‰ç«¯æœåŠ¡" cmd /k "npm run dev"
cd ..
echo â³ ç­‰å¾…å‰ç«¯å¯åŠ¨ï¼ˆ5ç§’ï¼‰...
timeout /t 5 /nobreak >nul

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo âœ… ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo ðŸ“± å‰ç«¯åœ°å€: http://localhost:5173
echo ðŸ”§ åŽç«¯åœ°å€: http://localhost:9527
echo ðŸ“š APIæ–‡æ¡£: http://localhost:9527/docs
echo.
echo ðŸŒ æ­£åœ¨æ‰“å¼€å‰ç«¯ç•Œé¢...
start http://localhost:5173
echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½3: ç”Ÿæˆç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
REM ========================================
:generate_report
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ“Š ç”Ÿæˆç³»ç»ŸçŠ¶æ€æŠ¥å‘Š
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d %~dp0
call venv\Scripts\activate.bat

python scripts\generate_test_report.py 2>nul || python3 scripts\generate_test_report.py

echo.
echo æŠ¥å‘Šå·²ä¿å­˜åˆ°: %USERPROFILE%\Documents\KookForwarder\data\reports\
echo.
set /p open="æ˜¯å¦æ‰“å¼€æŠ¥å‘Šç›®å½•? (y/n): "
if /i "%open%"=="y" (
    explorer "%USERPROFILE%\Documents\KookForwarder\data\reports"
)
pause
goto menu

REM ========================================
REM åŠŸèƒ½4: æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
REM ========================================
:check_database
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ’¾ æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d %~dp0
call venv\Scripts\activate.bat

python scripts\check_database.py 2>nul || python3 scripts\check_database.py

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½5: æ£€æŸ¥RedisæœåŠ¡
REM ========================================
:check_redis
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ”§ æ£€æŸ¥RedisæœåŠ¡
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

REM æ£€æŸ¥Redisè¿›ç¨‹
tasklist /FI "IMAGENAME eq redis-server.exe" 2>NUL | find /I /N "redis-server.exe">NUL
if "%ERRORLEVEL%"=="0" (
    echo âœ… RedisæœåŠ¡æ­£åœ¨è¿è¡Œ
    echo.
    tasklist /FI "IMAGENAME eq redis-server.exe"
) else (
    echo âš ï¸  RedisæœåŠ¡æœªè¿è¡Œ
    echo.
    set /p start="æ˜¯å¦å¯åŠ¨RedisæœåŠ¡? (y/n): "
    if /i "!start!"=="y" (
        cd redis
        start "RedisæœåŠ¡" redis-server.exe redis.windows.conf
        cd ..
        timeout /t 2 >nul
        echo âœ… RedisæœåŠ¡å·²å¯åŠ¨
    )
)

echo.
echo æ‰§è¡Œè¿žæŽ¥æµ‹è¯•...
cd /d %~dp0
call venv\Scripts\activate.bat
python scripts\test_redis.py 2>nul || python3 scripts\test_redis.py

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½6: éªŒè¯Cookieå­˜å‚¨
REM ========================================
:verify_cookie
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸª éªŒè¯Cookieå­˜å‚¨
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d %~dp0
call venv\Scripts\activate.bat

python scripts\verify_cookie_storage.py 2>nul || python3 scripts\verify_cookie_storage.py

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½7: ç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡æ£€æŸ¥
REM ========================================
:e2e_check
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ§ª ç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡æ£€æŸ¥
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

cd /d %~dp0
call venv\Scripts\activate.bat

python scripts\e2e_test_preparation.py 2>nul || python3 scripts\e2e_test_preparation.py

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ“ å¦‚ä½•å®Œæˆç«¯åˆ°ç«¯æµ‹è¯•å‡†å¤‡
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æ ¹æ®ä¸Šæ–¹æ£€æŸ¥ç»“æžœï¼Œæ‚¨å¯èƒ½éœ€è¦:
echo.
echo âŒ å¦‚æžœç¼ºå°‘KOOKè´¦å·:
echo    1. è®¿é—® http://localhost:5173
echo    2. ç‚¹å‡» "è´¦å·ç®¡ç†" â†’ "æ·»åŠ è´¦å·"
echo    3. è¾“å…¥KOOKé‚®ç®±ã€å¯†ç å’ŒCookie
echo.
echo âŒ å¦‚æžœç¼ºå°‘Boté…ç½®:
echo    1. è®¿é—® http://localhost:5173
echo    2. ç‚¹å‡» "Boté…ç½®" â†’ "æ·»åŠ Bot"
echo    3. é€‰æ‹©å¹³å°å¹¶é…ç½®Webhook/Token
echo.
echo âŒ å¦‚æžœç¼ºå°‘é¢‘é“æ˜ å°„:
echo    1. è®¿é—® http://localhost:5173
echo    2. ç‚¹å‡» "é¢‘é“æ˜ å°„" â†’ "æ·»åŠ æ˜ å°„"
echo    3. é€‰æ‹©KOOKé¢‘é“å’Œç›®æ ‡Bot
echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½8: ç³»ç»Ÿå¥åº·ç›‘æŽ§
REM ========================================
:health_monitor
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ“ˆ ç³»ç»Ÿå¥åº·ç›‘æŽ§ï¼ˆ5åˆ†é’Ÿï¼‰
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo âš ï¸  æ­¤åŠŸèƒ½å°†æŒç»­ç›‘æŽ§ç³»ç»Ÿ5åˆ†é’Ÿ
echo â„¹ï¸  å¯ä»¥æŒ‰ Ctrl+C æå‰åœæ­¢
echo.
pause

cd /d %~dp0
call venv\Scripts\activate.bat

python scripts\monitor_system_health.py 2>nul || python3 scripts\monitor_system_health.py

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½9: æ‰“å¼€å®Œæ•´æ“ä½œæŒ‡å¯¼æ–‡æ¡£
REM ========================================
:open_guide
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ“‹ æ‰“å¼€å®Œæ•´æ“ä½œæŒ‡å¯¼æ–‡æ¡£
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

if exist "ðŸŽ¯_CMDå…¨ç¨‹æ“ä½œæŒ‡å¯¼_è§£å†³æ‰€æœ‰é—®é¢˜.md" (
    echo æ­£åœ¨æ‰“å¼€æ–‡æ¡£...
    start "" "ðŸŽ¯_CMDå…¨ç¨‹æ“ä½œæŒ‡å¯¼_è§£å†³æ‰€æœ‰é—®é¢˜.md"
    echo âœ… æ–‡æ¡£å·²æ‰“å¼€
) else (
    echo âŒ æœªæ‰¾åˆ°æ“ä½œæŒ‡å¯¼æ–‡æ¡£
    echo æ–‡æ¡£è·¯å¾„: %~dp0ðŸŽ¯_CMDå…¨ç¨‹æ“ä½œæŒ‡å¯¼_è§£å†³æ‰€æœ‰é—®é¢˜.md
)

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½10: é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
REM ========================================
:reinit_database
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo ðŸ”„ é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo âš ï¸  è­¦å‘Š: æ­¤æ“ä½œå°†åˆ é™¤çŽ°æœ‰æ•°æ®åº“å¹¶é‡æ–°åˆ›å»º
echo âš ï¸  æ‰€æœ‰è´¦å·ã€é…ç½®ã€æ˜ å°„æ•°æ®éƒ½å°†ä¸¢å¤±ï¼
echo.
set /p confirm="ç¡®è®¤è¦é‡æ–°åˆå§‹åŒ–æ•°æ®åº“å—? (è¾“å…¥ YES ç¡®è®¤): "

if not "%confirm%"=="YES" (
    echo âŒ æ“ä½œå·²å–æ¶ˆ
    pause
    goto menu
)

echo.
echo æ­£åœ¨å¤‡ä»½çŽ°æœ‰æ•°æ®åº“...
set DB_PATH=%USERPROFILE%\Documents\KookForwarder\data\config.db
set BACKUP_PATH=%USERPROFILE%\Documents\KookForwarder\data\config_backup_%date:~0,4%%date:~5,2%%date:~8,2%_%time:~0,2%%time:~3,2%%time:~6,2%.db
set BACKUP_PATH=%BACKUP_PATH: =0%

if exist "%DB_PATH%" (
    copy "%DB_PATH%" "%BACKUP_PATH%" >nul
    echo âœ… æ•°æ®åº“å·²å¤‡ä»½åˆ°: %BACKUP_PATH%
    
    del "%DB_PATH%"
    echo âœ… æ—§æ•°æ®åº“å·²åˆ é™¤
)

echo.
echo æ­£åœ¨å¯åŠ¨åŽç«¯ä»¥åˆå§‹åŒ–æ•°æ®åº“...
cd /d %~dp0\backend
call ..\venv\Scripts\activate.bat

REM å¯åŠ¨åŽç«¯å¹¶ç­‰å¾…åˆå§‹åŒ–
start "åˆå§‹åŒ–æ•°æ®åº“" cmd /c "python -m uvicorn app.main:app --host 0.0.0.0 --port 9527"
echo â³ ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–ï¼ˆ15ç§’ï¼‰...
timeout /t 15 /nobreak >nul

REM åœæ­¢åŽç«¯
taskkill /F /FI "WINDOWTITLE eq åˆå§‹åŒ–æ•°æ®åº“*" 2>nul

cd ..

echo.
echo âœ… æ•°æ®åº“é‡æ–°åˆå§‹åŒ–å®Œæˆï¼
echo.
echo éªŒè¯æ•°æ®åº“...
python scripts\check_database.py 2>nul || python3 scripts\check_database.py

echo.
pause
goto menu

REM ========================================
REM åŠŸèƒ½11: æ‰“å¼€ä¸»æŽ§åˆ¶å°
REM ========================================
:main_console
cls
if exist "KOOKç³»ç»Ÿ_ä¸»æŽ§åˆ¶å°.bat" (
    echo æ­£åœ¨æ‰“å¼€ä¸»æŽ§åˆ¶å°...
    call "KOOKç³»ç»Ÿ_ä¸»æŽ§åˆ¶å°.bat"
) else (
    echo âŒ æœªæ‰¾åˆ°ä¸»æŽ§åˆ¶å°è„šæœ¬
    echo è¯·æ£€æŸ¥æ–‡ä»¶: KOOKç³»ç»Ÿ_ä¸»æŽ§åˆ¶å°.bat
    pause
)
goto menu

REM ========================================
REM é€€å‡º
REM ========================================
:end
cls
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo æ„Ÿè°¢ä½¿ç”¨ KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿï¼
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒ:
echo   ðŸ“‹ å®Œæ•´æ“ä½œæŒ‡å¯¼: ðŸŽ¯_CMDå…¨ç¨‹æ“ä½œæŒ‡å¯¼_è§£å†³æ‰€æœ‰é—®é¢˜.md
echo   ðŸ“š å·¥ä½œäº¤æŽ¥æ–‡æ¡£: WORK_HANDOVER_2025-11-10.md
echo   ðŸ“– README: README.md
echo.
timeout /t 3 >nul
exit
