# KOOKæ¶ˆæ¯è½¬å‘ç³»ç»Ÿ - å¼€å‘è€…é€ŸæŸ¥å¡

**ç‰ˆæœ¬**: v1.7.2  
**æ›´æ–°**: 2025-10-19

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

### å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
./install.sh              # Linux/macOSä¸€é”®å®‰è£…
install.bat               # Windowsä¸€é”®å®‰è£…

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
./start.sh                # å¯åŠ¨æ‰€æœ‰æœåŠ¡
cd frontend && npm run dev          # ä»…å‰ç«¯
cd backend && python -m app.main    # ä»…åç«¯
```

### æµ‹è¯•

```bash
# å‰ç«¯æµ‹è¯•
cd frontend
npm run test              # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:watch        # ç›‘è§†æ¨¡å¼
npm run test:coverage     # è¦†ç›–ç‡æŠ¥å‘Š

# åç«¯æµ‹è¯•
cd backend
pytest tests/ -v          # è¯¦ç»†è¾“å‡º
pytest tests/ --cov       # è¦†ç›–ç‡
```

### ä»£ç è´¨é‡

```bash
# å‰ç«¯
cd frontend
npm run lint              # ESLintæ£€æŸ¥+ä¿®å¤
npm run format            # Prettieræ ¼å¼åŒ–

# åç«¯
cd backend
black app/                # Blackæ ¼å¼åŒ–
flake8 app/               # ä»£ç æ£€æŸ¥
```

### æ„å»º

```bash
# å‰ç«¯
cd frontend
npm run build             # ç”Ÿäº§æ„å»º
npm run preview           # é¢„è§ˆæ„å»ºç»“æœ

# Electron
npm run electron:build             # æ‰€æœ‰å¹³å°
npm run electron:build:win         # ä»…Windows
npm run electron:build:mac         # ä»…macOS
npm run electron:build:linux       # ä»…Linux
```

### å‘å¸ƒ

```bash
# è‡ªåŠ¨åŒ–å‘å¸ƒ
./scripts/release.sh      # Linux/macOS
scripts\release.bat        # Windows

# æ‰‹åŠ¨å‘å¸ƒ
git tag -a v1.7.0 -m "Release v1.7.0"
git push origin v1.7.0
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
CSBJJWT/
â”œâ”€â”€ backend/              # Pythonåç«¯
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ kook/        # KOOKæ¶ˆæ¯æŠ“å–
â”‚   â”‚   â”œâ”€â”€ queue/       # Redisæ¶ˆæ¯é˜Ÿåˆ—
â”‚   â”‚   â”œâ”€â”€ forwarders/  # å¹³å°è½¬å‘å™¨
â”‚   â”‚   â”œâ”€â”€ processors/  # æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ api/         # FastAPIè·¯ç”±
â”‚   â”‚   â””â”€â”€ utils/       # å·¥å…·ç±»
â”‚   â”œâ”€â”€ tests/           # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ frontend/             # Electronå‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/       # Vueé¡µé¢ï¼ˆ11ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ components/  # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ store/       # PiniaçŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ api/         # APIè°ƒç”¨
â”‚   â”‚   â””â”€â”€ router/      # è·¯ç”±é…ç½®
â”‚   â”œâ”€â”€ electron/        # Electronä¸»è¿›ç¨‹
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/                # æ–‡æ¡£ï¼ˆ12ç¯‡ï¼‰
â”‚   â”œâ”€â”€ Cookieè·å–è¯¦ç»†æ•™ç¨‹.md ğŸ†•
â”‚   â”œâ”€â”€ å®Œæ•´ç”¨æˆ·æ‰‹å†Œ.md
â”‚   â”œâ”€â”€ å¼€å‘æŒ‡å—.md
â”‚   â””â”€â”€ è§†é¢‘æ•™ç¨‹/ ğŸ†•
â”‚
â”œâ”€â”€ scripts/             # è‡ªåŠ¨åŒ–è„šæœ¬ ğŸ†•
â”‚   â”œâ”€â”€ release.sh
â”‚   â””â”€â”€ release.bat
â”‚
â”œâ”€â”€ build/               # æ‰“åŒ…é…ç½®
â”œâ”€â”€ redis/               # åµŒå…¥å¼Redis
â””â”€â”€ README.md
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯
- FastAPI 0.109 - Webæ¡†æ¶
- Playwright 1.40 - æµè§ˆå™¨è‡ªåŠ¨åŒ–
- Redis 5.0 - æ¶ˆæ¯é˜Ÿåˆ—
- SQLite - æ•°æ®å­˜å‚¨
- discord-webhook - Discordè½¬å‘
- python-telegram-bot 20.7 - Telegramè½¬å‘
- lark-oapi 1.2 - é£ä¹¦è½¬å‘

### å‰ç«¯
- Electron 28 - æ¡Œé¢åº”ç”¨æ¡†æ¶
- Vue 3.4 - UIæ¡†æ¶
- Element Plus 2.5 - UIç»„ä»¶åº“
- Pinia 2.1 - çŠ¶æ€ç®¡ç†
- ECharts 5.4 - æ•°æ®å¯è§†åŒ–
- Axios 1.6 - HTTPå®¢æˆ·ç«¯

### å¼€å‘å·¥å…·
- Vitest - å‰ç«¯æµ‹è¯•
- Pytest - åç«¯æµ‹è¯•
- ESLint - ä»£ç æ£€æŸ¥
- Prettier - ä»£ç æ ¼å¼åŒ–

---

## ğŸ”‘ å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `backend/app/main.py` | åç«¯å…¥å£ |
| `backend/app/config.py` | é…ç½®ç®¡ç† |
| `backend/app/kook/scraper.py` | KOOKæ¶ˆæ¯æŠ“å– |
| `backend/app/queue/worker.py` | æ¶ˆæ¯å¤„ç†Worker |
| `frontend/src/main.js` | å‰ç«¯å…¥å£ |
| `frontend/src/views/Layout.vue` | ä¸»å¸ƒå±€ |
| `frontend/src/views/Wizard.vue` | é…ç½®å‘å¯¼ |
| `frontend/src/views/Help.vue` | å¸®åŠ©ä¸­å¿ƒ ğŸ†• |
| `scripts/release.sh` | å‘å¸ƒè„šæœ¬ ğŸ†• |

---

## ğŸŒ APIç«¯ç‚¹

### è®¤è¯
- POST `/auth/login` - ç™»å½•
- POST `/auth/logout` - ç™»å‡º
- GET `/auth/status` - è®¤è¯çŠ¶æ€

### è´¦å·ç®¡ç†
- GET `/api/accounts` - è·å–è´¦å·åˆ—è¡¨
- POST `/api/accounts` - æ·»åŠ è´¦å·
- PUT `/api/accounts/{id}` - æ›´æ–°è´¦å·
- DELETE `/api/accounts/{id}` - åˆ é™¤è´¦å·

### æœºå™¨äººé…ç½®
- GET `/api/bots` - è·å–Botåˆ—è¡¨
- POST `/api/bots` - æ·»åŠ Bot
- PUT `/api/bots/{id}` - æ›´æ–°Bot
- DELETE `/api/bots/{id}` - åˆ é™¤Bot
- POST `/api/bots/{id}/test` - æµ‹è¯•Bot

### é¢‘é“æ˜ å°„
- GET `/api/mappings` - è·å–æ˜ å°„åˆ—è¡¨
- POST `/api/mappings` - æ·»åŠ æ˜ å°„
- DELETE `/api/mappings/{id}` - åˆ é™¤æ˜ å°„
- POST `/api/mappings/import` - å¯¼å…¥æ˜ å°„ ğŸ†•
- GET `/api/mappings/export` - å¯¼å‡ºæ˜ å°„ ğŸ†•
- POST `/api/smart-mapping/suggest` - æ™ºèƒ½æ˜ å°„å»ºè®®

### ç³»ç»Ÿç®¡ç†
- GET `/api/system/status` - ç³»ç»ŸçŠ¶æ€
- POST `/api/system/start` - å¯åŠ¨æœåŠ¡
- POST `/api/system/stop` - åœæ­¢æœåŠ¡
- POST `/api/system/restart` - é‡å¯æœåŠ¡
- GET `/api/system/config` - è·å–ç³»ç»Ÿé…ç½®
- POST `/api/system/config` - ä¿å­˜ç³»ç»Ÿé…ç½®
- POST `/api/system/email/test` - æµ‹è¯•é‚®ä»¶ ğŸ†•

### æ—¥å¿—
- GET `/api/logs` - è·å–æ—¥å¿—åˆ—è¡¨
- DELETE `/api/logs` - æ¸…ç©ºæ—¥å¿—
- GET `/api/logs/export` - å¯¼å‡ºæ—¥å¿—

### å¥åº·æ£€æŸ¥
- GET `/health` - å¥åº·æ£€æŸ¥
- GET `/api/health/detailed` - è¯¦ç»†å¥åº·æ£€æŸ¥

### WebSocket
- WS `/ws` - WebSocketè¿æ¥ï¼ˆå®æ—¶æ—¥å¿—æ¨é€ï¼‰

---

## ğŸ—„ï¸ æ•°æ®åº“Schema

### accountsï¼ˆè´¦å·è¡¨ï¼‰
```sql
- id: INTEGER PRIMARY KEY
- email: TEXT
- password_encrypted: TEXT
- cookie: TEXT
- status: TEXT (online/offline)
- last_active: TIMESTAMP
- created_at: TIMESTAMP
```

### bot_configsï¼ˆBoté…ç½®è¡¨ï¼‰
```sql
- id: INTEGER PRIMARY KEY
- platform: TEXT (discord/telegram/feishu)
- name: TEXT
- config: TEXT (JSON)
- status: TEXT
- created_at: TIMESTAMP
```

### channel_mappingsï¼ˆé¢‘é“æ˜ å°„è¡¨ï¼‰
```sql
- id: INTEGER PRIMARY KEY
- kook_server_id: TEXT
- kook_channel_id: TEXT
- kook_channel_name: TEXT
- target_platform: TEXT
- target_bot_id: INTEGER
- target_channel_id: TEXT
- enabled: INTEGER (0/1)
```

### message_logsï¼ˆæ¶ˆæ¯æ—¥å¿—è¡¨ï¼‰
```sql
- id: INTEGER PRIMARY KEY
- kook_message_id: TEXT UNIQUE
- kook_channel_id: TEXT
- content: TEXT
- message_type: TEXT
- sender_name: TEXT
- target_platform: TEXT
- target_channel: TEXT
- status: TEXT (success/failed/pending)
- error_message: TEXT
- latency_ms: INTEGER
- created_at: TIMESTAMP
```

---

## ğŸ” ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```env
# APIæœåŠ¡
API_HOST=127.0.0.1
API_PORT=9527
API_TOKEN=your-secure-token-here

# Redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_PASSWORD=

# æ•°æ®åº“
DATABASE_URL=sqlite:///~/Documents/KookForwarder/data/config.db

# å›¾åºŠ
IMAGE_SERVER_PORT=9528
IMAGE_MAX_SIZE_GB=10
IMAGE_CLEANUP_DAYS=7

# æ—¥å¿—
LOG_LEVEL=INFO
LOG_RETENTION_DAYS=3

# éªŒè¯ç ï¼ˆå¯é€‰ï¼‰
CAPTCHA_2CAPTCHA_API_KEY=your-api-key

# é‚®ä»¶å‘Šè­¦ï¼ˆå¯é€‰ï¼‰
SMTP_HOST=smtp.gmail.com
SMTP_PORT=465
EMAIL_FROM=your-email@gmail.com
EMAIL_PASSWORD=your-app-password
EMAIL_TO=admin@example.com
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•

```python
# å¯ç”¨è°ƒè¯•æ¨¡å¼
# backend/app/config.py
debug = True  # å¯ç”¨è¯¦ç»†æ—¥å¿—

# æŸ¥çœ‹æ—¥å¿—
tail -f ~/Documents/KookForwarder/data/logs/app.log

# æµ‹è¯•å•ä¸ªæ¨¡å—
cd backend
python -m app.kook.scraper  # æµ‹è¯•æŠ“å–å™¨
```

### å‰ç«¯è°ƒè¯•

```javascript
// å¯ç”¨Vue DevTools
// åœ¨æµè§ˆå™¨ä¸­å®‰è£…Vue DevToolsæ‰©å±•

// æŸ¥çœ‹ç½‘ç»œè¯·æ±‚
// F12 â†’ Network â†’ ç­›é€‰XHR

// æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
import { logger } from '@/utils/logger'
logger.debug('è°ƒè¯•ä¿¡æ¯:', data)
```

### Redisè°ƒè¯•

```bash
# è¿æ¥Redis
redis-cli -p 6379

# æŸ¥çœ‹é˜Ÿåˆ—
LLEN message_queue
LRANGE message_queue 0 10

# æ¸…ç©ºé˜Ÿåˆ—
DEL message_queue
```

---

## ğŸ“ Gitæäº¤è§„èŒƒ

### æäº¤ç±»å‹

```
feat:     æ–°åŠŸèƒ½
fix:      ä¿®å¤bug
docs:     æ–‡æ¡£æ›´æ–°
style:    ä»£ç æ ¼å¼ï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
refactor: é‡æ„
test:     æµ‹è¯•ç›¸å…³
chore:    æ„å»º/å·¥å…·å˜æ›´
perf:     æ€§èƒ½ä¼˜åŒ–
```

### æäº¤ç¤ºä¾‹

```bash
git commit -m "feat: æ·»åŠ å¸®åŠ©ä¸­å¿ƒåŠŸèƒ½"
git commit -m "fix: ä¿®å¤å›¾ç‰‡ä¸Šä¼ å¤±è´¥é—®é¢˜"
git commit -m "docs: æ›´æ–°ç”¨æˆ·æ‰‹å†Œ"
git commit -m "chore: å‡çº§ä¾èµ–ç‰ˆæœ¬"
```

---

## ğŸ”— æœ‰ç”¨é“¾æ¥

### å®˜æ–¹æ–‡æ¡£
- [FastAPIæ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Vue 3æ–‡æ¡£](https://vuejs.org/)
- [Element Plusæ–‡æ¡£](https://element-plus.org/)
- [Electronæ–‡æ¡£](https://www.electronjs.org/)
- [Playwrightæ–‡æ¡£](https://playwright.dev/)

### æœ¬é¡¹ç›®
- [GitHubä»“åº“](https://github.com/gfchfjh/CSBJJWT)
- [Issues](https://github.com/gfchfjh/CSBJJWT/issues)
- [Releases](https://github.com/gfchfjh/CSBJJWT/releases)
- [æ–‡æ¡£ç›®å½•](https://github.com/gfchfjh/CSBJJWT/tree/main/docs)

---

## ğŸ’¡ å¸¸ç”¨ä»£ç ç‰‡æ®µ

### æ·»åŠ æ–°çš„APIç«¯ç‚¹

```python
# backend/app/api/example.py
from fastapi import APIRouter

router = APIRouter(prefix="/api/example", tags=["ç¤ºä¾‹"])

@router.get("/")
async def get_examples():
    return {"message": "ç¤ºä¾‹ç«¯ç‚¹"}
```

```python
# backend/app/main.py
from .api import example
app.include_router(example.router)
```

### æ·»åŠ æ–°çš„Vueé¡µé¢

```vue
<!-- frontend/src/views/Example.vue -->
<template>
  <div class="example-view">
    <el-card>
      <template #header>
        <span>ç¤ºä¾‹é¡µé¢</span>
      </template>
      <p>å†…å®¹...</p>
    </el-card>
  </div>
</template>

<script setup>
import { ref } from 'vue'
const data = ref([])
</script>
```

```javascript
// frontend/src/router/index.js
import Example from '../views/Example.vue'

{
  path: '/example',
  name: 'Example',
  component: Example,
  meta: { title: 'ç¤ºä¾‹' }
}
```

### æ·»åŠ æ¶ˆæ¯å¤„ç†é€»è¾‘

```python
# backend/app/processors/custom.py
async def process_custom_message(message: dict):
    # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
    content = message.get('content')
    # ... å¤„ç† ...
    return processed_content
```

---

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### å‰ç«¯å•å…ƒæµ‹è¯•

```javascript
// frontend/src/__tests__/example.test.js
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'
import Example from '../views/Example.vue'

describe('Exampleç»„ä»¶', () => {
  it('åº”è¯¥æ¸²æŸ“æ­£ç¡®', () => {
    const wrapper = mount(Example)
    expect(wrapper.find('h1').text()).toBe('ç¤ºä¾‹')
  })
})
```

### åç«¯å•å…ƒæµ‹è¯•

```python
# backend/tests/test_example.py
import pytest
from app.example import example_function

def test_example_function():
    result = example_function("test")
    assert result == "expected"
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å…³é”®æŒ‡æ ‡

- **æ¶ˆæ¯å»¶è¿Ÿ**: å¹³å‡<2ç§’
- **è½¬å‘æˆåŠŸç‡**: >98%
- **å†…å­˜å ç”¨**: <500MB
- **CPUå ç”¨**: <10%

### ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep kook

# æŸ¥çœ‹å†…å­˜
free -h

# æŸ¥çœ‹RedisçŠ¶æ€
redis-cli info stats

# æŸ¥çœ‹æ—¥å¿—
tail -f ~/Documents/KookForwarder/data/logs/app.log
```

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### åç«¯æ— æ³•å¯åŠ¨

```bash
# 1. æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:9527
netstat -ano | findstr 9527  # Windows

# 2. æ£€æŸ¥Redis
redis-cli ping

# 3. æŸ¥çœ‹æ—¥å¿—
cat ~/Documents/KookForwarder/data/logs/app.log
```

### å‰ç«¯æ— æ³•è¿æ¥åç«¯

```bash
# 1. æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:9527/health

# 2. æ£€æŸ¥CORSé…ç½®
# backend/app/main.py - CORSMiddleware

# 3. æ£€æŸ¥API Token
# frontend/src/api/index.js - X-API-Token header
```

### KOOKè´¦å·æ‰çº¿

```bash
# 1. é‡æ–°è·å–Cookie
# å‚è€ƒ: docs/Cookieè·å–è¯¦ç»†æ•™ç¨‹.md

# 2. æ£€æŸ¥ç½‘ç»œ
ping www.kookapp.cn

# 3. æŸ¥çœ‹Playwrightæ—¥å¿—
# backendæ—¥å¿—ä¸­æœç´¢ "playwright" æˆ– "browser"
```

---

## ğŸ¨ UIç»„ä»¶é€ŸæŸ¥

### Element Pluså¸¸ç”¨ç»„ä»¶

```vue
<!-- æŒ‰é’® -->
<el-button type="primary">ä¸»è¦æŒ‰é’®</el-button>
<el-button type="success">æˆåŠŸæŒ‰é’®</el-button>

<!-- è¡¨å• -->
<el-form :model="form" label-width="120px">
  <el-form-item label="æ ‡ç­¾">
    <el-input v-model="form.field" />
  </el-form-item>
</el-form>

<!-- è¡¨æ ¼ -->
<el-table :data="tableData" border>
  <el-table-column prop="name" label="åç§°" />
</el-table>

<!-- å¯¹è¯æ¡† -->
<el-dialog v-model="visible" title="æ ‡é¢˜">
  å†…å®¹...
</el-dialog>

<!-- æ¶ˆæ¯æç¤º -->
<script>
import { ElMessage } from 'element-plus'
ElMessage.success('æˆåŠŸ')
ElMessage.error('å¤±è´¥')
</script>
```

---

## ğŸ” å¸¸ç”¨æŸ¥è¯¢

### æŸ¥æ‰¾ç‰¹å®šä»£ç 

```bash
# æœç´¢TODO
rg "TODO|FIXME" --type py --type vue

# æœç´¢console.log
rg "console\.(log|error)" frontend/src

# æœç´¢APIè°ƒç”¨
rg "api\." frontend/src

# æœç´¢ç‰ˆæœ¬å·
rg "version|ç‰ˆæœ¬" --type md
```

### ç»Ÿè®¡ä»£ç 

```bash
# ä»£ç è¡Œæ•°
cloc backend/app frontend/src

# Gitç»Ÿè®¡
git log --oneline | wc -l          # æäº¤æ•°
git shortlog -sn                    # è´¡çŒ®è€…ç»Ÿè®¡
```

---

## ğŸš€ éƒ¨ç½²æ£€æŸ¥æ¸…å•

å‘å¸ƒå‰æ£€æŸ¥:

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç‰ˆæœ¬å·å·²æ›´æ–°
- [ ] CHANGELOGå·²åˆ›å»º
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] æ— TODOæ ‡è®°
- [ ] æ— console.logï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] Gitå·²æäº¤
- [ ] æ ‡ç­¾å·²åˆ›å»º

å‘å¸ƒåéªŒè¯:

- [ ] GitHub Actionsæ„å»ºæˆåŠŸ
- [ ] å®‰è£…åŒ…å¯ä¸‹è½½
- [ ] å®‰è£…åŒ…å¯æ­£å¸¸è¿è¡Œ
- [ ] æ–‡æ¡£é“¾æ¥æ­£ç¡®
- [ ] Release Noteså®Œæ•´

---

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub**: https://github.com/gfchfjh/CSBJJWT
- **Issues**: https://github.com/gfchfjh/CSBJJWT/issues
- **Releases**: https://github.com/gfchfjh/CSBJJWT/releases

---

**æœ€åæ›´æ–°**: 2025-10-19  
**ç»´æŠ¤çŠ¶æ€**: âœ… ç§¯æç»´æŠ¤  
**ç‰ˆæœ¬**: v1.7.0
