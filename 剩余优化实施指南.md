# å‰©ä½™ä¼˜åŒ–ä»»åŠ¡å®æ–½æŒ‡å—

## P0-5: å›¾åºŠç®¡ç†ç•Œé¢å®Œå–„

### æ ¸å¿ƒåŠŸèƒ½
1. **åŒè§†å›¾æ¨¡å¼åˆ‡æ¢** (ç½‘æ ¼è§†å›¾ / åˆ—è¡¨è§†å›¾)
2. **Lightboxå¤§å›¾é¢„è§ˆ**
3. **æœç´¢å’Œæ’åºåŠŸèƒ½**
4. **æ™ºèƒ½æ¸…ç†é€‰é¡¹**

### æŠ€æœ¯è§„èŒƒ

#### ç»„ä»¶æ–‡ä»¶
- `frontend/src/views/ImageStorageUltra.vue`
  
#### çŠ¶æ€ç®¡ç†
```javascript
const viewMode = ref('grid') // 'grid' | 'list'
const images = ref([])
const searchQuery = ref('')
const sortBy = ref('time') // 'time' | 'size' | 'name'
const selectedImages = ref(new Set())
const lightboxVisible = ref(false)
const currentImage = ref(null)
```

#### APIè°ƒç”¨
```javascript
// è·å–å›¾ç‰‡åˆ—è¡¨
GET /api/image-storage/list
Response: {
  images: [
    {id, filename, size, upload_time, last_access, url}
  ],
  stats: {total_images, total_size_mb, usage_percentage}
}

// åˆ é™¤å›¾ç‰‡
DELETE /api/image-storage/delete
Body: {image_ids: [1, 2, 3]}

// æ™ºèƒ½æ¸…ç†
POST /api/image-storage/cleanup
Body: {days: 7, max_size_gb: 10}
```

#### UIå¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ–¼ï¸ å›¾åºŠç®¡ç†                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ç»Ÿè®¡å¡ç‰‡ (4ä¸ªå½©è‰²å¡ç‰‡)             â”‚
â”‚ â”œâ”€ æ€»ç©ºé—´  â”œâ”€ å·²ç”¨  â”œâ”€ å¯ç”¨  â”œâ”€ å›¾ç‰‡æ•°â”‚
â”‚ â””â”€ åŠ¨æ€è¿›åº¦æ¡ (æ ¹æ®ä½¿ç”¨ç‡å˜è‰²)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” æœç´¢æ¡†  ğŸ“Š æ’åº  ğŸ”„ è§†å›¾åˆ‡æ¢       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç½‘æ ¼è§†å›¾]                           â”‚
â”‚ â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”            â”‚
â”‚ â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚ â”‚ğŸ–¼ï¸ â”‚            â”‚
â”‚ â”‚100â”‚ â”‚200â”‚ â”‚150â”‚ â”‚300â”‚ KB         â”‚
â”‚ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜            â”‚
â”‚                                     â”‚
â”‚ [åˆ—è¡¨è§†å›¾]                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“„ image_123.jpg  â”‚ 100KB â”‚ ... â”‚ â”‚
â”‚ â”‚ ğŸ“„ image_456.jpg  â”‚ 200KB â”‚ ... â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ—‘ï¸ æ¸…ç†é€‰é¡¹                          â”‚
â”‚ â—‹ 7å¤©å‰  â—‹ 30å¤©å‰  â—‹ æ¸…ç©ºå…¨éƒ¨       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## P0-6: é¢‘é“æ˜ å°„ç¼–è¾‘å™¨å¢å¼º

### æ ¸å¿ƒåŠŸèƒ½
1. **SVGè´å¡å°”æ›²çº¿è¿æ¥**
2. **60+æ™ºèƒ½æ˜ å°„è§„åˆ™**
3. **ç½®ä¿¡åº¦åˆ†çº§æ˜¾ç¤º**
4. **ä¸€å¯¹å¤šè™šçº¿æ˜¾ç¤º**

### æŠ€æœ¯è§„èŒƒ

#### æ™ºèƒ½æ˜ å°„è§„åˆ™æ‰©å±•
```python
# backend/app/api/smart_mapping_enhanced.py (æ–°å¢)

MAPPING_RULES = {
    # ä¸­æ–‡ç›´è¯‘
    "å…¬å‘Š": ["announcements", "announcement", "news", "notice"],
    "æ´»åŠ¨": ["events", "event", "activity", "activities"],
    "æ›´æ–°": ["updates", "update", "changelog", "changes"],
    "è®¨è®º": ["discussion", "discuss", "chat", "talk"],
    "æŠ€æœ¯": ["tech", "technical", "technology", "dev"],
    "å¸®åŠ©": ["help", "support", "åŠ©æ‰‹", "question"],
    "åé¦ˆ": ["feedback", "å»ºè®®", "suggestion"],
    "Bug": ["bugs", "issues", "é—®é¢˜"],
    "é—²èŠ": ["chat", "off-topic", "random", "general"],
    "æ–°æ‰‹": ["newbie", "æ–°äºº", "beginner"],
    
    # è‹±æ–‡ç¿»è¯‘
    "general": ["ç»¼åˆ", "é€šç”¨", "ä¸€èˆ¬", "å¸¸è§„"],
    "development": ["å¼€å‘", "ç ”å‘", "dev"],
    "community": ["ç¤¾åŒº", "äº¤æµ", "community"],
    "showcase": ["å±•ç¤º", "ä½œå“", "åˆ†äº«"],
    "resources": ["èµ„æº", "ç´ æ", "ä¸‹è½½"],
    
    # æ¸¸æˆç›¸å…³
    "æ¸¸æˆ": ["game", "gaming", "play"],
    "å…¬ä¼š": ["guild", "clan", "æˆ˜é˜Ÿ"],
    "æ‹›å‹Ÿ": ["recruit", "æ‹›äºº", "ç»„é˜Ÿ"],
    "äº¤æ˜“": ["trade", "å¸‚åœº", "trading"],
    
    # æ›´å¤šè§„åˆ™...ï¼ˆå…±60+ï¼‰
}

def calculate_confidence(source: str, target: str) -> float:
    """
    è®¡ç®—æ˜ å°„ç½®ä¿¡åº¦
    
    ç®—æ³•:
    1. å®Œå…¨åŒ¹é…: 1.0
    2. åŒ…å«å…³ç³»: 0.9
    3. Levenshteinè·ç¦»: 0.5-0.8
    4. è§„åˆ™åŒ¹é…: 0.7
    5. æ— åŒ¹é…: 0.0
    """
    if source.lower() == target.lower():
        return 1.0
    
    if source in target or target in source:
        return 0.9
    
    # Levenshteinè·ç¦»è®¡ç®—
    distance = levenshtein_distance(source, target)
    max_len = max(len(source), len(target))
    similarity = 1 - (distance / max_len)
    
    if similarity > 0.8:
        return 0.8
    elif similarity > 0.6:
        return 0.6
    
    # è§„åˆ™åŒ¹é…
    for cn, en_list in MAPPING_RULES.items():
        if source in cn or source in en_list:
            if target in cn or target in en_list:
                return 0.7
    
    return 0.0
```

#### SVGè´å¡å°”æ›²çº¿
```javascript
// frontend/src/components/DraggableMappingUltimate.vue

// è®¡ç®—è´å¡å°”æ›²çº¿è·¯å¾„
function calculateBezierPath(x1, y1, x2, y2) {
  // æ§åˆ¶ç‚¹ï¼šæ°´å¹³è·ç¦»çš„1/3å¤„
  const cx1 = x1 + (x2 - x1) / 3
  const cy1 = y1
  const cx2 = x2 - (x2 - x1) / 3
  const cy2 = y2
  
  return `M ${x1} ${y1} C ${cx1} ${cy1}, ${cx2} ${cy2}, ${x2} ${y2}`
}

// SVGæ¸å˜è‰²å®šä¹‰
<defs>
  <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
    <stop offset="0%" style="stop-color:#409EFF;stop-opacity:1" />
    <stop offset="100%" style="stop-color:#67C23A;stop-opacity:1" />
  </linearGradient>
</defs>

// ç»˜åˆ¶è¿çº¿
<path
  :d="calculateBezierPath(source.x, source.y, target.x, target.y)"
  stroke="url(#lineGradient)"
  stroke-width="2"
  fill="none"
  :stroke-dasharray="isOneToMany ? '5,5' : 'none'"
  marker-end="url(#arrowhead)"
/>
```

---

## P0-7: è¿‡æ»¤è§„åˆ™ç•Œé¢ä¼˜åŒ–

### æ ¸å¿ƒåŠŸèƒ½
1. **å…³é”®è¯Tagè¾“å…¥å™¨**
2. **å®æ—¶æµ‹è¯•åŠŸèƒ½**
3. **ç”¨æˆ·é€‰æ‹©å™¨**
4. **è§„åˆ™é¢„è§ˆ**

### æŠ€æœ¯è§„èŒƒ

#### Tagè¾“å…¥ç»„ä»¶
```vue
<template>
  <div class="keyword-tag-input">
    <el-tag
      v-for="tag in keywords"
      :key="tag"
      closable
      @close="removeTag(tag)"
      type="primary"
      size="large"
    >
      {{ tag }}
    </el-tag>
    
    <el-input
      v-model="newKeyword"
      placeholder="è¾“å…¥å…³é”®è¯åæŒ‰å›è½¦"
      @keyup.enter="addTag"
      size="large"
      class="tag-input"
    />
  </div>
</template>

<script setup>
const keywords = ref(['å¹¿å‘Š', 'ä»£ç»ƒ', 'å¤–æŒ‚'])
const newKeyword = ref('')

const addTag = () => {
  if (newKeyword.value && !keywords.value.includes(newKeyword.value)) {
    keywords.value.push(newKeyword.value)
    newKeyword.value = ''
  }
}

const removeTag = (tag) => {
  const index = keywords.value.indexOf(tag)
  keywords.value.splice(index, 1)
}
</script>
```

#### è§„åˆ™æµ‹è¯•åŠŸèƒ½
```javascript
// å®æ—¶æµ‹è¯•æ¶ˆæ¯æ˜¯å¦é€šè¿‡è¿‡æ»¤
function testMessage() {
  const result = {
    passed: true,
    reason: '',
    rules_checked: []
  }
  
  // æµ‹è¯•é»‘åå•å…³é”®è¯
  for (const keyword of blacklistKeywords.value) {
    if (testContent.value.includes(keyword)) {
      result.passed = false
      result.reason = `åŒ…å«é»‘åå•å…³é”®è¯: ${keyword}`
      result.rules_checked.push({
        type: 'keyword_blacklist',
        matched: keyword
      })
      return result
    }
  }
  
  // æµ‹è¯•ç™½åå•å…³é”®è¯
  if (whitelistKeywords.value.length > 0) {
    const hasWhitelisted = whitelistKeywords.value.some(
      kw => testContent.value.includes(kw)
    )
    if (!hasWhitelisted) {
      result.passed = false
      result.reason = 'ä¸åŒ…å«ç™½åå•å…³é”®è¯'
      return result
    }
  }
  
  return result
}
```

---

## P0-8: å®æ—¶ç›‘æ§é¡µå¢å¼º

### æ ¸å¿ƒåŠŸèƒ½
1. **æ¶ˆæ¯æœç´¢**
2. **å¤±è´¥æ¶ˆæ¯æ‰‹åŠ¨é‡è¯•**
3. **æ—¥å¿—å¯¼å‡ºï¼ˆCSV/JSONï¼‰**
4. **å¢å¼ºç»Ÿè®¡å›¾è¡¨**

### æŠ€æœ¯è§„èŒƒ

#### æœç´¢åŠŸèƒ½
```javascript
const searchQuery = ref('')
const searchFilters = ref({
  status: 'all', // 'all' | 'success' | 'failed' | 'pending'
  platform: 'all',
  dateRange: null
})

const filteredLogs = computed(() => {
  return logs.value.filter(log => {
    // æœç´¢å†…å®¹åŒ¹é…
    if (searchQuery.value && !log.content.includes(searchQuery.value)) {
      return false
    }
    
    // çŠ¶æ€è¿‡æ»¤
    if (searchFilters.value.status !== 'all' && log.status !== searchFilters.value.status) {
      return false
    }
    
    // å¹³å°è¿‡æ»¤
    if (searchFilters.value.platform !== 'all' && log.platform !== searchFilters.value.platform) {
      return false
    }
    
    return true
  })
})
```

#### æ—¥å¿—å¯¼å‡º
```javascript
async function exportLogs(format) {
  const data = filteredLogs.value
  
  if (format === 'csv') {
    const csv = [
      ['æ—¶é—´', 'é¢‘é“', 'å¹³å°', 'çŠ¶æ€', 'å†…å®¹', 'å»¶è¿Ÿ'],
      ...data.map(log => [
        log.timestamp,
        log.channel,
        log.platform,
        log.status,
        log.content,
        log.latency_ms
      ])
    ].map(row => row.join(',')).join('\n')
    
    downloadFile(csv, 'logs.csv', 'text/csv')
  } else if (format === 'json') {
    const json = JSON.stringify(data, null, 2)
    downloadFile(json, 'logs.json', 'application/json')
  }
}

function downloadFile(content, filename, mimeType) {
  const blob = new Blob([content], { type: mimeType })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = filename
  a.click()
  URL.revokeObjectURL(url)
}
```

#### æ‰‹åŠ¨é‡è¯•
```javascript
async function retryFailedMessage(messageId) {
  try {
    await api.post(`/api/logs/retry/${messageId}`)
    ElMessage.success('é‡è¯•è¯·æ±‚å·²å‘é€')
    // åˆ·æ–°æ—¥å¿—åˆ—è¡¨
    await loadLogs()
  } catch (error) {
    ElMessage.error('é‡è¯•å¤±è´¥: ' + error.message)
  }
}

// æ‰¹é‡é‡è¯•æ‰€æœ‰å¤±è´¥æ¶ˆæ¯
async function retryAllFailed() {
  const failedMessages = logs.value.filter(log => log.status === 'failed')
  
  if (failedMessages.length === 0) {
    ElMessage.info('æ²¡æœ‰å¤±è´¥çš„æ¶ˆæ¯')
    return
  }
  
  await ElMessageBox.confirm(
    `ç¡®å®šè¦é‡è¯• ${failedMessages.length} æ¡å¤±è´¥æ¶ˆæ¯å—ï¼Ÿ`,
    'æ‰¹é‡é‡è¯•',
    { type: 'warning' }
  )
  
  for (const msg of failedMessages) {
    await retryFailedMessage(msg.id)
  }
}
```

---

## P1çº§å’ŒP2çº§ä»»åŠ¡è§„èŒƒ

ç”±äºç¯‡å¹…é™åˆ¶ï¼ŒP1å’ŒP2çº§ä»»åŠ¡çš„è¯¦ç»†è§„èŒƒè¯·å‚è€ƒï¼š
- `docs/P1çº§ä¼˜åŒ–å®æ–½æŒ‡å—.md`
- `docs/P2çº§ä¼˜åŒ–å®æ–½æŒ‡å—.md`

---

## å®æ–½å»ºè®®

1. **æŒ‰ä¼˜å…ˆçº§å®æ–½**: P0 â†’ P1 â†’ P2
2. **å¢é‡äº¤ä»˜**: æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½ç‚¹ç«‹å³æµ‹è¯•
3. **ä»£ç å®¡æŸ¥**: ç¡®ä¿ä»£ç è´¨é‡å’Œä¸€è‡´æ€§
4. **æ–‡æ¡£åŒæ­¥æ›´æ–°**: æ›´æ–°APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ

---

**ç”Ÿæˆæ—¥æœŸ**: 2025-10-27  
**ç‰ˆæœ¬**: v1.0
