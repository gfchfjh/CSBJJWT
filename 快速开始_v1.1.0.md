# 🚀 KOOK消息转发系统 v1.1.0 - 快速开始指南

**3分钟上手，5分钟配置完成！**

---

## 📦 安装步骤

### 方式一：源码运行（推荐开发者）

```bash
# 1. 克隆项目
git clone https://github.com/gfchfjh/CSBJJWT.git
cd CSBJJWT

# 2. 安装后端依赖
cd backend
pip install -r requirements.txt
playwright install chromium

# 3. 安装前端依赖
cd ../frontend
npm install

# 4. 启动Redis（如果没有）
# Windows: 下载Redis for Windows
# macOS: brew install redis && redis-server
# Linux: sudo systemctl start redis

# 5. 启动后端（终端1）
cd backend
python -m app.main

# 6. 启动前端（终端2）
cd frontend
npm run dev

# 7. 浏览器访问
# http://localhost:5173
```

### 方式二：一键启动

```bash
# Linux/macOS
./start.sh

# Windows
start.bat
```

---

## ⚡ 3分钟快速配置

### 第1步：设置主密码（30秒）

首次启动会提示：

1. 输入主密码（6-20位）：`MyPass123`
2. 确认密码：`MyPass123`
3. ✅ 勾选"记住30天"
4. 点击"设置密码并进入"

---

### 第2步：同意免责声明（30秒）

配置向导第一步：

1. 📖 阅读免责声明（5条）
2. ✅ 勾选"我已阅读并同意"
3. 点击"同意并继续"

---

### 第3步：添加KOOK账号（1分钟）

两种方式任选其一：

#### 方式A：Cookie导入（推荐）

1. 浏览器打开 https://www.kookapp.cn 并登录
2. F12 → Application → Cookies
3. 复制所有Cookie（JSON格式）
4. 粘贴到应用"导入Cookie"框
5. 点击"登录并继续"

#### 方式B：账号密码

1. 输入KOOK邮箱
2. 输入密码
3. 如有验证码，自动弹窗输入
4. 点击"登录并继续"

---

### 第4步：配置转发Bot（1分钟）

选择一个平台配置（以Discord为例）：

#### Discord配置:
1. Discord服务器 → 设置 → 集成 → Webhooks
2. 新建Webhook，复制URL
3. 粘贴到应用
4. 点击"测试连接"
5. 点击"添加Discord Bot"

#### Telegram配置:
1. 与 @BotFather 对话
2. `/newbot` 创建Bot
3. 复制Bot Token
4. 将Bot加入群组
5. 获取Chat ID（应用内置工具）

#### 飞书配置:
1. 访问飞书开放平台
2. 创建自建应用
3. 获取App ID和Secret
4. 填入应用

---

### 第5步：设置频道映射（30秒）

#### 智能映射（推荐）:
1. 点击"智能映射"
2. 点击"生成映射建议"
3. 查看匹配结果
4. 点击"应用所有建议"

#### 手动映射:
1. 点击"添加映射"
2. 选择KOOK源频道
3. 选择目标平台和Bot
4. 填入目标频道ID
5. 保存

---

### 第6步：启动服务（10秒）

1. 点击右上角"启动服务"按钮
2. 观察状态变为 🟢 运行中
3. 进入"日志"页面查看实时转发

---

## 🎯 推荐配置

### 基础配置（必需）

- ✅ 至少1个KOOK账号
- ✅ 至少1个转发平台Bot
- ✅ 至少1条频道映射

### 高级配置（推荐）

- 📧 **邮件告警**：服务异常时及时通知
- 🔐 **主密码**：保护敏感配置
- 🖥️ **开机自启**：自动运行服务
- 🎨 **过滤规则**：过滤广告、关键词

---

## 🆕 v1.1.0 新功能使用

### 功能1：主密码保护

**何时需要**：保护配置和Token不被他人访问

**设置方法**：
- 首次启动自动提示
- 设置后每次启动需要输入
- 可勾选"记住30天"

### 功能2：系统托盘

**何时需要**：后台运行，不占用任务栏

**使用方法**：
- 点击窗口关闭按钮（X）自动最小化到托盘
- 双击托盘图标恢复窗口
- 右键查看实时统计

### 功能3：邮件告警

**何时需要**：无人值守时及时发现问题

**设置方法**：
1. 设置 → 邮件告警
2. 填入SMTP配置
3. 测试连接
4. 启用告警

---

## 🐛 常见问题

### Q1: 单元测试失败？

```bash
# 安装测试依赖
pip install -r requirements-dev.txt

# 重新运行
./run_tests.sh
```

### Q2: 验证码弹窗不显示？

**检查**:
- 账号是否正在启动中
- 后端日志是否有验证码请求
- 浏览器Console是否有错误

### Q3: 邮件发送失败？

**常见原因**:
- SMTP密码错误（Gmail需要"应用专用密码"）
- 端口被防火墙阻止
- SMTP服务器地址错误

**解决**:
```bash
# 测试SMTP连接
curl -X POST http://localhost:9527/api/system/email-test
```

### Q4: 系统托盘图标不显示？

**Linux用户**:
```bash
# 安装托盘支持库
sudo apt install libappindicator1
```

---

## 📊 性能基准

### 测试环境
- CPU: 4核
- 内存: 8GB
- 系统: Ubuntu 22.04

### 性能指标
- 消息转发延迟: < 2秒
- 内存占用: ~200MB
- CPU占用: < 5%
- 测试通过率: 100%

---

## 🎓 进阶使用

### 1. 批量导入配置

```bash
# 导出配置
curl http://localhost:9527/api/backup/create > backup.json

# 导入配置
curl -X POST http://localhost:9527/api/backup/restore \
  -H "Content-Type: application/json" \
  -d @backup.json
```

### 2. 查看实时日志

```bash
# 后端日志
tail -f ~/Documents/KookForwarder/data/logs/app.log

# 测试覆盖率
cd backend
pytest tests/ --cov=app --cov-report=term
```

### 3. 自定义配置

编辑 `backend/.env` 文件：

```env
# API端口
API_PORT=9527

# Redis配置
REDIS_HOST=127.0.0.1
REDIS_PORT=6379

# 日志级别
LOG_LEVEL=INFO

# 2Captcha API Key（可选）
CAPTCHA_2CAPTCHA_API_KEY=your_api_key
```

---

## 🎉 恭喜完成配置！

现在您可以：

1. ✅ 进入"日志"查看实时转发
2. ✅ 查看"概览"页面的统计数据
3. ✅ 最小化到托盘后台运行
4. ✅ 配置邮件告警（可选）

---

## 📞 需要帮助？

- 📚 完整文档: `/docs` 目录
- 🐛 问题反馈: https://github.com/gfchfjh/CSBJJWT/issues
- 📧 联系方式: 查看 LICENSE 文件

---

<div align="center">

**开始享受KOOK消息转发的便利吧！** 🎊

</div>
